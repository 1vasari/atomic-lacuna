<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title> - archaeology.js</title>

  <link rel="stylesheet" href="../../../assets/style.css">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"/>
  <meta name="groc-relative-root" content="../../../"/>
  <meta name="groc-document-path" content="app/js/building/archaeology.js"/>
  
</head>
<body>
  <div id="file-area">
    <div id="meta">
      <code class="file-path">
      
        app/js/building/archaeology.js
      
      </code>
    </div>
    <div id="document">
    
      <div class="segment">
      
      
        <div class="code"><pre class="wrapper"><span class="hljs-pi">'use strict'</span>;
YAHOO.namespace(<span class="hljs-string">"lacuna.buildings"</span>);
(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> Lang = YAHOO.lang,
        Util = YAHOO.util,
        DDM = Util.DragDropMgr,
        Dom = Util.Dom,
        Event = Util.Event,
        Sel = Util.Selector,
        Lacuna = YAHOO.lacuna,
        Game = Lacuna.Game,
        Lib = Lacuna.Library;
    <span class="hljs-keyword">var</span> DDList = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id, sGroup, config)</span> {</span>
        DDList.superclass.constructor.call(<span class="hljs-keyword">this</span>, id, sGroup, config);
        <span class="hljs-keyword">var</span> el = <span class="hljs-keyword">this</span>.getDragEl();
        Dom.setStyle(el, <span class="hljs-string">"opacity"</span>, <span class="hljs-number">0.67</span>); <span class="hljs-comment">// The proxy is slightly transparent</span>
        <span class="hljs-keyword">this</span>.goingUp = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>.lastY = <span class="hljs-number">0</span>;
    };
    YAHOO.extend(DDList, YAHOO.util.DDProxy, {
        startDrag: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x, y)</span> {</span></pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>make the proxy look like the source element</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">            <span class="hljs-keyword">var</span> dragEl = <span class="hljs-keyword">this</span>.getDragEl();
            <span class="hljs-keyword">var</span> clickEl = <span class="hljs-keyword">this</span>.getEl();</pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>only hide original when moving with the &#39;combine&#39; list</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">            <span class="hljs-keyword">var</span> fromCombineList = Dom.getAncestorBy(clickEl, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
                <span class="hljs-keyword">return</span> el.id === <span class="hljs-string">"archaeologyGlyphCombine"</span>;
            });
            <span class="hljs-keyword">if</span> (fromCombineList) {
                Dom.setStyle(clickEl, <span class="hljs-string">"visibility"</span>, <span class="hljs-string">"hidden"</span>);
            }
            dragEl.innerHTML = clickEl.innerHTML;
            Dom.setStyle(dragEl, <span class="hljs-string">"color"</span>, Dom.getStyle(clickEl, <span class="hljs-string">"color"</span>));
            Dom.setStyle(dragEl, <span class="hljs-string">"backgroundColor"</span>, Dom.getStyle(clickEl, <span class="hljs-string">"backgroundColor"</span>));
            Dom.setStyle(dragEl, <span class="hljs-string">"border"</span>, <span class="hljs-string">"2px solid gray"</span>);
            Dom.setStyle(dragEl, <span class="hljs-string">"zIndex"</span>, Dom.getStyle(<span class="hljs-string">"buildingDetails_c"</span>, <span class="hljs-string">"zIndex"</span>) * <span class="hljs-number">1</span> + <span class="hljs-number">1</span>);
            <span class="hljs-keyword">if</span> (!fromCombineList) {
                <span class="hljs-keyword">this</span>._removeGlyphCount(dragEl);
            }
        },
        endDrag: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
            <span class="hljs-keyword">var</span> srcEl = <span class="hljs-keyword">this</span>.getEl();
            <span class="hljs-keyword">var</span> proxy = <span class="hljs-keyword">this</span>.getDragEl();</pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Show the proxy element and animate it to the src element&#39;s location</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">            Dom.setStyle(proxy, <span class="hljs-string">"visibility"</span>, <span class="hljs-string">""</span>);
            <span class="hljs-keyword">var</span> a = <span class="hljs-keyword">new</span> YAHOO.util.Motion(proxy, {
                points: {
                    to: Dom.getXY(srcEl)
                }
            }, <span class="hljs-number">0.2</span>, YAHOO.util.Easing.easeOut);
            <span class="hljs-keyword">var</span> proxyid = proxy.id;
            <span class="hljs-keyword">var</span> thisid = <span class="hljs-keyword">this</span>.id;</pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Hide the proxy and show the source element when finished with the animation</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">            a.onComplete.subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
                Dom.setStyle(proxyid, <span class="hljs-string">"visibility"</span>, <span class="hljs-string">"hidden"</span>);
                Dom.setStyle(thisid, <span class="hljs-string">"visibility"</span>, <span class="hljs-string">""</span>);
            });
            a.animate();
        },
        onDragDrop: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e, id)</span> {</span>
            <span class="hljs-keyword">if</span> (id === <span class="hljs-string">"archaeologyGlyphDetails"</span>) {</pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>The position of the cursor at the time of the drop (YAHOO.util.Point)</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">                <span class="hljs-keyword">var</span> pt = DDM.interactionInfo.point;</pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>The region occupied by the source element at the time of the drop</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">                <span class="hljs-keyword">var</span> region = DDM.interactionInfo.sourceRegion;</pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Check to see if we are over the source element&#39;s location.  We will
append to the bottom of the list once we are sure it was a drop in
the negative space (the area of the list without any list items)</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">                <span class="hljs-keyword">if</span> (!region.intersect(pt)) {
                    <span class="hljs-keyword">var</span> El = <span class="hljs-keyword">this</span>.getEl();
                    <span class="hljs-keyword">var</span> fromCombineList = Dom.getAncestorBy(El, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
                        <span class="hljs-keyword">return</span> el.id == <span class="hljs-string">"archaeologyGlyphCombine"</span>;
                    });
                    <span class="hljs-keyword">if</span> (fromCombineList) {</pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>moving from &#39;combine&#39; list to &#39;details&#39; list
just remove it from the &#39;combine&#39; list - don&#39;t copy it over</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">                        El.parentNode.removeChild(El);
                        DDM.refreshCache();
                    }
                }
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (id === <span class="hljs-string">"archaeologyGlyphCombine"</span>) {</pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>The position of the cursor at the time of the drop (YAHOO.util.Point)</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">                <span class="hljs-keyword">var</span> pt = DDM.interactionInfo.point;</pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>The region occupied by the source element at the time of the drop</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">                <span class="hljs-keyword">var</span> region = DDM.interactionInfo.sourceRegion;</pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Check to see if we are over the source element&#39;s location.  We will
append to the bottom of the list once we are sure it was a drop in
the negative space (the area of the list without any list items)</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">                <span class="hljs-keyword">if</span> (!region.intersect(pt)) {
                    <span class="hljs-keyword">var</span> destEl = Dom.get(id);
                    <span class="hljs-keyword">var</span> destDD = DDM.getDDById(id);
                    <span class="hljs-keyword">var</span> El = <span class="hljs-keyword">this</span>.getEl();
                    <span class="hljs-keyword">var</span> fromAvailableList = Dom.getAncestorBy(El, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
                        <span class="hljs-keyword">return</span> el.id === <span class="hljs-string">"archaeologyGlyphDetails"</span>;
                    });
                    <span class="hljs-keyword">if</span> (fromAvailableList) {</pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>moving from &#39;details&#39; list to &#39;combine&#39; list
clone it - don&#39;t just move it</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">                        <span class="hljs-keyword">var</span> clone = El.cloneNode(<span class="hljs-literal">true</span>);
                        <span class="hljs-keyword">this</span>._removeGlyphCount(clone);
                        clone.id = Dom.generateId();
                        clone.Glyph = El.Glyph;
                        destEl.appendChild(clone);
                        clone.DD = <span class="hljs-keyword">new</span> DDList(clone);
                        destDD.isEmpty = <span class="hljs-literal">false</span>;
                        DDM.refreshCache();
                    }
                }
            }
        },
        onDrag: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span></pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Keep track of the direction of the drag for use during onDragOver</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">            <span class="hljs-keyword">var</span> y = Event.getPageY(e),
                el = <span class="hljs-keyword">this</span>.getEl(),
                container = el.parentNode;
            <span class="hljs-keyword">if</span> (y &lt; <span class="hljs-keyword">this</span>.lastY) {
                <span class="hljs-keyword">this</span>.goingUp = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">if</span> (container.scrollTop &gt; el.offsetTop) {
                    container.scrollTop -= el.clientHeight;
                }
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (y &gt; <span class="hljs-keyword">this</span>.lastY) {
                <span class="hljs-keyword">this</span>.goingUp = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">if</span> ((el.offsetTop - container.scrollTop) &gt; el.clientHeight) {
                    container.scrollTop = el.offsetTop;
                }
            }
            <span class="hljs-keyword">this</span>.lastY = y;
        },
        onDragOver: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e, id)</span> {</span>
            <span class="hljs-keyword">var</span> srcEl = <span class="hljs-keyword">this</span>.getEl();
            <span class="hljs-keyword">var</span> destEl = Dom.get(id);</pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>only allow reordering when rearranging the &#39;combine&#39; list
moves from &#39;details&#39; to &#39;combine&#39; always just get added to the end of the &#39;combine&#39; list</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">            <span class="hljs-keyword">var</span> fromDetailsList = Dom.getAncestorBy(srcEl, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
                <span class="hljs-keyword">return</span> el.id === <span class="hljs-string">"archaeologyGlyphDetails"</span>;
            });
            <span class="hljs-keyword">var</span> toCombineList = Dom.getAncestorBy(destEl, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
                <span class="hljs-keyword">return</span> el.id === <span class="hljs-string">"archaeologyGlyphCombine"</span>;
            });
            <span class="hljs-keyword">if</span> (fromDetailsList || !toCombineList) {
                <span class="hljs-keyword">return</span>;
            }</pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>We are only concerned with list items, we ignore the dragover
notifications for the list.</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">            <span class="hljs-keyword">if</span> (destEl.nodeName.toLowerCase() === <span class="hljs-string">"li"</span>) {
                <span class="hljs-keyword">var</span> orig_p = srcEl.parentNode;
                <span class="hljs-keyword">var</span> p = destEl.parentNode;
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.goingUp) {
                    p.insertBefore(srcEl, destEl); <span class="hljs-comment">// insert above</span>
                }
                <span class="hljs-keyword">else</span> {
                    p.insertBefore(srcEl, destEl.nextSibling); <span class="hljs-comment">// insert below</span>
                }
                DDM.refreshCache();
            }
        },
        _removeGlyphCount: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(element)</span> {</span></pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>remove glyph count from header text</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">            <span class="hljs-keyword">var</span> container = Dom.getFirstChildBy(element, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
                <span class="hljs-keyword">return</span> Dom.hasClass(el, <span class="hljs-string">"archaeologyGlyphContainer"</span>);
            });
            <span class="hljs-keyword">var</span> header = Dom.getFirstChildBy(container, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
                <span class="hljs-keyword">return</span> Dom.hasClass(el, <span class="hljs-string">"archaeologyGlyphHeader"</span>);
            });
            <span class="hljs-keyword">var</span> text = header.innerHTML;
            header.innerHTML = text.replace(<span class="hljs-regexp">/ \([0-9]+\)/</span>, <span class="hljs-string">""</span>);
        }
    });
    <span class="hljs-keyword">var</span> Archaeology = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(result)</span> {</span>
        Archaeology.superclass.constructor.call(<span class="hljs-keyword">this</span>, result);
        <span class="hljs-keyword">this</span>.service = Game.Services.Buildings.Archaeology;
    };
    Lang.extend(Archaeology, Lacuna.buildings.Building, {
        getChildTabs: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> [<span class="hljs-keyword">this</span>._getSearchTab(), <span class="hljs-keyword">this</span>._getViewTab(), <span class="hljs-keyword">this</span>._getExcavatorTab()];
        },
        _getSearchTab: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> tab = <span class="hljs-keyword">new</span> YAHOO.widget.Tab({
                label: <span class="hljs-string">"Search"</span>,
                content: [<span class="hljs-string">'&lt;div id="archaeologySearchContainer"&gt;'</span>, <span class="hljs-string">'  &lt;ul id="archaeologySearchForm"&gt;'</span>, <span class="hljs-string">'    &lt;li&gt;Search Ore:&lt;select id="archaeologyOre"&gt;&lt;/select&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'    &lt;li&gt;&lt;button type="button" id="archaeologySearch"&gt;Search&lt;/button&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'  &lt;/ul&gt;'</span>, <span class="hljs-string">'  &lt;ul id="archaeologySearchNone" style="display: none"&gt;'</span>, <span class="hljs-string">'    &lt;li&gt;Not enough ore available to search.&lt;/li&gt;'</span>, <span class="hljs-string">'  &lt;/ul&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>, <span class="hljs-string">'&lt;div id="archaeologyWorkingContainer"&gt;'</span>, <span class="hljs-string">'  &lt;ul&gt;'</span>, <span class="hljs-string">'    &lt;li&gt;Searching: &lt;span id="archaeologySearchOre"&gt;&lt;/span&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'    &lt;li&gt;Time left on current search: &lt;span id="archaeologySearchTime"&gt;&lt;/span&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'    &lt;li&gt;You may subsidize the search for 2 &lt;img src="'</span>, Lib.AssetUrl, <span class="hljs-string">'ui/s/essentia.png" class="smallEssentia" /&gt;.&lt;/li&gt;'</span>, <span class="hljs-string">'    &lt;li&gt;&lt;button type="button" id="archaeologySearchSubsidize"&gt;Subsidize&lt;/button&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'  &lt;/ul&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>].join(<span class="hljs-string">''</span>)
            });
            tab.subscribe(<span class="hljs-string">"activeChange"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
                <span class="hljs-keyword">if</span> (e.newValue) {
                    <span class="hljs-keyword">this</span>.checkIfWorking();
                }
            }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">this</span>.searchTab = tab;
            Event.on(<span class="hljs-string">"archaeologySearch"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.searchForGlyph, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            Event.on(<span class="hljs-string">"archaeologySearchSubsidize"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.Subsidize, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">return</span> tab;
        },
        _getViewTab: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> tab = <span class="hljs-keyword">new</span> YAHOO.widget.Tab({
                label: <span class="hljs-string">"View Glyphs"</span>,
                content: [<span class="hljs-string">'&lt;div class="clearafter"&gt;'</span>, <span class="hljs-string">'  &lt;div class="archaeologySlots"&gt;'</span>, <span class="hljs-string">'    &lt;label&gt;Available Glyphs&lt;/label&gt;'</span>, <span class="hljs-string">'    &lt;ul id="archaeologyGlyphDetails" class="archaeologyGlyphInfo"&gt;'</span>, <span class="hljs-string">'    &lt;/ul&gt;'</span>, <span class="hljs-string">'  &lt;/div&gt;'</span>, <span class="hljs-string">'  &lt;div class="archaeologySlots"&gt;'</span>, <span class="hljs-string">'    &lt;label&gt;Combine Glyphs&lt;/label&gt;'</span>, <span class="hljs-string">'    &lt;ul id="archaeologyGlyphCombine" class="archaeologyGlyphInfo"&gt;'</span>, <span class="hljs-string">'    &lt;/ul&gt;'</span>, <span class="hljs-string">'  &lt;/div&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;&lt;span title="How many times should the specified glyphs be combined (max 50)"&gt; Quantity: &lt;input type="text" id="combineQuantity" value="1" size="2"&gt;&lt;/span&gt; &lt;button type="button" id="archaeologyCombine"&gt;Combine&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>)
            });
            tab.subscribe(<span class="hljs-string">"activeChange"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
                <span class="hljs-keyword">if</span> (e.newValue) {
                    <span class="hljs-keyword">this</span>.getGlyphs();
                }
                <span class="hljs-keyword">var</span> Ht = Game.GetSize()
                    .h - <span class="hljs-number">180</span>;
                <span class="hljs-keyword">if</span> (Ht &gt; <span class="hljs-number">442</span>) {
                    Ht = <span class="hljs-number">442</span>;
                }
                <span class="hljs-keyword">var</span> tC = Dom.get(<span class="hljs-string">'archaeologyGlyphDetails'</span>)
                    .parentNode.parentNode;
                Dom.setStyle(tC, <span class="hljs-string">'height'</span>, Ht + <span class="hljs-string">'px'</span>);
                Dom.setStyle(tC, <span class="hljs-string">'overflow-y'</span>, <span class="hljs-string">'auto'</span>);
            }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            Event.onAvailable(<span class="hljs-string">"archaeologyCombine"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
                Event.on(<span class="hljs-string">"archaeologyCombine"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.assembleGlyph, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            Event.delegate(<span class="hljs-string">"archaeologyGlyphDetails"</span>, <span class="hljs-string">"dblclick"</span>, <span class="hljs-keyword">this</span>.viewAdd, <span class="hljs-string">"li"</span>);
            Event.delegate(<span class="hljs-string">"archaeologyGlyphCombine"</span>, <span class="hljs-string">"dblclick"</span>, <span class="hljs-keyword">this</span>.viewRemove, <span class="hljs-string">"li"</span>);
            <span class="hljs-keyword">this</span>.viewTab = tab;
            <span class="hljs-keyword">return</span> tab;
        },
        _getExcavatorTab: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">this</span>.excavatorTab = <span class="hljs-keyword">new</span> YAHOO.widget.Tab({
                label: <span class="hljs-string">"Excavators"</span>,
                content: [<span class="hljs-string">'&lt;div id="excavatorInfo"&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'&lt;div class="excavatorContainer"&gt;'</span>, <span class="hljs-string">'  &lt;div id="excavatorDetails"&gt;'</span>, <span class="hljs-string">'  &lt;/div&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>].join(<span class="hljs-string">''</span>)
            });
            <span class="hljs-keyword">this</span>.excavatorTab.subscribe(<span class="hljs-string">"activeChange"</span>, <span class="hljs-keyword">this</span>.viewExcavators, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.excavatorTab;
        },
        viewExcavators: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
            <span class="hljs-keyword">if</span> (e.newValue) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.excavators) {
                    Lacuna.Pulser.Show();
                    <span class="hljs-keyword">this</span>.service.view_excavators({
                        session_id: Game.GetSession(),
                        building_id: <span class="hljs-keyword">this</span>.building.id
                    }, {
                        success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> {</span>
                            YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"Archaeology.view_excavators.success"</span>);
                            Lacuna.Pulser.Hide();
                            <span class="hljs-keyword">this</span>.rpcSuccess(o);
                            <span class="hljs-keyword">this</span>.excavators = {
                                max_excavators: o.result.max_excavators,
                                travel_e: o.result.travelling,
                                excavators: o.result.excavators
                            };
                            <span class="hljs-keyword">this</span>.ArchaeologyExcavators();
                        },
                        scope: <span class="hljs-keyword">this</span>
                    });
                }
                <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">this</span>.ArchaeologyExcavators();
                }
            }
        },
        ArchaeologyExcavators: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> excavators = <span class="hljs-keyword">this</span>.excavators.excavators,
                details = Dom.get(<span class="hljs-string">"excavatorDetails"</span>);
            <span class="hljs-keyword">if</span> (details) {
                <span class="hljs-keyword">var</span> ul = document.createElement(<span class="hljs-string">"ul"</span>),
                    li = document.createElement(<span class="hljs-string">"li"</span>),
                    info = Dom.get(<span class="hljs-string">"excavatorInfo"</span>);
                <span class="hljs-keyword">if</span> (excavators.length &gt; <span class="hljs-number">0</span>) {
                    info.innerHTML = [<span class="hljs-string">'Total of '</span>, excavators.length - <span class="hljs-number">1</span>, <span class="hljs-string">' excavators deployed. '</span>,
                        <span class="hljs-keyword">this</span>.excavators.travel_e, <span class="hljs-string">' en route. This ministry can control a maximum of '</span>,
                        <span class="hljs-keyword">this</span>.excavators.max_excavators, <span class="hljs-string">' excavators.'</span>
                    ].join(<span class="hljs-string">''</span>);
                }
                Event.purgeElement(details);
                details.innerHTML = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">if</span> (excavators.length &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; excavators.length; i++) {
                        <span class="hljs-keyword">var</span> obj = excavators[i],
                            nUl = ul.cloneNode(<span class="hljs-literal">false</span>),
                            nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                        nUl.Excavator = obj;
                        Dom.addClass(nUl, <span class="hljs-string">"excavatorInfo"</span>);
                        Dom.addClass(nUl, <span class="hljs-string">"clearafter"</span>);
                        Dom.addClass(nLi, <span class="hljs-string">"excavatorLocation"</span>);
                        nLi.innerHTML = [<span class="hljs-string">'&lt;img src="'</span>, Lib.AssetUrl, <span class="hljs-string">'star_system/'</span>, obj.body.image, <span class="hljs-string">'.png" /&gt;'</span>, obj.body.name].join(<span class="hljs-string">''</span>);
                        Event.on(nLi, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.excavatorClick, obj, <span class="hljs-literal">true</span>);
                        nUl.appendChild(nLi);
                        <span class="hljs-keyword">var</span> bbtn;
                        <span class="hljs-keyword">if</span> (obj.id &gt; <span class="hljs-number">0</span>) {
                            nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                            Dom.addClass(nLi, <span class="hljs-string">"excavatorAbandon"</span>);
                            bbtn = document.createElement(<span class="hljs-string">"button"</span>);
                            bbtn.setAttribute(<span class="hljs-string">"type"</span>, <span class="hljs-string">"button"</span>);
                            bbtn.innerHTML = <span class="hljs-string">"Abandon"</span>;
                            bbtn = nLi.appendChild(bbtn);
                            nUl.appendChild(nLi);
                        }
                        nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                        <span class="hljs-keyword">var</span> ptype = obj.body.image.slice(<span class="hljs-number">0</span>, obj.body.image.indexOf(<span class="hljs-string">'-'</span>));
                        Dom.addClass(nLi, <span class="hljs-string">"excavatorChances"</span>);
                        <span class="hljs-keyword">var</span> outChance = [<span class="hljs-string">'&lt;ul&gt;&lt;li&gt;&lt;label&gt;Body Type: &lt;/label&gt;'</span>, ptype, <span class="hljs-string">' &lt;label&gt;Chances:&lt;/label&gt;&lt;/li&gt;'</span>];
                        <span class="hljs-keyword">var</span> total = <span class="hljs-number">0</span>;
                        <span class="hljs-keyword">var</span> ctypes = [<span class="hljs-string">"artifact"</span>, <span class="hljs-string">"glyph"</span>, <span class="hljs-string">"plan"</span>, <span class="hljs-string">"resource"</span>];
                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> chance_i <span class="hljs-keyword">in</span> ctypes) {
                            <span class="hljs-keyword">var</span> chance = ctypes[chance_i];
                            <span class="hljs-keyword">if</span> (obj[chance] &gt; <span class="hljs-number">0</span>) {
                                outChance.push(<span class="hljs-string">'&lt;li&gt;&lt;label&gt;'</span> + chance.replace(<span class="hljs-regexp">/^\w/</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(c)</span> {</span>
                                    <span class="hljs-keyword">return</span> c.toUpperCase();
                                }) + <span class="hljs-string">':&lt;/label&gt; '</span>);
                                outChance.push(obj[chance]);
                                outChance.push(<span class="hljs-string">'&lt;/li&gt;'</span>);
                                total += <span class="hljs-built_in">parseInt</span>(obj[chance]);
                            }
                        }
                        <span class="hljs-keyword">if</span> (total &gt; <span class="hljs-number">0</span>) {
                            outChance.splice(<span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-string">'&lt;li&gt;&lt;label&gt;Total:&lt;/label&gt; '</span>);
                            outChance.splice(<span class="hljs-number">4</span>, <span class="hljs-number">0</span>, <span class="hljs-built_in">parseInt</span>(total));
                            outChance.splice(<span class="hljs-number">5</span>, <span class="hljs-number">0</span>, <span class="hljs-string">'&lt;/li&gt;'</span>);
                        }
                        outChance.push(<span class="hljs-string">'&lt;/ul&gt;'</span>);
                        nLi.innerHTML = outChance.join(<span class="hljs-string">''</span>);
                        nUl.appendChild(nLi);
                        details.appendChild(nUl);
                        Event.on(bbtn, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.ExcavatorAbandon, {
                            Self: <span class="hljs-keyword">this</span>,
                            Excavator: obj,
                            Line: nUl
                        }, <span class="hljs-literal">true</span>);
                    }
                }
                <span class="hljs-comment">//wait for tab to display first</span>
                setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">var</span> Ht = Game.GetSize()
                        .h - <span class="hljs-number">210</span>;
                    <span class="hljs-keyword">if</span> (Ht &gt; <span class="hljs-number">280</span>) {
                        Ht = <span class="hljs-number">280</span>;
                    }
                    Dom.setStyle(details.parentNode, <span class="hljs-string">"height"</span>, Ht + <span class="hljs-string">"px"</span>);
                    Dom.setStyle(details.parentNode, <span class="hljs-string">"overflow-y"</span>, <span class="hljs-string">"auto"</span>);
                }, <span class="hljs-number">10</span>);
            }
        },
        ExcavatorAbandon: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">if</span> (confirm([<span class="hljs-string">"Are you sure you want to Abandon the excavator "</span>, <span class="hljs-keyword">this</span>.Excavator.id, <span class="hljs-string">" at  "</span>, <span class="hljs-keyword">this</span>.Excavator.body.name, <span class="hljs-string">"?"</span>].join(<span class="hljs-string">''</span>))) {
                Lacuna.Pulser.Show();
                <span class="hljs-keyword">this</span>.Self.service.abandon_excavator({
                    session_id: Game.GetSession(),
                    building_id: <span class="hljs-keyword">this</span>.Self.building.id,
                    excavator_id: <span class="hljs-keyword">this</span>.Excavator.id
                }, {
                    success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> {</span>
                        YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"Archaeology.ExcavatorAbandon.success"</span>);
                        Lacuna.Pulser.Hide();
                        <span class="hljs-keyword">this</span>.Self.rpcSuccess(o);
                        <span class="hljs-keyword">var</span> excavators = <span class="hljs-keyword">this</span>.Self.excavators.excavators;
                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; excavators.length; i++) {
                            <span class="hljs-keyword">if</span> (excavators[i].id === <span class="hljs-keyword">this</span>.Excavator.id) {
                                excavators.splice(i, <span class="hljs-number">1</span>);
                                <span class="hljs-keyword">break</span>;
                            }
                        }
                        <span class="hljs-keyword">this</span>.Line.parentNode.removeChild(<span class="hljs-keyword">this</span>.Line);
                    },
                    scope: <span class="hljs-keyword">this</span>
                });
            }
        },
        <span class="hljs-comment">//wee</span>
        populateSearch: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> sel = Dom.get(<span class="hljs-string">"archaeologyOre"</span>);
            <span class="hljs-keyword">if</span> (sel &amp;&amp; <span class="hljs-keyword">this</span>.ore) {
                sel.options.length = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">var</span> opt = document.createElement(<span class="hljs-string">"option"</span>),
                    ore = [],
                    oKey;
                <span class="hljs-keyword">for</span> (oKey <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>.ore) {
                    ore.push(oKey);
                }
                ore.sort();
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ore.length; i++) {
                    oKey = ore[i];
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.ore.hasOwnProperty(oKey)) {
                        <span class="hljs-keyword">var</span> nOpt = opt.cloneNode(<span class="hljs-literal">false</span>);
                        nOpt.value = oKey;
                        nOpt.innerHTML = [oKey, <span class="hljs-string">' ('</span>, <span class="hljs-keyword">this</span>.ore[oKey], <span class="hljs-string">')'</span>].join(<span class="hljs-string">''</span>);
                        sel.appendChild(nOpt);
                    }
                }
                <span class="hljs-keyword">if</span> (sel.options.length &gt; <span class="hljs-number">0</span>) {
                    Dom.setStyle(<span class="hljs-string">"archaeologySearchForm"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">""</span>);
                    Dom.setStyle(<span class="hljs-string">"archaeologySearchNone"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"none"</span>);
                }
                <span class="hljs-keyword">else</span> {
                    Dom.setStyle(<span class="hljs-string">"archaeologySearchForm"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"none"</span>);
                    Dom.setStyle(<span class="hljs-string">"archaeologySearchNone"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">""</span>);
                }
            }
        },
        populateActiveSearch: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(seconds_remaining)</span> {</span>
            <span class="hljs-keyword">this</span>.addQueue(seconds_remaining, <span class="hljs-keyword">this</span>.searchQueue, <span class="hljs-string">"archaeologySearchTime"</span>);
        },
        searchQueue: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(remaining, el)</span> {</span>
            <span class="hljs-keyword">if</span> (remaining &lt;= <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">var</span> span = Dom.get(el),
                    p = span.parentNode;
                p.removeChild(span);
                p.innerHTML = <span class="hljs-string">"Search Complete"</span>;
            }
            <span class="hljs-keyword">else</span> {
                Dom.get(el)
                    .innerHTML = Lib.formatTime(<span class="hljs-built_in">Math</span>.round(remaining));
            }
        },
        populateView: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> glyphs = <span class="hljs-keyword">this</span>.glyphs,
                details = Dom.get(<span class="hljs-string">"archaeologyGlyphDetails"</span>);
            <span class="hljs-keyword">if</span> (details) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.glyphList) {
                    <span class="hljs-keyword">this</span>.glyphList = <span class="hljs-keyword">new</span> Util.DDTarget(<span class="hljs-string">"archaeologyGlyphDetails"</span>);
                    <span class="hljs-keyword">this</span>.glyphList.isGlyphContainer = <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">var</span> gl = Sel.query(<span class="hljs-string">"li"</span>, <span class="hljs-string">"archaeologyGlyphDetails"</span>);
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> gli = <span class="hljs-number">0</span>, glLen = gl.length; gli &lt; glLen; gli++) {
                        <span class="hljs-keyword">var</span> glio = gl[gli];
                        glio.DD.unreg();
                        glio.parentNode.removeChild(glio);
                        glio = <span class="hljs-literal">null</span>;
                    }
                }
                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.glyphCombine) {
                    <span class="hljs-keyword">this</span>.glyphCombine = <span class="hljs-keyword">new</span> Util.DDTarget(<span class="hljs-string">"archaeologyGlyphCombine"</span>);
                    <span class="hljs-keyword">this</span>.glyphCombine.isGlyphContainer = <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">var</span> gc = Sel.query(<span class="hljs-string">"li"</span>, <span class="hljs-string">"archaeologyGlyphCombine"</span>);
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> gci = <span class="hljs-number">0</span>, gcLen = gc.length; gci &lt; gcLen; gci++) {
                        <span class="hljs-keyword">var</span> gcio = gc[gci];
                        gcio.DD.unreg();
                        gcio.parentNode.removeChild(gcio);
                        gcio = <span class="hljs-literal">null</span>;
                    }
                }
                <span class="hljs-keyword">var</span> li = document.createElement(<span class="hljs-string">"li"</span>);
                <span class="hljs-comment">//glyphs.slice(0);</span>
                glyphs.sort(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a, b)</span> {</span>
                    <span class="hljs-keyword">if</span> (a.type &gt; b.type) {
                        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
                    }
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (a.type &lt; b.type) {
                        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
                    }
                    <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
                    }
                });
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; glyphs.length; i++) {
                    <span class="hljs-keyword">var</span> obj = glyphs[i],
                        nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    nLi.Glyph = obj;
                    Dom.addClass(nLi, <span class="hljs-string">"archaeologyGlyph"</span>);
                    nLi.innerHTML = [<span class="hljs-string">'&lt;div class="archaeologyGlyphContainer"&gt;'</span>, <span class="hljs-string">'  &lt;div class="archaeologyGlyphHeader"&gt;'</span>, obj.type, <span class="hljs-string">' ('</span>, obj.quantity, <span class="hljs-string">')&lt;/div&gt;'</span>, <span class="hljs-string">'  &lt;img src="'</span>, Lib.AssetUrl, <span class="hljs-string">'glyphs/'</span>, obj.type, <span class="hljs-string">'.png" alt="'</span>, obj.type, <span class="hljs-string">'" title="'</span>, obj.type, <span class="hljs-string">'" style="width:79px;height:100px;" /&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>].join(<span class="hljs-string">''</span>);
                    nLi = details.appendChild(nLi);
                    nLi.DD = <span class="hljs-keyword">new</span> DDList(nLi);
                }
            }
        },
        viewAdd: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e, matchedEl, container)</span> {</span>
            matchedEl.parentNode.removeChild(matchedEl);
            Dom.get(<span class="hljs-string">"archaeologyGlyphCombine"</span>)
                .appendChild(matchedEl);
        },
        viewRemove: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e, matchedEl, container)</span> {</span>
            matchedEl.parentNode.removeChild(matchedEl);
            Dom.get(<span class="hljs-string">"archaeologyGlyphDetails"</span>)
                .appendChild(matchedEl);
        },
        checkIfWorking: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.work &amp;&amp; <span class="hljs-keyword">this</span>.work.seconds_remaining) {
                Dom.setStyle(<span class="hljs-string">"archaeologySearchContainer"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"none"</span>);
                Dom.setStyle(<span class="hljs-string">"archaeologyWorkingContainer"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">""</span>);
                Dom.get(<span class="hljs-string">"archaeologySearchOre"</span>)
                    .innerHTML = <span class="hljs-keyword">this</span>.work.searching;
                <span class="hljs-keyword">this</span>.populateActiveSearch(<span class="hljs-keyword">this</span>.work.seconds_remaining);
            }
            <span class="hljs-keyword">else</span> {
                Dom.setStyle(<span class="hljs-string">"archaeologySearchContainer"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">""</span>);
                Dom.setStyle(<span class="hljs-string">"archaeologyWorkingContainer"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"none"</span>);
                <span class="hljs-keyword">this</span>.getOres();
            }
        },
        getOres: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.ore) {
                Lacuna.Pulser.Show();
                <span class="hljs-keyword">this</span>.service.get_ores_available_for_processing({
                    session_id: Game.GetSession(),
                    building_id: <span class="hljs-keyword">this</span>.building.id
                }, {
                    success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> {</span>
                        YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"Archaeology.getOres.success"</span>);
                        Lacuna.Pulser.Hide();
                        <span class="hljs-keyword">this</span>.rpcSuccess(o);
                        <span class="hljs-keyword">this</span>.ore = o.result.ore;
                        <span class="hljs-keyword">this</span>.populateSearch();
                    },
                    scope: <span class="hljs-keyword">this</span>
                });
            }
        },
        getGlyphs: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.glyphs) {
                Lacuna.Pulser.Show();
                <span class="hljs-keyword">this</span>.service.get_glyphs({
                    session_id: Game.GetSession(),
                    building_id: <span class="hljs-keyword">this</span>.building.id
                }, {
                    success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> {</span>
                        YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"Archaeology.getGlyphs.success"</span>);
                        Lacuna.Pulser.Hide();
                        <span class="hljs-keyword">this</span>.rpcSuccess(o);
                        <span class="hljs-keyword">this</span>.glyphs = o.result.glyphs;
                        <span class="hljs-keyword">this</span>.populateView();
                    },
                    scope: <span class="hljs-keyword">this</span>
                });
            }
        },
        assembleGlyph: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            Lacuna.Pulser.Show();
            <span class="hljs-keyword">var</span> glyphs = Sel.query(<span class="hljs-string">"li"</span>, <span class="hljs-string">"archaeologyGlyphCombine"</span>),
                glyphTypes = [],
                quantity = <span class="hljs-built_in">parseInt</span>(Dom.get(<span class="hljs-string">"combineQuantity"</span>)
                    .value, <span class="hljs-number">10</span>);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> g = <span class="hljs-number">0</span>, len = glyphs.length; g &lt; len; g++) {
                glyphTypes.push(glyphs[g].Glyph.type);
            }
            <span class="hljs-keyword">this</span>.service.assemble_glyphs({
                session_id: Game.GetSession(),
                building_id: <span class="hljs-keyword">this</span>.building.id,
                glyphs: glyphTypes,
                quantity: quantity
            }, {
                success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> {</span>
                    YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"Archaeology.assembleGlyph.success"</span>);
                    <span class="hljs-keyword">var</span> article = (quantity == <span class="hljs-number">1</span>) ? <span class="hljs-string">"a"</span> : quantity;
                    <span class="hljs-keyword">var</span> suffix = (quantity == <span class="hljs-number">1</span>) ? <span class="hljs-string">"plan"</span> : <span class="hljs-string">"plans"</span>;
                    alert(<span class="hljs-string">"You have found "</span> + article + <span class="hljs-string">" "</span> + o.result.item_name + <span class="hljs-string">" "</span> + suffix + <span class="hljs-string">"!"</span>);
                    Lacuna.Pulser.Hide();
                    <span class="hljs-keyword">this</span>.rpcSuccess(o);
                    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.glyphs;
                    <span class="hljs-keyword">this</span>.getGlyphs();
                },
                scope: <span class="hljs-keyword">this</span>
            });
        },
        searchForGlyph: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            Lacuna.Pulser.Show();
            <span class="hljs-keyword">var</span> sel = Dom.get(<span class="hljs-string">"archaeologyOre"</span>),
                opts = sel.options,
                selInd = sel.selectedIndex,
                type = opts.length &gt; <span class="hljs-number">0</span> &amp;&amp; selInd &gt;= <span class="hljs-number">0</span> &amp;&amp; opts[selInd].value;
            <span class="hljs-keyword">if</span> (type) {
                <span class="hljs-keyword">this</span>.service.search_for_glyph({
                    session_id: Game.GetSession(),
                    building_id: <span class="hljs-keyword">this</span>.building.id,
                    ore_type: type
                }, {
                    success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> {</span>
                        YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"Archaeology.searchForGlyph.success"</span>);
                        Lacuna.Pulser.Hide();
                        <span class="hljs-keyword">this</span>.rpcSuccess(o);
                        <span class="hljs-comment">//this.work = o.result.building.work;</span>
                        <span class="hljs-comment">//this.updateBuildingTile(o.result.building);</span>
                        <span class="hljs-keyword">this</span>.checkIfWorking();
                    },
                    scope: <span class="hljs-keyword">this</span>
                });
            }
        },
        Subsidize: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            Lacuna.Pulser.Show();
            <span class="hljs-keyword">this</span>.service.subsidize_search({
                session_id: Game.GetSession(),
                building_id: <span class="hljs-keyword">this</span>.building.id
            }, {
                success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> {</span>
                    Lacuna.Pulser.Hide();
                    <span class="hljs-keyword">this</span>.rpcSuccess(o);
                    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.work;
                    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.ore;
                    <span class="hljs-keyword">this</span>.updateBuildingTile(o.result.building);
                    <span class="hljs-keyword">this</span>.resetQueue();
                    Dom.get(<span class="hljs-string">"archaeologySearchTime"</span>)
                        .innerHTML = <span class="hljs-string">""</span>;
                    <span class="hljs-keyword">this</span>.checkIfWorking();
                },
                scope: <span class="hljs-keyword">this</span>
            });
        }
    });
    Lacuna.buildings.Archaeology = Archaeology;
})();
</pre></div>
      
      </div>
    
    </div>
  </div>

  <script src="../../../toc.js"></script>
  <script src="../../../assets/libs.js"></script>
  <script src="../../../assets/behavior.js"></script>
</body>
</html>