<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title> - spacePort.js</title>

  <link rel="stylesheet" href="../../../assets/style.css">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"/>
  <meta name="groc-relative-root" content="../../../"/>
  <meta name="groc-document-path" content="app/js/building/spacePort.js"/>
  
</head>
<body>
  <div id="file-area">
    <div id="meta">
      <code class="file-path">
      
        app/js/building/spacePort.js
      
      </code>
    </div>
    <div id="document">
    
      <div class="segment">
      
      
        <div class="code"><pre class="wrapper"><span class="hljs-pi">'use strict'</span>;
YAHOO.namespace(<span class="hljs-string">"lacuna.buildings"</span>);
(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> Lang = YAHOO.lang,
        Util = YAHOO.util,
        Dom = Util.Dom,
        Event = Util.Event,
        Sel = Util.Selector,
        Pager = YAHOO.widget.Paginator,
        Lacuna = YAHOO.lacuna,
        Game = Lacuna.Game,
        Lib = Lacuna.Library;
    <span class="hljs-keyword">var</span> SpacePort = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(result)</span> {</span>
        SpacePort.superclass.constructor.call(<span class="hljs-keyword">this</span>, result);
        <span class="hljs-keyword">this</span>.service = Game.Services.Buildings.SpacePort;
    };
    Lang.extend(SpacePort, Lacuna.buildings.Building, {
        destroy: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.shipsPager) {
                <span class="hljs-keyword">this</span>.shipsPager.destroy();
            }
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.viewPager) {
                <span class="hljs-keyword">this</span>.viewPager.destroy();
            }
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.foreignPager) {
                <span class="hljs-keyword">this</span>.foreignPager.destroy();
            }
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.orbitingPager) {
                <span class="hljs-keyword">this</span>.orbitingPager.destroy();
            }
            SpacePort.superclass.destroy.call(<span class="hljs-keyword">this</span>);
        },
        getChildTabs: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> [<span class="hljs-keyword">this</span>._getTravelTab(), <span class="hljs-keyword">this</span>._getViewTab(), <span class="hljs-keyword">this</span>._getOrbitingTab(), <span class="hljs-keyword">this</span>._getForeignTab(), <span class="hljs-keyword">this</span>._getLogsTab(), <span class="hljs-keyword">this</span>._getSendTab(), <span class="hljs-keyword">this</span>._getSendFleetTab()];
        },
        _getTravelTab: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">this</span>.travelTab = <span class="hljs-keyword">new</span> YAHOO.widget.Tab({
                label: <span class="hljs-string">"Travelling"</span>,
                content: [<span class="hljs-string">'&lt;div&gt;'</span>, <span class="hljs-string">'    &lt;div style="overflow:auto;margin-top:2px;"&gt;'</span>, <span class="hljs-string">'        &lt;ul id="shipDetails"&gt;&lt;/ul&gt;'</span>, <span class="hljs-string">'    &lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;div id="shipsPaginator"&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>].join(<span class="hljs-string">''</span>)
            });
            <span class="hljs-comment">//subscribe after adding so active doesn't fire</span>
            <span class="hljs-keyword">this</span>.travelTab.subscribe(<span class="hljs-string">"activeChange"</span>, <span class="hljs-keyword">this</span>.getTravel, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.travelTab;
        },
        _getViewTab: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">this</span>.viewShipsTab = <span class="hljs-keyword">new</span> YAHOO.widget.Tab({
                label: <span class="hljs-string">"View"</span>,
                content: [<span class="hljs-string">'&lt;div&gt;'</span>, <span class="hljs-string">'    &lt;div class="yui-ge" style="border-bottom:1px solid #52acff;"&gt;&lt;div id="shipsCount" class="yui-u first"&gt;&lt;/div&gt;&lt;div class="yui-u"&gt;&lt;button type="button" id="shipsRecallAll" style="display:none;"&gt;Recall All&lt;/button&gt;&lt;/div&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;div style="overflow:auto;margin-top:2px;"&gt;&lt;ul id="shipsViewDetails"&gt;&lt;/ul&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;div id="shipsViewPaginator"&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>].join(<span class="hljs-string">''</span>)
            });
            <span class="hljs-comment">//subscribe after adding so active doesn't fire</span>
            <span class="hljs-keyword">this</span>.viewShipsTab.subscribe(<span class="hljs-string">"activeChange"</span>, <span class="hljs-keyword">this</span>.getShips, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            Event.on(<span class="hljs-string">"shipsRecallAll"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.ShipRecallAll, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.viewShipsTab;
        },
        _getOrbitingTab: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">this</span>.viewOrbitingTab = <span class="hljs-keyword">new</span> YAHOO.widget.Tab({
                label: <span class="hljs-string">"Foreign Orbiting"</span>,
                content: [<span class="hljs-string">'&lt;div&gt;'</span>, <span class="hljs-string">'    &lt;ul class="shipHeader shipInfo clearafter"&gt;'</span>, <span class="hljs-string">'        &lt;li class="shipTypeImage"&gt;&amp;nbsp;&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li class="shipName"&gt;Name&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li class="shipArrives"&gt;Arrived&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li class="shipFrom"&gt;From&lt;/li&gt;'</span>, <span class="hljs-string">'    &lt;/ul&gt;'</span>, <span class="hljs-string">'    &lt;div&gt;&lt;div id="shipsOrbitingDetails"&gt;&lt;/div&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;div id="shipsOrbitingPaginator"&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>].join(<span class="hljs-string">''</span>)
            });
            <span class="hljs-keyword">this</span>.viewOrbitingTab.subscribe(<span class="hljs-string">"activeChange"</span>, <span class="hljs-keyword">this</span>.getOrbiting, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.viewOrbitingTab;
        },
        _getForeignTab: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">this</span>.foreignShipsTab = <span class="hljs-keyword">new</span> YAHOO.widget.Tab({
                label: <span class="hljs-string">"Incoming"</span>,
                content: [<span class="hljs-string">'&lt;div&gt;'</span>, <span class="hljs-string">'    &lt;ul class="shipHeader shipInfo clearafter"&gt;'</span>, <span class="hljs-string">'        &lt;li class="shipTypeImage"&gt;&amp;nbsp;&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li class="shipName"&gt;Name&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li class="shipArrives"&gt;Arrives&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li class="shipFrom"&gt;From&lt;/li&gt;'</span>, <span class="hljs-string">'    &lt;/ul&gt;'</span>, <span class="hljs-string">'    &lt;div&gt;&lt;div id="shipsForeignDetails"&gt;&lt;/div&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;div id="shipsForeignPaginator"&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>].join(<span class="hljs-string">''</span>)
            });
            <span class="hljs-comment">//subscribe after adding so active doesn't fire</span>
            <span class="hljs-keyword">this</span>.foreignShipsTab.subscribe(<span class="hljs-string">"activeChange"</span>, <span class="hljs-keyword">this</span>.getForeign, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.foreignShipsTab;
        },
        _getLogsTab: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">this</span>.battleLogsTab = <span class="hljs-keyword">new</span> YAHOO.widget.Tab({
                label: <span class="hljs-string">"Battle Logs"</span>,
                content: [<span class="hljs-string">'&lt;div&gt;'</span>, <span class="hljs-string">'    &lt;ul class="shipHeader shipInfo clearafter" style="padding-left:5px; padding-right:5px;"&gt;'</span>, <span class="hljs-string">'        &lt;li class="shipTask"&gt;Role&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li class="shipName"&gt;Name&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li class="shipFrom"&gt;From&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li&gt;Details&lt;/li&gt;'</span>, <span class="hljs-string">'    &lt;/ul&gt;'</span>, <span class="hljs-string">'    &lt;div&gt;&lt;div id="battleLogsDetails"&gt;&lt;/div&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;div id="battleLogsPaginator"&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>].join(<span class="hljs-string">''</span>)
            });
            <span class="hljs-comment">//subscribe after adding so active doesn't fire</span>
            <span class="hljs-keyword">this</span>.battleLogsTab.subscribe(<span class="hljs-string">"activeChange"</span>, <span class="hljs-keyword">this</span>.getLogs, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.battleLogsTab;
        },
        _getSendTab: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">this</span>.sendTab = <span class="hljs-keyword">new</span> YAHOO.widget.Tab({
                label: <span class="hljs-string">"Send"</span>,
                content: [<span class="hljs-string">'&lt;div id="sendShipPick"&gt;'</span>, <span class="hljs-string">'    Send To &lt;select id="sendShipType"&gt;&lt;option value="body_name"&gt;Planet Name&lt;/option&gt;&lt;option value="body_id"&gt;Planet Id&lt;/option&gt;&lt;option value="star_name"&gt;Star Name&lt;/option&gt;&lt;option value="star_id"&gt;Star Id&lt;/option&gt;&lt;option value="xy"&gt;X,Y&lt;/option&gt;&lt;/select&gt;'</span>, <span class="hljs-string">'    &lt;span id="sendShipTargetSelectText"&gt;&lt;input type="text" id="sendShipTargetText" /&gt;&lt;/span&gt;'</span>, <span class="hljs-string">'    &lt;span id="sendShipTargetSelectXY" style="display:none;"&gt;X:&lt;input type="text" id="sendShipTargetX" /&gt; Y:&lt;input type="text" id="sendShipTargetY" /&gt;&lt;/span&gt;'</span>, <span class="hljs-string">'    &lt;button type="button" id="sendShipGet"&gt;Get Available Ships For Target&lt;/button&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>, <span class="hljs-string">'&lt;div id="sendShipSend" style="display:none;border-top:1px solid #52ACFF;margin-top:5px;padding-top:5px"&gt;'</span>, <span class="hljs-string">'    Sending ships to: &lt;span id="sendShipNote"&gt;&lt;/span&gt;'</span>, <span class="hljs-string">'    &lt;div style="border-top:1px solid #52ACFF;margin-top:5px;"&gt;&lt;ul id="sendShipAvail"&gt;&lt;/ul&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>].join(<span class="hljs-string">''</span>)
            });
            Event.on(<span class="hljs-string">"sendShipType"</span>, <span class="hljs-string">"change"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">if</span> (Lib.getSelectedOptionValue(<span class="hljs-keyword">this</span>) === <span class="hljs-string">"xy"</span>) {
                    Dom.setStyle(<span class="hljs-string">"sendShipTargetSelectText"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"none"</span>);
                    Dom.setStyle(<span class="hljs-string">"sendShipTargetSelectXY"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">""</span>);
                } <span class="hljs-keyword">else</span> {
                    Dom.setStyle(<span class="hljs-string">"sendShipTargetSelectText"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">""</span>);
                    Dom.setStyle(<span class="hljs-string">"sendShipTargetSelectXY"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"none"</span>);
                }
            });
            Event.on(<span class="hljs-string">"sendShipGet"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.GetShipsFor, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.sendTab;
        },
        _getSendFleetTab: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">this</span>.sendFleetTab = <span class="hljs-keyword">new</span> YAHOO.widget.Tab({
                label: <span class="hljs-string">"Fleet"</span>,
                content: [<span class="hljs-string">'&lt;div id="sendFleetPick"&gt;'</span>, <span class="hljs-string">'    Send To &lt;select id="sendFleetType"&gt;&lt;option value="body_name"&gt;Planet Name&lt;/option&gt;&lt;option value="body_id"&gt;Planet Id&lt;/option&gt;&lt;option value="star_name"&gt;Star Name&lt;/option&gt;&lt;option value="star_id"&gt;Star Id&lt;/option&gt;&lt;option value="xy"&gt;X,Y&lt;/option&gt;&lt;/select&gt;'</span>, <span class="hljs-string">'    &lt;span id="sendFleetTargetSelectText"&gt;&lt;input type="text" id="sendFleetTargetText" /&gt;&lt;/span&gt;'</span>, <span class="hljs-string">'    &lt;span id="sendFleetTargetSelectXY" style="display:none;"&gt;X:&lt;input type="text" id="sendFleetTargetX" /&gt; Y:&lt;input type="text" id="sendFleetTargetY" /&gt;&lt;/span&gt;'</span>, <span class="hljs-string">'    &lt;button type="button" id="sendFleetGet"&gt;Get Available Ships For Target&lt;/button&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>, <span class="hljs-string">'&lt;div id="sendFleetSend" style="display:none;border-top:1px solid #52ACFF;margin-top:5px;padding-top:5px"&gt;'</span>, <span class="hljs-string">'    &lt;div class="yui-g"&gt;&lt;div class="yui-u first"&gt;Sending ships to: &lt;span id="sendFleetNote"&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class="yui-u" style="text-align:right;"&gt;Set speed:&lt;input type="text" id="setSpeed" value="0" size="6"&gt;&lt;button type="button" id="sendFleetSubmit"&gt;Send Fleet&lt;/button&gt;&lt;/div&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;div style="border-top:1px solid #52ACFF;margin-top:5px;"&gt;&lt;ul id="sendFleetAvail"&gt;&lt;/ul&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>].join(<span class="hljs-string">''</span>)
            });
            Event.on(<span class="hljs-string">"sendFleetType"</span>, <span class="hljs-string">"change"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">if</span> (Lib.getSelectedOptionValue(<span class="hljs-keyword">this</span>) === <span class="hljs-string">"xy"</span>) {
                    Dom.setStyle(<span class="hljs-string">"sendFleetTargetSelectText"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"none"</span>);
                    Dom.setStyle(<span class="hljs-string">"sendFleetTargetSelectXY"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">""</span>);
                } <span class="hljs-keyword">else</span> {
                    Dom.setStyle(<span class="hljs-string">"sendFleetTargetSelectText"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">""</span>);
                    Dom.setStyle(<span class="hljs-string">"sendFleetTargetSelectXY"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"none"</span>);
                }
            });
            Event.on(<span class="hljs-string">"sendFleetGet"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.GetFleetFor, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            Event.on(<span class="hljs-string">"sendFleetSubmit"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.FleetSend, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.sendFleetTab;
        },
        getTravel: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
            <span class="hljs-keyword">if</span> (e.newValue) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.shipsTravelling) {
                    Lacuna.Pulser.Show();
                    <span class="hljs-keyword">this</span>.service.view_ships_travelling({
                        session_id: Game.GetSession(),
                        building_id: <span class="hljs-keyword">this</span>.building.id,
                        page_number: <span class="hljs-number">1</span>
                    }, {
                        success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                            YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"SpacePort.view_ships_travelling.success"</span>);
                            Lacuna.Pulser.Hide();
                            <span class="hljs-keyword">this</span>.rpcSuccess(o);
                            <span class="hljs-keyword">this</span>.shipsTravelling = {
                                number_of_ships_travelling: o.result.number_of_ships_travelling,
                                ships_travelling: o.result.ships_travelling
                            };
                            <span class="hljs-keyword">this</span>.shipsPager = <span class="hljs-keyword">new</span> Pager({
                                rowsPerPage: <span class="hljs-number">25</span>,
                                totalRecords: o.result.number_of_ships_travelling,
                                containers: <span class="hljs-string">'shipsPaginator'</span>,
                                template: <span class="hljs-string">"{PreviousPageLink} {PageLinks} {NextPageLink}"</span>,
                                alwaysVisible: <span class="hljs-literal">false</span>
                            });
                            <span class="hljs-keyword">this</span>.shipsPager.subscribe(<span class="hljs-string">'changeRequest'</span>, <span class="hljs-keyword">this</span>.ShipHandlePagination, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                            <span class="hljs-keyword">this</span>.shipsPager.render();
                            <span class="hljs-keyword">this</span>.SpacePortPopulate();
                        },
                        scope: <span class="hljs-keyword">this</span>
                    });
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">this</span>.SpacePortPopulate();
                }
            }
        },
        getShips: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
            <span class="hljs-keyword">if</span> (e.newValue) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.shipsView) {
                    Lacuna.Pulser.Show();
                    <span class="hljs-keyword">this</span>.service.view_all_ships({
                        session_id: Game.GetSession(),
                        building_id: <span class="hljs-keyword">this</span>.building.id,
                        paging: {
                            page_number: <span class="hljs-number">1</span>
                        }
                    }, {
                        success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                            YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"SpacePort.view_all_ships.success"</span>);
                            Lacuna.Pulser.Hide();
                            <span class="hljs-keyword">this</span>.rpcSuccess(o);
                            <span class="hljs-keyword">this</span>.shipsView = {
                                number_of_ships: o.result.number_of_ships,
                                ships: o.result.ships
                            };
                            <span class="hljs-keyword">this</span>.viewPager = <span class="hljs-keyword">new</span> Pager({
                                rowsPerPage: <span class="hljs-number">25</span>,
                                totalRecords: o.result.number_of_ships,
                                containers: <span class="hljs-string">'shipsViewPaginator'</span>,
                                template: <span class="hljs-string">"{PreviousPageLink} {PageLinks} {NextPageLink}"</span>,
                                alwaysVisible: <span class="hljs-literal">false</span>
                            });
                            <span class="hljs-keyword">this</span>.viewPager.subscribe(<span class="hljs-string">'changeRequest'</span>, <span class="hljs-keyword">this</span>.ViewHandlePagination, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                            <span class="hljs-keyword">this</span>.viewPager.render();
                            <span class="hljs-keyword">this</span>.ViewPopulate();
                        },
                        scope: <span class="hljs-keyword">this</span>
                    });
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">this</span>.ViewPopulate();
                }
            }
        },
        getForeign: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
            <span class="hljs-keyword">if</span> (e.newValue) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.shipsForeign) {
                    Lacuna.Pulser.Show();
                    <span class="hljs-keyword">this</span>.service.view_foreign_ships({
                        session_id: Game.GetSession(),
                        building_id: <span class="hljs-keyword">this</span>.building.id,
                        page_number: <span class="hljs-number">1</span>
                    }, {
                        success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                            YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"SpacePort.view_foreign_ships.success"</span>);
                            Lacuna.Pulser.Hide();
                            <span class="hljs-keyword">this</span>.rpcSuccess(o);
                            <span class="hljs-keyword">this</span>.shipsForeign = {
                                number_of_ships: o.result.number_of_ships,
                                ships: o.result.ships
                            };
                            <span class="hljs-keyword">this</span>.foreignPager = <span class="hljs-keyword">new</span> Pager({
                                rowsPerPage: <span class="hljs-number">25</span>,
                                totalRecords: o.result.number_of_ships,
                                containers: <span class="hljs-string">'shipsForeignPaginator'</span>,
                                template: <span class="hljs-string">"{PreviousPageLink} {PageLinks} {NextPageLink}"</span>,
                                alwaysVisible: <span class="hljs-literal">false</span>
                            });
                            <span class="hljs-keyword">this</span>.foreignPager.subscribe(<span class="hljs-string">'changeRequest'</span>, <span class="hljs-keyword">this</span>.ForeignHandlePagination, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                            <span class="hljs-keyword">this</span>.foreignPager.render();
                            <span class="hljs-keyword">this</span>.ForeignPopulate();
                        },
                        scope: <span class="hljs-keyword">this</span>
                    });
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">this</span>.ForeignPopulate();
                }
            }
        },
        getLogs: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
            <span class="hljs-keyword">if</span> (e.newValue) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.battleLogs) {
                    Lacuna.Pulser.Show();
                    <span class="hljs-keyword">this</span>.service.view_battle_logs({
                        session_id: Game.GetSession(),
                        building_id: <span class="hljs-keyword">this</span>.building.id
                    }, {
                        success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                            YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"SpacePort.view_battle_logs.success"</span>);
                            Lacuna.Pulser.Hide();
                            <span class="hljs-keyword">this</span>.rpcSuccess(o);
                            <span class="hljs-keyword">this</span>.battleLogs = {
                                number_of_logs: o.result.number_of_logs,
                                battle_log: o.result.battle_log
                            };
                            <span class="hljs-keyword">this</span>.logsPager = <span class="hljs-keyword">new</span> Pager({
                                rowsPerPage: <span class="hljs-number">25</span>,
                                totalRecords: o.result.number_of_logs,
                                containers: <span class="hljs-string">'battleLogsPaginator'</span>,
                                template: <span class="hljs-string">"{PreviousPageLink} {PageLinks} {NextPageLink}"</span>,
                                alwaysVisible: <span class="hljs-literal">false</span>
                            });
                            <span class="hljs-keyword">this</span>.logsPager.subscribe(<span class="hljs-string">'changeRequest'</span>, <span class="hljs-keyword">this</span>.LogsHandlePagination, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                            <span class="hljs-keyword">this</span>.logsPager.render();
                            <span class="hljs-keyword">this</span>.LogsPopulate();
                        },
                        scope: <span class="hljs-keyword">this</span>
                    });
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">this</span>.LogsPopulate();
                }
            }
        },
        getOrbiting: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
            <span class="hljs-keyword">if</span> (e.newValue) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.shipsOrbiting) {
                    Lacuna.Pulser.Show();
                    <span class="hljs-keyword">this</span>.service.view_ships_orbiting({
                        session_id: Game.GetSession(),
                        building_id: <span class="hljs-keyword">this</span>.building.id
                    }, {
                        success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                            Lacuna.Pulser.Hide();
                            <span class="hljs-keyword">this</span>.rpcSuccess(o);
                            <span class="hljs-keyword">this</span>.shipsOrbiting = {
                                number_of_ships: o.result.number_of_ships,
                                ships: o.result.ships
                            };
                            <span class="hljs-keyword">this</span>.orbitingPager = <span class="hljs-keyword">new</span> Pager({
                                rowsPerPage: <span class="hljs-number">25</span>,
                                totalRecords: o.result.number_of_ships,
                                containers: <span class="hljs-string">'shipsOrbitingPaginator'</span>,
                                template: <span class="hljs-string">"{PreviousPageLink} {PageLinks} {NextPageLink}"</span>,
                                alwaysVisible: <span class="hljs-literal">false</span>
                            });
                            <span class="hljs-keyword">this</span>.orbitingPager.subscribe(<span class="hljs-string">'changeRequest'</span>, <span class="hljs-keyword">this</span>.OrbitingHandlePagination, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                            <span class="hljs-keyword">this</span>.orbitingPager.render();
                            <span class="hljs-keyword">this</span>.OrbitingPopulate();
                        },
                        scope: <span class="hljs-keyword">this</span>
                    });
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">this</span>.OrbitingPopulate();
                }
            }
        },
        SpacePortPopulate: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> ships = <span class="hljs-keyword">this</span>.shipsTravelling.ships_travelling,
                details = Dom.get(<span class="hljs-string">"shipDetails"</span>);
            <span class="hljs-keyword">if</span> (details) {
                <span class="hljs-keyword">var</span> parentEl = details.parentNode,
                    li = document.createElement(<span class="hljs-string">"li"</span>),
                    serverTime = Lib.getTime(Game.ServerData.time);
                Event.purgeElement(details, <span class="hljs-literal">true</span>);
                details = parentEl.removeChild(details);
                details.innerHTML = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ships.length; i++) {
                    <span class="hljs-keyword">var</span> ship = ships[i],
                        nLi = li.cloneNode(<span class="hljs-literal">false</span>),
                        sec = (Lib.getTime(ship.date_arrives) - serverTime) / <span class="hljs-number">1000</span>;
                    nLi.innerHTML = [<span class="hljs-string">'&lt;div class="yui-g" style="margin-bottom:2px;"&gt;'</span>, <span class="hljs-string">'&lt;div class="yui-g first"&gt;'</span>, <span class="hljs-string">'    &lt;div class="yui-u first" style="background:transparent url('</span>, Lib.AssetUrl, <span class="hljs-string">'star_system/field.png) no-repeat center;text-align:center;"&gt;'</span>, <span class="hljs-string">'        &lt;img src="'</span>, Lib.AssetUrl, <span class="hljs-string">'ships/'</span>, ship.type, <span class="hljs-string">'.png" title="'</span>, ship.type_human, <span class="hljs-string">'" style="width:105px;height:105px;" /&gt;'</span>, <span class="hljs-string">'    &lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;div class="yui-u"&gt;'</span>, <span class="hljs-string">'        &lt;span class="shipName"&gt;'</span>, ship.name, <span class="hljs-string">'&lt;/span&gt;: '</span>, <span class="hljs-string">'        &lt;ul&gt;'</span>, <span class="hljs-string">'            &lt;li&gt;&lt;label style="font-weight:bold;"&gt;Travel:&lt;/label&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'            &lt;li style="white-space:nowrap;"&gt;&lt;label style="font-style:italic"&gt;Arrives In: &lt;/label&gt;&lt;span class="shipArrives"&gt;'</span>, Lib.formatTime(sec), <span class="hljs-string">'&lt;/span&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'            &lt;li style="white-space:nowrap;"&gt;&lt;label style="font-style:italic"&gt;From: &lt;/label&gt;&lt;span class="shipFrom"&gt;'</span>, ship.from.name, <span class="hljs-string">'&lt;/span&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'            &lt;li style="white-space:nowrap;"&gt;&lt;label style="font-style:italic"&gt;To: &lt;/label&gt;&lt;span class="shipTo"&gt;'</span>, ship.to.name, <span class="hljs-string">'&lt;/span&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;/ul&gt;'</span>, <span class="hljs-string">'    &lt;/div&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>, <span class="hljs-string">'&lt;div class="yui-g"&gt;'</span>, <span class="hljs-string">'    &lt;div class="yui-u first"&gt;'</span>, <span class="hljs-string">'        &lt;ul&gt;'</span>, <span class="hljs-string">'        &lt;li&gt;&lt;label style="font-weight:bold;"&gt;Attributes:&lt;/label&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li style="white-space:nowrap;"&gt;&lt;label style="font-style:italic"&gt;Speed: &lt;/label&gt;'</span>, (ship.fleet_speed &gt; <span class="hljs-number">0</span> &amp;&amp; ship.fleet_speed &lt; ship.speed) ? ship.fleet_speed : ship.speed, <span class="hljs-string">'&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li style="white-space:nowrap;"&gt;&lt;label style="font-style:italic"&gt;Hold Size: &lt;/label&gt;'</span>, ship.hold_size, <span class="hljs-string">'&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li style="white-space:nowrap;"&gt;&lt;label style="font-style:italic"&gt;Stealth: &lt;/label&gt;'</span>, ship.stealth, <span class="hljs-string">'&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li style="white-space:nowrap;"&gt;&lt;label style="font-style:italic"&gt;Combat: &lt;/label&gt;'</span>, ship.combat, <span class="hljs-string">'&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li style="white-space:nowrap;"&gt;&lt;label style="font-style:italic"&gt;Occupants: &lt;/label&gt;'</span>, ship.max_occupants, <span class="hljs-string">'&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;/ul&gt;'</span>, <span class="hljs-string">'    &lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;div class="yui-u"&gt;'</span>, <span class="hljs-string">'        &lt;div&gt;&lt;label style="font-weight:bold;"&gt;Payload:&lt;/label&gt;&lt;/div&gt;'</span>,
                        Lib.formatInlineList(ship.payload), <span class="hljs-string">'    &lt;/div&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>
                    ].join(<span class="hljs-string">''</span>);
                    <span class="hljs-keyword">var</span> sn = Sel.query(<span class="hljs-string">"span.shipName"</span>, nLi, <span class="hljs-literal">true</span>);
                    Event.on(sn, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.ShipName, {
                        Self: <span class="hljs-keyword">this</span>,
                        Ship: ship,
                        el: sn
                    }, <span class="hljs-literal">true</span>);
                    <span class="hljs-comment">//Event.on(Sel.query("span.shipFrom",nLi,true), "click", this.EmpireProfile, ship.from);</span>
                    <span class="hljs-comment">//Event.on(Sel.query("span.shipTo",nLi,true), "click", this.EmpireProfile, ship.to);</span>
                    <span class="hljs-keyword">this</span>.addQueue(sec, <span class="hljs-keyword">this</span>.SpacePortQueue, nLi);
                    details.appendChild(nLi);
                }
                <span class="hljs-comment">//add child back in</span>
                parentEl.appendChild(details);
                <span class="hljs-comment">//wait for tab to display first</span>
                setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">var</span> Ht = Game.GetSize()
                        .h - <span class="hljs-number">220</span>;
                    <span class="hljs-keyword">if</span> (Ht &gt; <span class="hljs-number">300</span>) {
                        Ht = <span class="hljs-number">300</span>;
                    }
                    <span class="hljs-keyword">var</span> tC = details.parentNode;
                    Dom.setStyle(tC, <span class="hljs-string">"height"</span>, Ht + <span class="hljs-string">"px"</span>);
                    Dom.setStyle(tC, <span class="hljs-string">"overflow-y"</span>, <span class="hljs-string">"auto"</span>);
                }, <span class="hljs-number">10</span>);
            }
        },
        ShipHandlePagination: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newState)</span> {</span>
            Lacuna.Pulser.Show();
            <span class="hljs-keyword">this</span>.service.view_ships_travelling({
                session_id: Game.GetSession(),
                building_id: <span class="hljs-keyword">this</span>.building.id,
                page_number: newState.page
            }, {
                success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                    YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"SpacePort.ShipHandlePagination.view_ships_travelling.success"</span>);
                    Lacuna.Pulser.Hide();
                    <span class="hljs-keyword">this</span>.rpcSuccess(o);
                    <span class="hljs-keyword">this</span>.shipsTravelling = {
                        number_of_ships_travelling: o.result.number_of_ships_travelling,
                        ships_travelling: o.result.ships_travelling
                    };
                    <span class="hljs-keyword">this</span>.SpacePortPopulate();
                },
                scope: <span class="hljs-keyword">this</span>
            });</pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Update the Paginator&#39;s state</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">            <span class="hljs-keyword">this</span>.shipsPager.setState(newState);
        },
        SpacePortQueue: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(remaining, elLine)</span> {</span>
            <span class="hljs-keyword">var</span> arrTime;
            <span class="hljs-keyword">if</span> (remaining &lt;= <span class="hljs-number">0</span>) {
                arrTime = <span class="hljs-string">'Overdue '</span> + Lib.formatTime(<span class="hljs-built_in">Math</span>.round(-remaining));
            } <span class="hljs-keyword">else</span> {
                arrTime = Lib.formatTime(<span class="hljs-built_in">Math</span>.round(remaining));
            }
            Sel.query(<span class="hljs-string">"span.shipArrives"</span>, elLine, <span class="hljs-literal">true</span>)
                .innerHTML = arrTime;
        },
        ViewActionDetails: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(nLi, ship, noEvent)</span> {</span>
            <span class="hljs-keyword">var</span> ulDet = [<span class="hljs-string">'&lt;li style="white-space:nowrap;"&gt;&lt;label style="font-weight:bold;"&gt;'</span>, ship.task, <span class="hljs-string">'&lt;/label&gt;&lt;/li&gt;'</span>];
            <span class="hljs-keyword">if</span> (ship.task === <span class="hljs-string">"Docked"</span>) {
                ulDet[ulDet.length] = <span class="hljs-string">'&lt;li style="white-space:nowrap;margin-top:5px"&gt;&lt;button type="button" class="scuttle"&gt;Scuttle&lt;/button&gt;&lt;/li&gt;'</span>;
                <span class="hljs-keyword">if</span> (!noEvent) {
                    Event.delegate(nLi, <span class="hljs-string">'click'</span>, <span class="hljs-keyword">this</span>.ShipScuttle, <span class="hljs-string">'button.scuttle'</span>, {
                        Self: <span class="hljs-keyword">this</span>,
                        Ship: ship,
                        Line: nLi
                    }, <span class="hljs-literal">true</span>);
                }
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ship.task === <span class="hljs-string">"Travelling"</span>) {
                <span class="hljs-keyword">var</span> serverTime = Lib.getTime(Game.ServerData.time),
                    sec = (Lib.getTime(ship.date_arrives) - serverTime) / <span class="hljs-number">1000</span>;
                ulDet[ulDet.length] = <span class="hljs-string">'&lt;li style="white-space:nowrap;"&gt;&lt;label style="font-style:italic"&gt;Arrives In: &lt;/label&gt;&lt;span class="shipArrives"&gt;'</span>;
                ulDet[ulDet.length] = Lib.formatTime(sec);
                ulDet[ulDet.length] = <span class="hljs-string">'&lt;/span&gt;&lt;/li&gt;&lt;li style="white-space:nowrap;"&gt;&lt;label style="font-style:italic"&gt;From: &lt;/label&gt;&lt;span class="shipFrom"&gt;'</span>;
                ulDet[ulDet.length] = ship.from.name;
                ulDet[ulDet.length] = <span class="hljs-string">'&lt;/span&gt;&lt;/li&gt;&lt;li style="white-space:nowrap;"&gt;&lt;label style="font-style:italic"&gt;To: &lt;/label&gt;&lt;span class="shipTo"&gt;'</span>;
                ulDet[ulDet.length] = ship.to.name;
                ulDet[ulDet.length] = <span class="hljs-string">'&lt;/span&gt;&lt;/li&gt;'</span>;
                <span class="hljs-keyword">this</span>.addQueue(sec, <span class="hljs-keyword">this</span>.SpacePortQueue, nLi);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ship.task === <span class="hljs-string">"Defend"</span> || ship.task === <span class="hljs-string">"Orbiting"</span>) {
                ulDet[ulDet.length] = <span class="hljs-string">'&lt;li style="white-space:nowrap;"&gt;&lt;span class="shipTo"&gt;'</span>;
                ulDet[ulDet.length] = ship.orbiting.name;
                ulDet[ulDet.length] = <span class="hljs-string">'&lt;/span&gt;&lt;/li&gt;&lt;li style="white-space:nowrap;margin-top:5px"&gt;&lt;button type="button" class="recall"&gt;Recall&lt;/button&gt;&lt;/li&gt;'</span>;
                <span class="hljs-keyword">if</span> (!noEvent) {
                    Event.delegate(nLi, <span class="hljs-string">'click'</span>, <span class="hljs-keyword">this</span>.ShipRecall, <span class="hljs-string">'button.recall'</span>, {
                        Self: <span class="hljs-keyword">this</span>,
                        Ship: ship,
                        Line: nLi
                    }, <span class="hljs-literal">true</span>);
                }
            }
            <span class="hljs-keyword">if</span> (ship.payload &amp;&amp; ship.payload.length &gt; <span class="hljs-number">0</span>) {
                ulDet[ulDet.length] = <span class="hljs-string">'&lt;li style="white-space:nowrap;margin-top:5px"&gt;&lt;button type="button" class="payload"&gt;Payload&lt;/button&gt;&lt;/li&gt;'</span>;
                <span class="hljs-keyword">if</span> (!noEvent) {
                    Event.delegate(nLi, <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e, matchedEl, container)</span> {</span>
                        <span class="hljs-keyword">var</span> div = Sel.query(<span class="hljs-string">'div.shipPayload'</span>, container);
                        <span class="hljs-keyword">var</span> curDis = Dom.getStyle(div[<span class="hljs-number">0</span>], <span class="hljs-string">"display"</span>);
                        Dom.setStyle(div, <span class="hljs-string">"display"</span>, curDis === <span class="hljs-string">"none"</span> ? <span class="hljs-string">""</span> : <span class="hljs-string">"none"</span>);
                    }, <span class="hljs-string">'button.payload'</span>, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                }
            }
            <span class="hljs-keyword">return</span> ulDet.join(<span class="hljs-string">''</span>);
        },
        ViewPopulate: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> details = Dom.get(<span class="hljs-string">"shipsViewDetails"</span>);
            <span class="hljs-keyword">if</span> (details) {
                <span class="hljs-keyword">var</span> ships = <span class="hljs-keyword">this</span>.shipsView.ships,
                    parentEl = details.parentNode,
                    li = document.createElement(<span class="hljs-string">"li"</span>),
                    info = Dom.get(<span class="hljs-string">"shipsCount"</span>),
                    displayRecallAll;
                Event.purgeElement(details, <span class="hljs-literal">true</span>);
                details = parentEl.removeChild(details);
                details.innerHTML = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">if</span> (info &amp;&amp; <span class="hljs-keyword">this</span>.result.max_ships &gt; <span class="hljs-number">0</span>) {
                    info.innerHTML = [<span class="hljs-string">'&lt;div&gt;This SpacePort can dock a maximum of '</span>, <span class="hljs-keyword">this</span>.result.max_ships, <span class="hljs-string">' ships. There are '</span>, <span class="hljs-keyword">this</span>.result.docks_available, <span class="hljs-string">' docks available.'</span>].join(<span class="hljs-string">''</span>);
                }
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ships.length; i++) {
                    <span class="hljs-keyword">var</span> ship = ships[i],
                        nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.setStyle(nLi, <span class="hljs-string">"margin-top"</span>, <span class="hljs-string">"3px"</span>);
                    nLi.innerHTML = [<span class="hljs-string">'&lt;div class="yui-g" style="margin-bottom:2px;"&gt;'</span>, <span class="hljs-string">'&lt;div class="yui-g first"&gt;'</span>, <span class="hljs-string">'    &lt;div class="yui-u first" style="background:transparent url('</span>, Lib.AssetUrl, <span class="hljs-string">'star_system/field.png) no-repeat center;text-align:center;"&gt;'</span>, <span class="hljs-string">'        &lt;img src="'</span>, Lib.AssetUrl, <span class="hljs-string">'ships/'</span>, ship.type, <span class="hljs-string">'.png" title="'</span>, ship.type_human, <span class="hljs-string">'" style="width:115px;height:115px;" /&gt;'</span>, <span class="hljs-string">'    &lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;div class="yui-u"&gt;'</span>, <span class="hljs-string">'        &lt;span class="shipName"&gt;'</span>, ship.name, <span class="hljs-string">'&lt;/span&gt;: '</span>, <span class="hljs-string">'        &lt;ul class="shipActionDetails"&gt;'</span>,
                        <span class="hljs-keyword">this</span>.ViewActionDetails(nLi, ship), <span class="hljs-string">'        &lt;/ul&gt;'</span>, <span class="hljs-string">'    &lt;/div&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>, <span class="hljs-string">'&lt;div class="yui-g"&gt;'</span>, <span class="hljs-string">'    &lt;div class="yui-u first"&gt;'</span>, <span class="hljs-string">'        &lt;ul&gt;'</span>, <span class="hljs-string">'        &lt;li&gt;&lt;label style="font-weight:bold;"&gt;Attributes:&lt;/label&gt;&lt;/li&gt;'</span>, (ship.fleet_speed &gt; <span class="hljs-number">0</span> &amp;&amp; ship.fleet_speed &lt; ship.speed) ? <span class="hljs-string">'        &lt;li style="white-space:nowrap;"&gt;&lt;label style="font-style:italic"&gt;Fleet Speed: &lt;/label&gt;'</span> + ship.fleet_speed + <span class="hljs-string">'&lt;/li&gt;'</span> : <span class="hljs-string">''</span>, <span class="hljs-string">'        &lt;li style="white-space:nowrap;"&gt;&lt;label style="font-style:italic"&gt;Speed: &lt;/label&gt;'</span>, ship.speed, <span class="hljs-string">'&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li style="white-space:nowrap;"&gt;&lt;label style="font-style:italic"&gt;Hold Size: &lt;/label&gt;'</span>, ship.hold_size, <span class="hljs-string">'&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li style="white-space:nowrap;"&gt;&lt;label style="font-style:italic"&gt;Berth Level: &lt;/label&gt;'</span>, ship.berth_level, <span class="hljs-string">'&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;/ul&gt;'</span>, <span class="hljs-string">'        &lt;div class="shipPayload" style="display:none;margin-top:5px"&gt;&lt;div&gt;&lt;label style="font-weight:bold;"&gt;Payload:&lt;/label&gt;&lt;/div&gt;'</span>,
                        Lib.formatInlineList(ship.payload, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>), <span class="hljs-string">'&lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;div class="yui-u"&gt;'</span>, <span class="hljs-string">'        &lt;ul&gt;'</span>, <span class="hljs-string">'        &lt;li style="white-space:nowrap;"&gt;&lt;label style="font-style:italic"&gt;Occupants: &lt;/label&gt;'</span>, ship.max_occupants, <span class="hljs-string">'&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li style="white-space:nowrap;"&gt;&lt;label style="font-style:italic"&gt;Stealth: &lt;/label&gt;'</span>, ship.stealth, <span class="hljs-string">'&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li style="white-space:nowrap;"&gt;&lt;label style="font-style:italic"&gt;Combat: &lt;/label&gt;'</span>, ship.combat, <span class="hljs-string">'&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;/ul&gt;'</span>, <span class="hljs-string">'        &lt;div class="shipPayload" style="display:none;margin-top:5px"&gt;'</span>,
                        Lib.formatInlineList(ship.payload, <span class="hljs-number">3</span>), <span class="hljs-string">'        &lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;/div&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>
                    ].join(<span class="hljs-string">''</span>);
                    <span class="hljs-keyword">if</span> (ship.task === <span class="hljs-string">"Defend"</span> || ship.task === <span class="hljs-string">"Orbiting"</span>) {
                        displayRecallAll = <span class="hljs-literal">true</span>;
                    }
                    <span class="hljs-keyword">var</span> sn = Sel.query(<span class="hljs-string">"span.shipName"</span>, nLi, <span class="hljs-literal">true</span>);
                    Event.on(sn, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.ShipName, {
                        Self: <span class="hljs-keyword">this</span>,
                        Ship: ship,
                        el: sn
                    }, <span class="hljs-literal">true</span>);
                    <span class="hljs-comment">//Event.on(Sel.query("span.shipFrom",nLi,true), "click", this.EmpireProfile, ship.from);</span>
                    <span class="hljs-comment">//Event.on(Sel.query("span.shipTo",nLi,true), "click", this.EmpireProfile, ship.to);</span>
                    details.appendChild(nLi);
                }
                <span class="hljs-keyword">if</span> (displayRecallAll) {
                    Dom.setStyle(<span class="hljs-string">"shipsRecallAll"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">""</span>);
                } <span class="hljs-keyword">else</span> {
                    Dom.setStyle(<span class="hljs-string">"shipsRecallAll"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"none"</span>);
                }
                <span class="hljs-comment">//add child back in</span>
                parentEl.appendChild(details);
                <span class="hljs-comment">//wait for tab to display first</span>
                setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">var</span> Ht = Game.GetSize()
                        .h - <span class="hljs-number">230</span>;
                    <span class="hljs-keyword">if</span> (Ht &gt; <span class="hljs-number">300</span>) {
                        Ht = <span class="hljs-number">300</span>;
                    }
                    <span class="hljs-keyword">var</span> tC = details.parentNode;
                    Dom.setStyle(tC, <span class="hljs-string">"height"</span>, Ht + <span class="hljs-string">"px"</span>);
                    Dom.setStyle(tC, <span class="hljs-string">"overflow-y"</span>, <span class="hljs-string">"auto"</span>);
                }, <span class="hljs-number">10</span>);
            }
        },
        ViewHandlePagination: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newState)</span> {</span>
            Lacuna.Pulser.Show();
            <span class="hljs-keyword">this</span>.service.view_all_ships({
                session_id: Game.GetSession(),
                building_id: <span class="hljs-keyword">this</span>.building.id,
                paging: {
                    page_number: newState.page
                }
            }, {
                success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                    YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"SpacePort.ViewHandlePagination.view_all_ships.success"</span>);
                    Lacuna.Pulser.Hide();
                    <span class="hljs-keyword">this</span>.rpcSuccess(o);
                    <span class="hljs-keyword">this</span>.shipsView = {
                        number_of_ships: o.result.number_of_ships,
                        ships: o.result.ships
                    };
                    <span class="hljs-keyword">this</span>.ViewPopulate();
                },
                scope: <span class="hljs-keyword">this</span>
            });</pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Update the Paginator&#39;s state</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">            <span class="hljs-keyword">this</span>.viewPager.setState(newState);
        },
        ShipName: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">this</span>.el.innerHTML = <span class="hljs-string">""</span>;
            <span class="hljs-keyword">var</span> inp = document.createElement(<span class="hljs-string">"input"</span>),
                bSave = document.createElement(<span class="hljs-string">"button"</span>),
                bCancel = bSave.cloneNode(<span class="hljs-literal">false</span>);
            inp.type = <span class="hljs-string">"text"</span>;
            inp.value = <span class="hljs-keyword">this</span>.Ship.name;
            <span class="hljs-keyword">this</span>.Input = inp;
            bSave.setAttribute(<span class="hljs-string">"type"</span>, <span class="hljs-string">"button"</span>);
            bSave.innerHTML = <span class="hljs-string">"Save"</span>;
            Event.on(bSave, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.Self.ShipNameSave, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            bCancel.setAttribute(<span class="hljs-string">"type"</span>, <span class="hljs-string">"button"</span>);
            bCancel.innerHTML = <span class="hljs-string">"Cancel"</span>;
            Event.on(bCancel, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.Self.ShipNameClear, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            Event.removeListener(<span class="hljs-keyword">this</span>.el, <span class="hljs-string">"click"</span>);
            <span class="hljs-keyword">this</span>.el.appendChild(inp);
            <span class="hljs-keyword">this</span>.el.appendChild(document.createElement(<span class="hljs-string">"br"</span>));
            <span class="hljs-keyword">this</span>.el.appendChild(bSave);
            <span class="hljs-keyword">this</span>.el.appendChild(bCancel);
        },
        ShipNameSave: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
            Event.stopEvent(e);
            Lacuna.Pulser.Show();
            <span class="hljs-keyword">var</span> newName = <span class="hljs-keyword">this</span>.Input.value;
            <span class="hljs-keyword">this</span>.Self.service.name_ship({
                session_id: Game.GetSession(),
                building_id: <span class="hljs-keyword">this</span>.Self.building.id,
                ship_id: <span class="hljs-keyword">this</span>.Ship.id,
                name: newName
            }, {
                success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                    YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"SpacePort.ShipNameSave.success"</span>);
                    Lacuna.Pulser.Hide();
                    <span class="hljs-keyword">this</span>.Self.rpcSuccess(o);
                    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.Self.shipsView;
                    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.Self.shipsTravelling;
                    <span class="hljs-keyword">this</span>.Ship.name = newName;
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.Input) {
                        <span class="hljs-keyword">this</span>.Input.value = newName;
                    }
                    <span class="hljs-keyword">this</span>.Self.ShipNameClear.call(<span class="hljs-keyword">this</span>);
                },
                failure: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.Input) {
                        <span class="hljs-keyword">this</span>.Input.value = <span class="hljs-keyword">this</span>.Ship.name;
                    }
                },
                scope: <span class="hljs-keyword">this</span>
            });
        },
        ShipNameClear: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
            <span class="hljs-keyword">if</span> (e) {
                Event.stopEvent(e);
            }
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.Input) {
                <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.Input;
            }
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.el) {
                Event.purgeElement(<span class="hljs-keyword">this</span>.el, <span class="hljs-literal">true</span>);
                <span class="hljs-keyword">this</span>.el.innerHTML = <span class="hljs-keyword">this</span>.Ship.name;
                Event.on(<span class="hljs-keyword">this</span>.el, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.Self.ShipName, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            }
        },
        ForeignPopulate: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> details = Dom.get(<span class="hljs-string">"shipsForeignDetails"</span>);
            <span class="hljs-keyword">if</span> (details) {
                <span class="hljs-keyword">var</span> ships = <span class="hljs-keyword">this</span>.shipsForeign.ships,
                    ul = document.createElement(<span class="hljs-string">"ul"</span>),
                    li = document.createElement(<span class="hljs-string">"li"</span>);
                ships = ships.slice(<span class="hljs-number">0</span>);
                ships.sort(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(a, b)</span> {</span>
                    <span class="hljs-keyword">if</span> (a.date_arrives &gt; b.date_arrives) {
                        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (a.date_arrives &lt; b.date_arrives) {
                        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
                    }
                });
                Event.purgeElement(details, <span class="hljs-literal">true</span>);
                details.innerHTML = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">var</span> serverTime = Lib.getTime(Game.ServerData.time);
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ships.length; i++) {
                    <span class="hljs-keyword">var</span> ship = ships[i],
                        nUl = ul.cloneNode(<span class="hljs-literal">false</span>),
                        nLi = li.cloneNode(<span class="hljs-literal">false</span>),
                        sec = (Lib.getTime(ship.date_arrives) - serverTime) / <span class="hljs-number">1000</span>;
                    nUl.Ship = ship;
                    Dom.addClass(nUl, <span class="hljs-string">"shipInfo"</span>);
                    Dom.addClass(nUl, <span class="hljs-string">"clearafter"</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"shipTypeImage"</span>);
                    Dom.setStyle(nLi, <span class="hljs-string">"background"</span>, [<span class="hljs-string">'transparent url('</span>, Lib.AssetUrl, <span class="hljs-string">'star_system/field.png) no-repeat center'</span>].join(<span class="hljs-string">''</span>));
                    Dom.setStyle(nLi, <span class="hljs-string">"text-align"</span>, <span class="hljs-string">"center"</span>);
                    nLi.innerHTML = [<span class="hljs-string">'&lt;img src="'</span>, Lib.AssetUrl, <span class="hljs-string">'ships/'</span>, ship.type, <span class="hljs-string">'.png" title="'</span>, ship.type_human, <span class="hljs-string">'" style="width:50px;height:50px;" /&gt;'</span>].join(<span class="hljs-string">''</span>);
                    nUl.appendChild(nLi);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"shipName"</span>);
                    nLi.innerHTML = ship.name;
                    nUl.appendChild(nLi);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"shipArrives"</span>);
                    nLi.innerHTML = Lib.formatTime(sec);
                    nUl.appendChild(nLi);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"shipFrom"</span>);
                    <span class="hljs-keyword">if</span> (ship.from &amp;&amp; ship.from.name) {
                        <span class="hljs-keyword">if</span> (ship.from.empire &amp;&amp; ship.from.empire.name) {
                            nLi.innerHTML = ship.from.name + <span class="hljs-string">' &lt;span style="cursor:pointer;"&gt;['</span> + ship.from.empire.name + <span class="hljs-string">']&lt;/span&gt;'</span>;
                            Event.on(nLi, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.EmpireProfile, ship.from.empire);
                        } <span class="hljs-keyword">else</span> {
                            nLi.innerHTML = ship.from.name;
                        }
                    } <span class="hljs-keyword">else</span> {
                        nLi.innerHTML = <span class="hljs-string">'Unknown'</span>;
                    }
                    nUl.appendChild(nLi);
                    <span class="hljs-keyword">this</span>.addQueue(sec, <span class="hljs-keyword">this</span>.ForeignQueue, nUl);
                    details.appendChild(nUl);
                }
                <span class="hljs-comment">//wait for tab to display first</span>
                setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">var</span> Ht = Game.GetSize()
                        .h - <span class="hljs-number">220</span>;
                    <span class="hljs-keyword">if</span> (Ht &gt; <span class="hljs-number">300</span>) {
                        Ht = <span class="hljs-number">300</span>;
                    }
                    <span class="hljs-keyword">var</span> tC = details.parentNode;
                    Dom.setStyle(tC, <span class="hljs-string">"height"</span>, Ht + <span class="hljs-string">"px"</span>);
                    Dom.setStyle(tC, <span class="hljs-string">"overflow-y"</span>, <span class="hljs-string">"auto"</span>);
                }, <span class="hljs-number">10</span>);
            }
        },
        LogsPopulate: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> details = Dom.get(<span class="hljs-string">"battleLogsDetails"</span>);
            <span class="hljs-keyword">if</span> (details) {
                <span class="hljs-keyword">var</span> logs = <span class="hljs-keyword">this</span>.battleLogs.battle_log,
                    ul = document.createElement(<span class="hljs-string">"ul"</span>),
                    li = document.createElement(<span class="hljs-string">"li"</span>);
                logs = logs.slice(<span class="hljs-number">0</span>);
                Event.purgeElement(details, <span class="hljs-literal">true</span>);
                details.innerHTML = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; logs.length; i++) {
                    <span class="hljs-keyword">var</span> log = logs[i],
                        nUl = ul.cloneNode(<span class="hljs-literal">false</span>),
                        nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nUl, <span class="hljs-string">"shipInfo"</span>);
                    Dom.addClass(nUl, <span class="hljs-string">"clearafter"</span>);
                    <span class="hljs-keyword">if</span> (!details.children.length) {
                        Dom.addClass(nUl, <span class="hljs-string">"first"</span>);
                    }
                    Dom.addClass(nUl, <span class="hljs-string">"attacker"</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"shipTask"</span>);
                    nLi.innerHTML = <span class="hljs-string">'Attacker'</span>;
                    nUl.appendChild(nLi);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"shipName"</span>);
                    nLi.innerHTML = log.attacking_unit;
                    nUl.appendChild(nLi);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"shipFrom"</span>);
                    nLi.innerHTML = log.attacking_body + <span class="hljs-string">' ['</span> + log.attacking_empire + <span class="hljs-string">']'</span>;
                    nUl.appendChild(nLi);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    nLi.innerHTML = <span class="hljs-string">'&lt;label&gt;Arrived:&lt;/label&gt; '</span> + log.date;
                    nUl.appendChild(nLi);
                    details.appendChild(nUl);
                    nUl = ul.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nUl, <span class="hljs-string">"shipInfo"</span>);
                    Dom.addClass(nUl, <span class="hljs-string">"clearafter"</span>);
                    Dom.addClass(nUl, <span class="hljs-string">"defender"</span>);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"shipTask"</span>);
                    nLi.innerHTML = <span class="hljs-string">'Defender'</span>;
                    nUl.appendChild(nLi);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"shipName"</span>);
                    nLi.innerHTML = log.defending_unit;
                    nUl.appendChild(nLi);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"shipFrom"</span>);
                    nLi.innerHTML = log.defending_body + <span class="hljs-string">' ['</span> + log.defending_empire + <span class="hljs-string">']'</span>;
                    nUl.appendChild(nLi);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    nLi.innerHTML = <span class="hljs-string">'&lt;label&gt;Victory:&lt;/label&gt; '</span> + log.victory_to.replace(<span class="hljs-regexp">/^\w/</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(c)</span> {</span>
                        <span class="hljs-keyword">return</span> c.toUpperCase();
                    });
                    nUl.appendChild(nLi);
                    details.appendChild(nUl);
                    nUl = ul.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nUl, <span class="hljs-string">"shipInfo"</span>);
                    Dom.addClass(nUl, <span class="hljs-string">"clearafter"</span>);
                    Dom.addClass(nUl, <span class="hljs-string">"attacked"</span>);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"shipTask"</span>);
                    nLi.innerHTML = <span class="hljs-string">'Attacked'</span>;
                    nUl.appendChild(nLi);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"shipFrom"</span>);
                    nLi.innerHTML = log.attacked_body + <span class="hljs-string">' ['</span> + log.attacked_empire + <span class="hljs-string">']'</span>;
                    nUl.appendChild(nLi);
                    details.appendChild(nUl);
                }
                <span class="hljs-comment">//wait for tab to display first</span>
                setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">var</span> Ht = Game.GetSize()
                        .h - <span class="hljs-number">220</span>;
                    <span class="hljs-keyword">if</span> (Ht &gt; <span class="hljs-number">300</span>) {
                        Ht = <span class="hljs-number">300</span>;
                    }
                    <span class="hljs-keyword">var</span> tC = details.parentNode;
                    Dom.setStyle(tC, <span class="hljs-string">"height"</span>, Ht + <span class="hljs-string">"px"</span>);
                    Dom.setStyle(tC, <span class="hljs-string">"overflow-y"</span>, <span class="hljs-string">"auto"</span>);
                }, <span class="hljs-number">10</span>);
            }
        },
        ForeignHandlePagination: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newState)</span> {</span>
            Lacuna.Pulser.Show();
            <span class="hljs-keyword">this</span>.service.view_foreign_ships({
                session_id: Game.GetSession(),
                building_id: <span class="hljs-keyword">this</span>.building.id,
                page_number: newState.page
            }, {
                success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                    YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"SpacePort.view_foreign_ships.success"</span>);
                    Lacuna.Pulser.Hide();
                    <span class="hljs-keyword">this</span>.rpcSuccess(o);
                    <span class="hljs-keyword">this</span>.shipsForeign = {
                        number_of_ships: o.result.number_of_ships,
                        ships: o.result.ships
                    };
                    <span class="hljs-keyword">this</span>.ForeignPopulate();
                },
                scope: <span class="hljs-keyword">this</span>
            });</pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Update the Paginator&#39;s state</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">            <span class="hljs-keyword">this</span>.foreignPager.setState(newState);
        },
        LogsHandlePagination: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newState)</span> {</span>
            Lacuna.Pulser.Show();
            <span class="hljs-keyword">this</span>.service.view_battle_logs({
                session_id: Game.GetSession(),
                building_id: <span class="hljs-keyword">this</span>.building.id,
                page_number: newState.page
            }, {
                success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                    YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"SpacePort.view_battle_logs.success"</span>);
                    Lacuna.Pulser.Hide();
                    <span class="hljs-keyword">this</span>.rpcSuccess(o);
                    <span class="hljs-keyword">this</span>.battleLogs = {
                        number_of_logs: o.result.number_of_logs,
                        battle_log: o.result.battle_log
                    };
                    <span class="hljs-keyword">this</span>.LogsPopulate();
                },
                scope: <span class="hljs-keyword">this</span>
            });</pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Update the Paginator&#39;s state</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">            <span class="hljs-keyword">this</span>.logsPager.setState(newState);
        },
        ForeignQueue: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(remaining, elLine)</span> {</span>
            <span class="hljs-keyword">var</span> arrTime;
            <span class="hljs-keyword">if</span> (remaining &lt;= <span class="hljs-number">0</span>) {
                arrTime = <span class="hljs-string">'Overdue '</span> + Lib.formatTime(<span class="hljs-built_in">Math</span>.round(-remaining));
            } <span class="hljs-keyword">else</span> {
                arrTime = Lib.formatTime(<span class="hljs-built_in">Math</span>.round(remaining));
            }
            Sel.query(<span class="hljs-string">"li.shipArrives"</span>, elLine, <span class="hljs-literal">true</span>)
                .innerHTML = arrTime;
        },
        OrbitingPopulate: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> details = Dom.get(<span class="hljs-string">"shipsOrbitingDetails"</span>);
            <span class="hljs-keyword">if</span> (details) {
                <span class="hljs-keyword">var</span> ships = <span class="hljs-keyword">this</span>.shipsOrbiting.ships,
                    ul = document.createElement(<span class="hljs-string">"ul"</span>),
                    li = document.createElement(<span class="hljs-string">"li"</span>);
                ships = ships.slice(<span class="hljs-number">0</span>);
                ships.sort(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(a, b)</span> {</span>
                    <span class="hljs-keyword">if</span> (a.date_arrives || b.date_arrives) {
                        <span class="hljs-keyword">if</span> (a.date_arrives &gt; b.date_arrives) {
                            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
                        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (a.date_arrives &lt; b.date_arrives) {
                            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
                        } <span class="hljs-keyword">else</span> {
                            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
                        }
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
                    }
                });
                Event.purgeElement(details, <span class="hljs-literal">true</span>);
                details.innerHTML = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">var</span> serverTime = Lib.getTime(Game.ServerData.time);
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ships.length; i++) {
                    <span class="hljs-keyword">var</span> ship = ships[i],
                        nUl = ul.cloneNode(<span class="hljs-literal">false</span>),
                        nLi = li.cloneNode(<span class="hljs-literal">false</span>),
                        sec = (Lib.getTime(ship.date_arrived) - serverTime) / <span class="hljs-number">1000</span>;
                    nUl.Ship = ship;
                    Dom.addClass(nUl, <span class="hljs-string">"shipInfo"</span>);
                    Dom.addClass(nUl, <span class="hljs-string">"clearafter"</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"shipTypeImage"</span>);
                    Dom.setStyle(nLi, <span class="hljs-string">"background"</span>, [<span class="hljs-string">'transparent url('</span>, Lib.AssetUrl, <span class="hljs-string">'star_system/field.png) no-repeat center'</span>].join(<span class="hljs-string">''</span>));
                    Dom.setStyle(nLi, <span class="hljs-string">"text-align"</span>, <span class="hljs-string">"center"</span>);
                    nLi.innerHTML = [<span class="hljs-string">'&lt;img src="'</span>, Lib.AssetUrl, <span class="hljs-string">'ships/'</span>, ship.type, <span class="hljs-string">'.png" title="'</span>, ship.type_human, <span class="hljs-string">'" style="width:50px;height:50px;" /&gt;'</span>].join(<span class="hljs-string">''</span>);
                    nUl.appendChild(nLi);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"shipName"</span>);
                    nLi.innerHTML = ship.name;
                    nUl.appendChild(nLi);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"shipArrives"</span>);
                    nLi.innerHTML = Lib.formatServerDate(ship.date_arrived);
                    nUl.appendChild(nLi);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"shipFrom"</span>);
                    <span class="hljs-keyword">if</span> (ship.from &amp;&amp; ship.from.name) {
                        <span class="hljs-keyword">if</span> (ship.from.empire &amp;&amp; ship.from.empire.name) {
                            nLi.innerHTML = ship.from.name + <span class="hljs-string">' &lt;span style="cursor:pointer;"&gt;['</span> + ship.from.empire.name + <span class="hljs-string">']&lt;/span&gt;'</span>;
                            Event.on(nLi, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.EmpireProfile, ship.from.empire);
                        } <span class="hljs-keyword">else</span> {
                            nLi.innerHTML = ship.from.name;
                        }
                    } <span class="hljs-keyword">else</span> {
                        nLi.innerHTML = <span class="hljs-string">'Unknown'</span>;
                    }
                    nUl.appendChild(nLi);
                    details.appendChild(nUl);
                }
                <span class="hljs-comment">//wait for tab to display first</span>
                setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">var</span> Ht = Game.GetSize()
                        .h - <span class="hljs-number">220</span>;
                    <span class="hljs-keyword">if</span> (Ht &gt; <span class="hljs-number">300</span>) {
                        Ht = <span class="hljs-number">300</span>;
                    }
                    <span class="hljs-keyword">var</span> tC = details.parentNode;
                    Dom.setStyle(tC, <span class="hljs-string">"height"</span>, Ht + <span class="hljs-string">"px"</span>);
                    Dom.setStyle(tC, <span class="hljs-string">"overflow-y"</span>, <span class="hljs-string">"auto"</span>);
                }, <span class="hljs-number">10</span>);
            }
        },
        OrbitingHandlePagination: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newState)</span> {</span>
            Lacuna.Pulser.Show();
            <span class="hljs-keyword">this</span>.service.view_ships_orbiting({
                session_id: Game.GetSession(),
                building_id: <span class="hljs-keyword">this</span>.building.id,
                page_number: newState.page
            }, {
                success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                    Lacuna.Pulser.Hide();
                    <span class="hljs-keyword">this</span>.rpcSuccess(o);
                    <span class="hljs-keyword">this</span>.shipsOrbiting = {
                        number_of_ships: o.result.number_of_ships,
                        ships: o.result.ships
                    };
                    <span class="hljs-keyword">this</span>.OrbitingPopulate();
                },
                scope: <span class="hljs-keyword">this</span>
            });</pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Update the Paginator&#39;s state</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">            <span class="hljs-keyword">this</span>.orbitingPager.setState(newState);
        },
        EmpireProfile: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e, empire)</span> {</span>
            Lacuna.Info.Empire.Load(empire.id);
        },
        ShipScuttle: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e, matchedEl, container)</span> {</span>
            <span class="hljs-keyword">if</span> (confirm([<span class="hljs-string">"Are you sure you want to Scuttle "</span>, <span class="hljs-keyword">this</span>.Ship.name, <span class="hljs-string">"?"</span>].join(<span class="hljs-string">''</span>))) {
                <span class="hljs-keyword">var</span> btn = Event.getTarget(e);
                btn.disabled = <span class="hljs-literal">true</span>;
                Lacuna.Pulser.Show();
                <span class="hljs-keyword">this</span>.Self.service.scuttle_ship({
                    session_id: Game.GetSession(),
                    building_id: <span class="hljs-keyword">this</span>.Self.building.id,
                    ship_id: <span class="hljs-keyword">this</span>.Ship.id
                }, {
                    success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                        YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"SpacePort.ShipScuttle.success"</span>);
                        Lacuna.Pulser.Hide();
                        <span class="hljs-keyword">this</span>.Self.rpcSuccess(o);
                        <span class="hljs-keyword">var</span> ships = <span class="hljs-keyword">this</span>.Self.shipsView.ships,
                            info = Dom.get(<span class="hljs-string">"shipsCount"</span>);
                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ships.length; i++) {
                            <span class="hljs-keyword">if</span> (ships[i].id === <span class="hljs-keyword">this</span>.Ship.id) {
                                ships.splice(i, <span class="hljs-number">1</span>);
                                <span class="hljs-keyword">break</span>;
                            }
                        }
                        <span class="hljs-keyword">if</span> (info) {
                            <span class="hljs-keyword">this</span>.Self.result.docks_available++;
                            info.innerHTML = [<span class="hljs-string">'This SpacePort can dock a maximum of '</span>, <span class="hljs-keyword">this</span>.Self.result.max_ships, <span class="hljs-string">' ships. There are '</span>, <span class="hljs-keyword">this</span>.Self.result.docks_available, <span class="hljs-string">' docks available.'</span>].join(<span class="hljs-string">''</span>);
                        }
                        Event.removeDelegate(<span class="hljs-keyword">this</span>.Line, <span class="hljs-string">'click'</span>);
                        <span class="hljs-keyword">this</span>.Line.parentNode.removeChild(<span class="hljs-keyword">this</span>.Line);
                    },
                    failure: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                        btn.disabled = <span class="hljs-literal">false</span>;
                    },
                    scope: <span class="hljs-keyword">this</span>
                });
            }
        },
        ShipRecall: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e, matchedEl, container)</span> {</span>
            matchedEl.disabled = <span class="hljs-literal">true</span>;
            Lacuna.Pulser.Show();
            <span class="hljs-keyword">this</span>.Self.service.recall_ship({
                session_id: Game.GetSession(),
                building_id: <span class="hljs-keyword">this</span>.Self.building.id,
                ship_id: <span class="hljs-keyword">this</span>.Ship.id
            }, {
                success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                    Lacuna.Pulser.Hide();
                    <span class="hljs-keyword">this</span>.Self.rpcSuccess(o);
                    <span class="hljs-keyword">var</span> ships = <span class="hljs-keyword">this</span>.Self.shipsView.ships,
                        info = Dom.get(<span class="hljs-string">"shipsCount"</span>);
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ships.length; i++) {
                        <span class="hljs-keyword">if</span> (ships[i].id === <span class="hljs-keyword">this</span>.Ship.id) {
                            ships[i] = o.result.ship;
                            <span class="hljs-keyword">break</span>;
                        }
                    }
                    <span class="hljs-keyword">if</span> (info) {
                        <span class="hljs-keyword">this</span>.Self.result.docks_available++;
                        info.innerHTML = [<span class="hljs-string">'This SpacePort can dock a maximum of '</span>, <span class="hljs-keyword">this</span>.Self.result.max_ships, <span class="hljs-string">' ships. There are '</span>, <span class="hljs-keyword">this</span>.Self.result.docks_available, <span class="hljs-string">' docks available.'</span>].join(<span class="hljs-string">''</span>);
                    }
                    <span class="hljs-comment">//set to travelling</span>
                    <span class="hljs-keyword">var</span> ad = Sel.query(<span class="hljs-string">"ul.shipActionDetails"</span>, <span class="hljs-keyword">this</span>.Line, <span class="hljs-literal">true</span>);
                    ad.innerHTML = <span class="hljs-keyword">this</span>.Self.ViewActionDetails(<span class="hljs-keyword">this</span>.Line, o.result.ship, <span class="hljs-literal">true</span>);
                    <span class="hljs-comment">//remove ships travelling so the tab gets reloaded when viewed next time</span>
                    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.Self.shipsTravelling;
                },
                failure: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                    matchedEl.disabled = <span class="hljs-literal">false</span>;
                },
                scope: <span class="hljs-keyword">this</span>
            });
        },
        ShipRecallAll: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
            <span class="hljs-keyword">var</span> btn = Event.getTarget(e);
            btn.disabled = <span class="hljs-literal">true</span>;
            Lacuna.Pulser.Show();
            <span class="hljs-keyword">this</span>.service.recall_all({
                session_id: Game.GetSession(),
                building_id: <span class="hljs-keyword">this</span>.building.id
            }, {
                success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                    Lacuna.Pulser.Hide();
                    <span class="hljs-keyword">this</span>.rpcSuccess(o);
                    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.shipsTravelling;
                    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.shipsView;
                    <span class="hljs-keyword">this</span>.getShips({
                        newValue: <span class="hljs-literal">true</span>
                    });
                },
                failure: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                    btn.disabled = <span class="hljs-literal">false</span>;
                },
                scope: <span class="hljs-keyword">this</span>
            });
        },
        GetShipsFor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            Lacuna.Pulser.Show();
            <span class="hljs-comment">//Dom.setStyle("sendShipPick", "display", "none");</span>
            Dom.setStyle(<span class="hljs-string">"sendShipSend"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"none"</span>);
            <span class="hljs-keyword">var</span> type = Lib.getSelectedOptionValue(<span class="hljs-string">"sendShipType"</span>),
                target = {};
            <span class="hljs-keyword">if</span> (type === <span class="hljs-string">"xy"</span>) {
                target.x = Dom.get(<span class="hljs-string">"sendShipTargetX"</span>)
                    .value;
                target.y = Dom.get(<span class="hljs-string">"sendShipTargetY"</span>)
                    .value;
                Dom.get(<span class="hljs-string">"sendShipNote"</span>)
                    .innerHTML = [<span class="hljs-string">'X: '</span>, target.x, <span class="hljs-string">' - Y: '</span>, target.y].join(<span class="hljs-string">''</span>);
            } <span class="hljs-keyword">else</span> {
                target[type] = Dom.get(<span class="hljs-string">"sendShipTargetText"</span>)
                    .value;
                Dom.get(<span class="hljs-string">"sendShipNote"</span>)
                    .innerHTML = target[type];
            }
            <span class="hljs-keyword">this</span>.service.get_ships_for({
                session_id: Game.GetSession(),
                from_body_id: Game.GetCurrentPlanet()
                    .id,
                target: target
            }, {
                success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                    Lacuna.Pulser.Hide();
                    <span class="hljs-keyword">this</span>.rpcSuccess(o);
                    <span class="hljs-keyword">this</span>.PopulateShipsSendTab(target, o.result.available);
                },
                scope: <span class="hljs-keyword">this</span>
            });
        },
        PopulateShipsSendTab: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(target, ships)</span> {</span>
            <span class="hljs-keyword">var</span> details = Dom.get(<span class="hljs-string">"sendShipAvail"</span>),
                detailsParent = details.parentNode,
                li = document.createElement(<span class="hljs-string">"li"</span>);
            Event.purgeElement(details, <span class="hljs-literal">true</span>); <span class="hljs-comment">//clear any events before we remove</span>
            details = detailsParent.removeChild(details); <span class="hljs-comment">//remove from DOM to make this faster</span>
            details.innerHTML = <span class="hljs-string">""</span>;
            Dom.setStyle(<span class="hljs-string">"sendShipSend"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">""</span>);
            <span class="hljs-keyword">if</span> (ships.length === <span class="hljs-number">0</span>) {
                details.innerHTML = <span class="hljs-string">"No available ships to send."</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ships.length; i++) {
                    <span class="hljs-keyword">var</span> ship = ships[i],
                        nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    nLi.Ship = ship;
                    nLi.innerHTML = [<span class="hljs-string">'&lt;div class="yui-gd" style="margin-bottom:2px;"&gt;'</span>, <span class="hljs-string">'    &lt;div class="yui-u first" style="width:15%;background:transparent url('</span>, Lib.AssetUrl, <span class="hljs-string">'star_system/field.png) no-repeat center;text-align:center;"&gt;'</span>, <span class="hljs-string">'        &lt;img src="'</span>, Lib.AssetUrl, <span class="hljs-string">'ships/'</span>, ship.type, <span class="hljs-string">'.png" style="width:60px;height:60px;" /&gt;'</span>, <span class="hljs-string">'    &lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;div class="yui-u" style="width:67%"&gt;'</span>, <span class="hljs-string">'        &lt;div class="buildingName"&gt;['</span>, ship.type_human, <span class="hljs-string">'] '</span>, ship.name, <span class="hljs-string">'&lt;/div&gt;'</span>, <span class="hljs-string">'        &lt;div&gt;&lt;label style="font-weight:bold;"&gt;Details:&lt;/label&gt;'</span>, <span class="hljs-string">'            &lt;span&gt;Task:&lt;span&gt;'</span>, ship.task, <span class="hljs-string">'&lt;/span&gt;&lt;/span&gt;,'</span>, <span class="hljs-string">'            &lt;span&gt;Travel Time:&lt;span&gt;'</span>, Lib.formatTime(ship.estimated_travel_time), <span class="hljs-string">'&lt;/span&gt;&lt;/span&gt;'</span>, <span class="hljs-string">'        &lt;/div&gt;'</span>, <span class="hljs-string">'        &lt;div&gt;&lt;label style="font-weight:bold;"&gt;Attributes:&lt;/label&gt;'</span>, <span class="hljs-string">'            &lt;span&gt;Speed:&lt;span&gt;'</span>, ship.speed, <span class="hljs-string">'&lt;/span&gt;&lt;/span&gt;,'</span>, <span class="hljs-string">'            &lt;span&gt;Hold Size:&lt;span&gt;'</span>, ship.hold_size, <span class="hljs-string">'&lt;/span&gt;&lt;/span&gt;,'</span>, <span class="hljs-string">'            &lt;span&gt;Stealth:&lt;span&gt;'</span>, ship.stealth, <span class="hljs-string">'&lt;/span&gt;&lt;/span&gt;'</span>, <span class="hljs-string">'            &lt;span&gt;Combat:&lt;span&gt;'</span>, ship.combat, <span class="hljs-string">'&lt;/span&gt;&lt;/span&gt;'</span>, <span class="hljs-string">'        &lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;div class="yui-u" style="width:8%"&gt;'</span>,
                        ship.task === <span class="hljs-string">"Docked"</span> ? <span class="hljs-string">'        &lt;button type="button"&gt;Send&lt;/button&gt;'</span> : <span class="hljs-string">''</span>, <span class="hljs-string">'    &lt;/div&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>
                    ].join(<span class="hljs-string">''</span>);
                    <span class="hljs-keyword">if</span> (ship.task === <span class="hljs-string">"Docked"</span>) {
                        Event.on(Sel.query(<span class="hljs-string">"button"</span>, nLi, <span class="hljs-literal">true</span>), <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.ShipSend, {
                            Self: <span class="hljs-keyword">this</span>,
                            Ship: ship,
                            Target: target,
                            Line: nLi
                        }, <span class="hljs-literal">true</span>);
                    }
                    details.appendChild(nLi);
                }
            }
            detailsParent.appendChild(details); <span class="hljs-comment">//add back as child</span>
            <span class="hljs-comment">//wait for tab to display first</span>
            setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">var</span> Ht = Game.GetSize()
                    .h - <span class="hljs-number">250</span>;
                <span class="hljs-keyword">if</span> (Ht &gt; <span class="hljs-number">250</span>) {
                    Ht = <span class="hljs-number">250</span>;
                }
                Dom.setStyle(detailsParent, <span class="hljs-string">"height"</span>, Ht + <span class="hljs-string">"px"</span>);
                Dom.setStyle(detailsParent, <span class="hljs-string">"overflow-y"</span>, <span class="hljs-string">"auto"</span>);
            }, <span class="hljs-number">10</span>);
        },
        ShipSend: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
            <span class="hljs-keyword">var</span> btn = Event.getTarget(e);
            btn.disabled = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">var</span> oSelf = <span class="hljs-keyword">this</span>.Self,
                ship = <span class="hljs-keyword">this</span>.Ship,
                target = <span class="hljs-keyword">this</span>.Target;
            <span class="hljs-keyword">if</span> (target &amp;&amp; ship.id &amp;&amp; Lacuna.MapStar.NotIsolationist(ship)) {
                Lacuna.Pulser.Show();
                oSelf.service.send_ship({
                    session_id: Game.GetSession(),
                    ship_id: ship.id,
                    target: target
                }, {
                    success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                        Lacuna.Pulser.Hide();
                        <span class="hljs-keyword">this</span>.Self.rpcSuccess(o);
                        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.Self.shipsView;
                        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.Self.shipsTravelling;
                        <span class="hljs-keyword">this</span>.Self.GetShipsFor();
                        Event.purgeElement(<span class="hljs-keyword">this</span>.Line, <span class="hljs-literal">true</span>);
                        <span class="hljs-keyword">this</span>.Line.innerHTML = <span class="hljs-string">"Successfully sent "</span> + <span class="hljs-keyword">this</span>.Ship.type_human + <span class="hljs-string">"."</span>;
                    },
                    failure: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                        btn.disabled = <span class="hljs-literal">false</span>;
                    },
                    scope: <span class="hljs-keyword">this</span>
                });
            } <span class="hljs-keyword">else</span> {
                btn.disabled = <span class="hljs-literal">false</span>;
            }
        },
        GetFleetFor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            Lacuna.Pulser.Show();
            Dom.setStyle(<span class="hljs-string">"sendFleetSend"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"none"</span>);
            <span class="hljs-keyword">var</span> type = Lib.getSelectedOptionValue(<span class="hljs-string">"sendFleetType"</span>),
                target = {};
            <span class="hljs-keyword">if</span> (type === <span class="hljs-string">"xy"</span>) {
                target.x = Dom.get(<span class="hljs-string">"sendFleetTargetX"</span>)
                    .value;
                target.y = Dom.get(<span class="hljs-string">"sendFleetTargetY"</span>)
                    .value;
                Dom.get(<span class="hljs-string">"sendFleetNote"</span>)
                    .innerHTML = [<span class="hljs-string">'X: '</span>, target.x, <span class="hljs-string">' - Y: '</span>, target.y].join(<span class="hljs-string">''</span>);
            } <span class="hljs-keyword">else</span> {
                target[type] = Dom.get(<span class="hljs-string">"sendFleetTargetText"</span>)
                    .value;
                Dom.get(<span class="hljs-string">"sendFleetNote"</span>)
                    .innerHTML = target[type];
            }
            <span class="hljs-keyword">this</span>.service.get_ships_for({
                session_id: Game.GetSession(),
                from_body_id: Game.GetCurrentPlanet()
                    .id,
                target: target
            }, {
                success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                    Lacuna.Pulser.Hide();
                    <span class="hljs-keyword">this</span>.rpcSuccess(o);
                    <span class="hljs-keyword">this</span>.PopulateFleetSendTab(target, o.result.available);
                },
                scope: <span class="hljs-keyword">this</span>
            });
        },
        PopulateFleetSendTab: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(target, ships)</span> {</span>
            <span class="hljs-keyword">var</span> details = Dom.get(<span class="hljs-string">"sendFleetAvail"</span>),
                detailsParent = details.parentNode,
                li = document.createElement(<span class="hljs-string">"li"</span>);
            Event.purgeElement(details, <span class="hljs-literal">true</span>); <span class="hljs-comment">//clear any events before we remove</span>
            details = detailsParent.removeChild(details); <span class="hljs-comment">//remove from DOM to make this faster</span>
            details.innerHTML = <span class="hljs-string">""</span>;
            <span class="hljs-keyword">this</span>.FleetTarget = target;
            Dom.setStyle(<span class="hljs-string">"sendFleetSend"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">""</span>);
            <span class="hljs-keyword">if</span> (ships.length === <span class="hljs-number">0</span>) {
                details.innerHTML = <span class="hljs-string">"No available ships to send."</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ships.length; i++) {
                    <span class="hljs-keyword">var</span> ship = ships[i],
                        nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    nLi.innerHTML = [<span class="hljs-string">'&lt;div class="yui-gd" style="margin-bottom:2px;"&gt;'</span>, <span class="hljs-string">'    &lt;div class="yui-u first" style="width:15%;background:transparent url('</span>, Lib.AssetUrl, <span class="hljs-string">'star_system/field.png) no-repeat center;text-align:center;"&gt;'</span>, <span class="hljs-string">'        &lt;img src="'</span>, Lib.AssetUrl, <span class="hljs-string">'ships/'</span>, ship.type, <span class="hljs-string">'.png" style="width:60px;height:60px;" /&gt;'</span>, <span class="hljs-string">'    &lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;div class="yui-u" style="width:67%"&gt;'</span>, <span class="hljs-string">'        &lt;div class="buildingName"&gt;['</span>, ship.type_human, <span class="hljs-string">'] '</span>, ship.name, <span class="hljs-string">'&lt;/div&gt;'</span>, <span class="hljs-string">'        &lt;div&gt;&lt;label style="font-weight:bold;"&gt;Details:&lt;/label&gt;'</span>, <span class="hljs-string">'            &lt;span&gt;Task:&lt;span&gt;'</span>, ship.task, <span class="hljs-string">'&lt;/span&gt;&lt;/span&gt;,'</span>, <span class="hljs-string">'            &lt;span&gt;Travel Time:&lt;span&gt;'</span>, Lib.formatTime(ship.estimated_travel_time), <span class="hljs-string">'&lt;/span&gt;&lt;/span&gt;'</span>, <span class="hljs-string">'        &lt;/div&gt;'</span>, <span class="hljs-string">'        &lt;div&gt;&lt;label style="font-weight:bold;"&gt;Attributes:&lt;/label&gt;'</span>, <span class="hljs-string">'            &lt;span&gt;Speed:&lt;span&gt;'</span>, ship.speed, <span class="hljs-string">'&lt;/span&gt;&lt;/span&gt;,'</span>, <span class="hljs-string">'            &lt;span&gt;Hold Size:&lt;span&gt;'</span>, ship.hold_size, <span class="hljs-string">'&lt;/span&gt;&lt;/span&gt;,'</span>, <span class="hljs-string">'            &lt;span&gt;Stealth:&lt;span&gt;'</span>, ship.stealth, <span class="hljs-string">'&lt;/span&gt;&lt;/span&gt;'</span>, <span class="hljs-string">'            &lt;span&gt;Combat:&lt;span&gt;'</span>, ship.combat, <span class="hljs-string">'&lt;/span&gt;&lt;/span&gt;'</span>, <span class="hljs-string">'        &lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;div class="yui-u" style="width:8%"&gt;'</span>,
                        ship.task === <span class="hljs-string">"Docked"</span> ? <span class="hljs-string">'&lt;input type="checkbox" /&gt;'</span> : <span class="hljs-string">''</span>, <span class="hljs-string">'    &lt;/div&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>
                    ].join(<span class="hljs-string">''</span>);
                    <span class="hljs-keyword">if</span> (ship.task === <span class="hljs-string">"Docked"</span>) {
                        Sel.query(<span class="hljs-string">"input"</span>, nLi, <span class="hljs-literal">true</span>)
                            .Ship = ship;
                    }
                    details.appendChild(nLi);
                }
            }
            detailsParent.appendChild(details); <span class="hljs-comment">//add back as child</span>
            <span class="hljs-comment">//wait for tab to display first</span>
            setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">var</span> Ht = Game.GetSize()
                    .h - <span class="hljs-number">250</span>;
                <span class="hljs-keyword">if</span> (Ht &gt; <span class="hljs-number">250</span>) {
                    Ht = <span class="hljs-number">250</span>;
                }
                Dom.setStyle(detailsParent, <span class="hljs-string">"height"</span>, Ht + <span class="hljs-string">"px"</span>);
                Dom.setStyle(detailsParent, <span class="hljs-string">"overflow-y"</span>, <span class="hljs-string">"auto"</span>);
            }, <span class="hljs-number">10</span>);
        },
        FleetSend: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
            <span class="hljs-keyword">var</span> btn = Event.getTarget(e);
            btn.disabled = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">var</span> speed = <span class="hljs-built_in">parseInt</span>(Dom.get(<span class="hljs-string">"setSpeed"</span>)
                .value, <span class="hljs-number">10</span>);
            <span class="hljs-keyword">var</span> selected = Sel.query(<span class="hljs-string">"input:checked"</span>, <span class="hljs-string">"sendFleetAvail"</span>);
            <span class="hljs-keyword">if</span> (selected.length &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">var</span> ships = [],
                    shipIds = [],
                    minSpeed = <span class="hljs-number">999999999</span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span>; n &lt; selected.length; n++) {
                    <span class="hljs-keyword">var</span> s = selected[n].Ship;
                    s.speed = <span class="hljs-built_in">parseInt</span>(s.speed, <span class="hljs-number">10</span>); <span class="hljs-comment">// probably not needed but play it safe</span>
                    ships.push(s);
                    shipIds.push(s.id);
                    <span class="hljs-keyword">if</span> (s.speed &lt; minSpeed) {
                        minSpeed = s.speed;
                    }
                }
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.FleetTarget &amp;&amp; Lacuna.MapStar.NotFleetIsolationist(ships)) {
                    <span class="hljs-keyword">if</span> (speed &lt; <span class="hljs-number">0</span>) {
                        alert(<span class="hljs-string">'Set speed cannot be less than zero.'</span>);
                        btn.disabled = <span class="hljs-literal">false</span>;
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">if</span> (speed &gt; <span class="hljs-number">0</span> &amp;&amp; speed &gt; minSpeed) {
                            alert(<span class="hljs-string">'Set speed cannot exceed the speed of the slowest ship.'</span>);
                            btn.disabled = <span class="hljs-literal">false</span>;
                        } <span class="hljs-keyword">else</span> {
                            <span class="hljs-keyword">this</span>.service.send_fleet({
                                session_id: Game.GetSession(),
                                ship_ids: shipIds,
                                target: <span class="hljs-keyword">this</span>.FleetTarget,
                                set_speed: speed
                            }, {
                                success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                                    Lacuna.Pulser.Hide();
                                    <span class="hljs-keyword">this</span>.rpcSuccess(o);
                                    btn.disabled = <span class="hljs-literal">false</span>;
                                    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.FleetTarget;
                                    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.shipsView;
                                    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.shipsTravelling;
                                    <span class="hljs-keyword">this</span>.GetFleetFor();
                                },
                                failure: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                                    btn.disabled = <span class="hljs-literal">false</span>;
                                },
                                scope: <span class="hljs-keyword">this</span>
                            });
                        }
                    }
                }
            } <span class="hljs-keyword">else</span> {
                btn.disabled = <span class="hljs-literal">false</span>;
            }
        }
    });
    YAHOO.lacuna.buildings.SpacePort = SpacePort;
})();</pre></div>
      
      </div>
    
    </div>
  </div>

  <script src="../../../toc.js"></script>
  <script src="../../../assets/libs.js"></script>
  <script src="../../../assets/behavior.js"></script>
</body>
</html>