<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title> - transporter.js</title>

  <link rel="stylesheet" href="../../../assets/style.css">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"/>
  <meta name="groc-relative-root" content="../../../"/>
  <meta name="groc-document-path" content="app/js/building/transporter.js"/>
  
</head>
<body>
  <div id="file-area">
    <div id="meta">
      <code class="file-path">
      
        app/js/building/transporter.js
      
      </code>
    </div>
    <div id="document">
    
      <div class="segment">
      
      
        <div class="code"><pre class="wrapper"><span class="hljs-pi">'use strict'</span>;
YAHOO.namespace(<span class="hljs-string">"lacuna.buildings"</span>);
(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> Lang = YAHOO.lang,
        Util = YAHOO.util,
        Dom = Util.Dom,
        Event = Util.Event,
        Sel = Util.Selector,
        Pager = YAHOO.widget.Paginator,
        Lacuna = YAHOO.lacuna,
        Game = Lacuna.Game,
        Lib = Lacuna.Library;
    <span class="hljs-keyword">var</span> Transporter = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(result)</span> {</span>
        Transporter.superclass.constructor.call(<span class="hljs-keyword">this</span>, result);
        <span class="hljs-keyword">this</span>.transport = result.transport;
        <span class="hljs-keyword">this</span>.service = Game.Services.Buildings.Transporter;
        <span class="hljs-keyword">this</span>.availableAcceptText = <span class="hljs-string">"Accept For 1 Essentia"</span>;
        <span class="hljs-keyword">this</span>.addTradeText = <span class="hljs-string">"Add Trade For 1 Essentia"</span>;
        <span class="hljs-keyword">this</span>.pushTradeText = <span class="hljs-string">"Send For 2 Essentia"</span>;</pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>defaults.  Values are updated to server numbers during get_* calls</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">        <span class="hljs-keyword">this</span>.shipSize = <span class="hljs-number">50000</span>;
        <span class="hljs-keyword">this</span>.planSize = <span class="hljs-number">10000</span>;
        <span class="hljs-keyword">this</span>.spySize = <span class="hljs-number">350</span>;
        <span class="hljs-keyword">this</span>.glyphSize = <span class="hljs-number">100</span>;
        <span class="hljs-keyword">this</span>.createEvent(<span class="hljs-string">"onLoadResources"</span>);
        <span class="hljs-keyword">this</span>.createEvent(<span class="hljs-string">"onLoadGlyphs"</span>);
        <span class="hljs-keyword">this</span>.createEvent(<span class="hljs-string">"onLoadPlans"</span>);
        <span class="hljs-keyword">this</span>.createEvent(<span class="hljs-string">"onLoadShips"</span>);
        <span class="hljs-keyword">this</span>.createEvent(<span class="hljs-string">"onLoadPrisoners"</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.building.level &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">var</span> p = document.createElement(<span class="hljs-string">"p"</span>);
            p.innerHTML = <span class="hljs-string">"Transporter has a maximum capacity of "</span> + <span class="hljs-keyword">this</span>.transport.max + <span class="hljs-string">" at this level."</span>;
            Dom.setStyle(p, <span class="hljs-string">"margin-top"</span>, <span class="hljs-string">"5px"</span>);
            Dom.setStyle(p, <span class="hljs-string">"font-style"</span>, <span class="hljs-string">"italic"</span>);
            Dom.get(<span class="hljs-string">"buildingDetailsDesc"</span>)
                .appendChild(p);
            <span class="hljs-keyword">this</span>.subscribe(<span class="hljs-string">"onLoad"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">this</span>.getStoredResources();
                <span class="hljs-keyword">this</span>.mine.subscribe(<span class="hljs-string">"activeChange"</span>, <span class="hljs-keyword">this</span>.getMine, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                <span class="hljs-keyword">this</span>.avail.subscribe(<span class="hljs-string">"activeChange"</span>, <span class="hljs-keyword">this</span>.getAvailable, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                <span class="hljs-keyword">this</span>.push.subscribe(<span class="hljs-string">"activeChange"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
                    <span class="hljs-keyword">if</span> (e.newValue) {
                        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.tradePushSubbed) {
                            Event.on(<span class="hljs-string">"tradePushResources"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                                <span class="hljs-keyword">if</span> (Dom.getStyle(<span class="hljs-string">"tradePushResourceName"</span>, <span class="hljs-string">"display"</span>) === <span class="hljs-string">"none"</span>) {
                                    Dom.setStyle(<span class="hljs-string">"tradePushResourceName"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"block"</span>);
                                    <span class="hljs-keyword">this</span>.getStoredResources();
                                } <span class="hljs-keyword">else</span> {
                                    Dom.setStyle(<span class="hljs-string">"tradePushResourceName"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"none"</span>);
                                }
                            }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                            Event.on(<span class="hljs-string">"tradePushGlyphs"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                                <span class="hljs-keyword">if</span> (Dom.getStyle(<span class="hljs-string">"tradePushGlyphName"</span>, <span class="hljs-string">"display"</span>) === <span class="hljs-string">"none"</span>) {
                                    Dom.setStyle(<span class="hljs-string">"tradePushGlyphName"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"block"</span>);
                                    <span class="hljs-keyword">this</span>.getGlyphs();
                                } <span class="hljs-keyword">else</span> {
                                    Dom.setStyle(<span class="hljs-string">"tradePushGlyphName"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"none"</span>);
                                }
                            }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                            Event.on(<span class="hljs-string">"tradePushPlans"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                                <span class="hljs-keyword">if</span> (Dom.getStyle(<span class="hljs-string">"tradePushPlanName"</span>, <span class="hljs-string">"display"</span>) === <span class="hljs-string">"none"</span>) {
                                    Dom.setStyle(<span class="hljs-string">"tradePushPlanName"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"block"</span>);
                                    <span class="hljs-keyword">this</span>.getPlans();
                                } <span class="hljs-keyword">else</span> {
                                    Dom.setStyle(<span class="hljs-string">"tradePushPlanName"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"none"</span>);
                                }
                            }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                            Event.on(<span class="hljs-string">"tradePushShips"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                                <span class="hljs-keyword">if</span> (Dom.getStyle(<span class="hljs-string">"tradePushShipName"</span>, <span class="hljs-string">"display"</span>) === <span class="hljs-string">"none"</span>) {
                                    Dom.setStyle(<span class="hljs-string">"tradePushShipName"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"block"</span>);
                                    <span class="hljs-keyword">this</span>.getShips();
                                } <span class="hljs-keyword">else</span> {
                                    Dom.setStyle(<span class="hljs-string">"tradePushShipName"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"none"</span>);
                                }
                            }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                            Event.on(<span class="hljs-string">"tradePushPrisoners"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                                <span class="hljs-keyword">if</span> (Dom.getStyle(<span class="hljs-string">"tradePushPrisonerName"</span>, <span class="hljs-string">"display"</span>) === <span class="hljs-string">"none"</span>) {
                                    Dom.setStyle(<span class="hljs-string">"tradePushPrisonerName"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"block"</span>);
                                    <span class="hljs-keyword">this</span>.getPrisoners();
                                } <span class="hljs-keyword">else</span> {
                                    Dom.setStyle(<span class="hljs-string">"tradePushPrisonerName"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"none"</span>);
                                }
                            }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                        }
                        <span class="hljs-keyword">this</span>.tradePushSubbed = <span class="hljs-number">1</span>;
                    }
                }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                <span class="hljs-keyword">this</span>.add.subscribe(<span class="hljs-string">"activeChange"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
                    <span class="hljs-keyword">if</span> (e.newValue) {
                        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.tradeAddSubbed) {
                            Event.on(<span class="hljs-string">"tradeAddResources"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                                <span class="hljs-keyword">if</span> (Dom.getStyle(<span class="hljs-string">"tradeAddResourceName"</span>, <span class="hljs-string">"display"</span>) === <span class="hljs-string">"none"</span>) {
                                    Dom.setStyle(<span class="hljs-string">"tradeAddResourceName"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"block"</span>);
                                    <span class="hljs-keyword">this</span>.getStoredResources();
                                } <span class="hljs-keyword">else</span> {
                                    Dom.setStyle(<span class="hljs-string">"tradeAddResourceName"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"none"</span>);
                                }
                            }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                            Event.on(<span class="hljs-string">"tradeAddGlyphs"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                                <span class="hljs-keyword">if</span> (Dom.getStyle(<span class="hljs-string">"tradeAddGlyphName"</span>, <span class="hljs-string">"display"</span>) === <span class="hljs-string">"none"</span>) {
                                    Dom.setStyle(<span class="hljs-string">"tradeAddGlyphName"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"block"</span>);
                                    <span class="hljs-keyword">this</span>.getGlyphs();
                                } <span class="hljs-keyword">else</span> {
                                    Dom.setStyle(<span class="hljs-string">"tradeAddGlyphName"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"none"</span>);
                                }
                            }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                            Event.on(<span class="hljs-string">"tradeAddPlans"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                                <span class="hljs-keyword">if</span> (Dom.getStyle(<span class="hljs-string">"tradeAddPlanName"</span>, <span class="hljs-string">"display"</span>) === <span class="hljs-string">"none"</span>) {
                                    Dom.setStyle(<span class="hljs-string">"tradeAddPlanName"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"block"</span>);
                                    <span class="hljs-keyword">this</span>.getPlans();
                                } <span class="hljs-keyword">else</span> {
                                    Dom.setStyle(<span class="hljs-string">"tradeAddPlanName"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"none"</span>);
                                }
                            }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                            Event.on(<span class="hljs-string">"tradeAddShips"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                                <span class="hljs-keyword">if</span> (Dom.getStyle(<span class="hljs-string">"tradeAddShipName"</span>, <span class="hljs-string">"display"</span>) === <span class="hljs-string">"none"</span>) {
                                    Dom.setStyle(<span class="hljs-string">"tradeAddShipName"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"block"</span>);
                                    <span class="hljs-keyword">this</span>.getShips();
                                } <span class="hljs-keyword">else</span> {
                                    Dom.setStyle(<span class="hljs-string">"tradeAddShipName"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"none"</span>);
                                }
                            }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                            Event.on(<span class="hljs-string">"tradeAddPrisoners"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                                <span class="hljs-keyword">if</span> (Dom.getStyle(<span class="hljs-string">"tradeAddPrisonerName"</span>, <span class="hljs-string">"display"</span>) === <span class="hljs-string">"none"</span>) {
                                    Dom.setStyle(<span class="hljs-string">"tradeAddPrisonerName"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"block"</span>);
                                    <span class="hljs-keyword">this</span>.getPrisoners();
                                } <span class="hljs-keyword">else</span> {
                                    Dom.setStyle(<span class="hljs-string">"tradeAddPrisonerName"</span>, <span class="hljs-string">"display"</span>, <span class="hljs-string">"none"</span>);
                                }
                            }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                        }
                        <span class="hljs-keyword">this</span>.tradeAddSubbed = <span class="hljs-number">1</span>;
                    }
                }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
        }
    };
    Lang.extend(Transporter, Lacuna.buildings.Building, {
        destroy: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.availablePager) {
                <span class="hljs-keyword">this</span>.availablePager.destroy();
            }
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.minePage) {
                <span class="hljs-keyword">this</span>.minePage.destroy();
            }
            Transporter.superclass.destroy.call(<span class="hljs-keyword">this</span>);
        },
        getChildTabs: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">this</span>.mineTabIndex = <span class="hljs-number">4</span>; <span class="hljs-comment">//array location plus 1 since Production tab is always first</span>
            <span class="hljs-keyword">return</span> [<span class="hljs-keyword">this</span>._getOneForOneTab(), <span class="hljs-keyword">this</span>._getPushTab(), <span class="hljs-keyword">this</span>._getAvailTab(), <span class="hljs-keyword">this</span>._getMineTab(), <span class="hljs-keyword">this</span>._getAddTab()];
        },
        _getOneForOneTab: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">this</span>.oneForOne = <span class="hljs-keyword">new</span> YAHOO.widget.Tab({
                label: <span class="hljs-string">"One For One"</span>,
                content: [<span class="hljs-string">'&lt;div class="transporterOneForOne"&gt;'</span>, <span class="hljs-string">'&lt;div&gt;You may trade one-for-one with Lacuna Corp for 3&lt;img src="'</span>, Lib.AssetUrl, <span class="hljs-string">'ui/s/essentia.png" class="smallEssentia smallImg" /&gt; per transaction.&lt;/div&gt;'</span>, <span class="hljs-string">'&lt;ul&gt;'</span>, <span class="hljs-string">'    &lt;li&gt;&lt;label&gt;Want:&lt;/label&gt;&lt;select id="transporterOneForOneWant"&gt;&lt;/select&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'    &lt;li&gt;&lt;label&gt;Have:&lt;/label&gt;&lt;select id="transporterOneForOneHave"&gt;&lt;/select&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'    &lt;li&gt;&lt;label&gt;Quantity:&lt;/label&gt;&lt;input type="text" id="transporterOneForOneQuantity" /&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'    &lt;li id="transporterOneForOneMessage" class="alert"&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'    &lt;li&gt;&lt;button id="transporterOneForOneTrade"&gt;Submit Trade for 3 Essentia&lt;/button&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'&lt;/ul&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>].join(<span class="hljs-string">''</span>)
            });
            <span class="hljs-keyword">this</span>.subscribe(<span class="hljs-string">"onLoadResources"</span>, <span class="hljs-keyword">this</span>.populateOneForOneHave, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            Event.onAvailable(<span class="hljs-string">"transporterOneForOneWant"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
                <span class="hljs-keyword">var</span> elm = Dom.get(<span class="hljs-string">"transporterOneForOneWant"</span>),
                    opt = document.createElement(<span class="hljs-string">"option"</span>),
                    nOpt, optGroup;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> r <span class="hljs-keyword">in</span> Lib.ResourceTypes) {
                    <span class="hljs-keyword">if</span> (Lib.ResourceTypes.hasOwnProperty(r)) {
                        <span class="hljs-keyword">var</span> resource = Lib.ResourceTypes[r];
                        <span class="hljs-keyword">if</span> (Lang.isArray(resource)) {
                            optGroup = document.createElement(<span class="hljs-string">"optgroup"</span>);
                            optGroup.label = r.titleCaps();
                            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>; x &lt; resource.length; x++) {
                                nOpt = opt.cloneNode(<span class="hljs-literal">false</span>);
                                nOpt.value = resource[x];
                                nOpt.innerHTML = resource[x].titleCaps();
                                optGroup.appendChild(nOpt);
                            }
                            elm.appendChild(optGroup);
                        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (resource) {
                            nOpt = opt.cloneNode(<span class="hljs-literal">false</span>);
                            nOpt.value = r;
                            nOpt.innerHTML = r.titleCaps();
                            elm.appendChild(nOpt);
                        }
                    }
                }
            }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            Event.on(<span class="hljs-string">"transporterOneForOneTrade"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.Trade, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.oneForOne;
        },
        _getPushTab: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">this</span>.push = <span class="hljs-keyword">new</span> YAHOO.widget.Tab({
                label: <span class="hljs-string">"Push"</span>,
                content: [<span class="hljs-string">'&lt;div id="pHt"&gt;&lt;div class="tradeStash yui-g"&gt;'</span>, <span class="hljs-string">'    &lt;div class="yui-u first"&gt;'</span>, <span class="hljs-string">'        &lt;legend&gt;On Planet&lt;/legend&gt;'</span>, <span class="hljs-string">'        &lt;div class="tradeContainers"&gt;'</span>, <span class="hljs-string">'            &lt;div&gt;&lt;div id="tradePushResources" class="accordian"&gt;Resources&lt;/div&gt;&lt;ul id="tradePushResourceName"&gt;&lt;/ul&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'            &lt;div&gt;&lt;div id="tradePushGlyphs" class="accordian"&gt;Glyphs&lt;/div&gt;&lt;ul id="tradePushGlyphName" style="display:none;"&gt;&lt;/ul&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'            &lt;div&gt;&lt;div id="tradePushPlans" class="accordian"&gt;Plans&lt;/div&gt;&lt;ul id="tradePushPlanName" style="display:none;"&gt;&lt;/ul&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'            &lt;div&gt;&lt;div id="tradePushShips" class="accordian"&gt;Ships&lt;/div&gt;&lt;ul id="tradePushShipName" style="display:none;"&gt;&lt;/ul&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'            &lt;div&gt;&lt;div id="tradePushPrisoners" class="accordian"&gt;Prisoners&lt;/div&gt;&lt;ul id="tradePushPrisonerName" style="display:none;"&gt;&lt;/ul&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'        &lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;div class="yui-u"&gt;'</span>, <span class="hljs-string">'        &lt;legend&gt;To Push&lt;/legend&gt;'</span>, <span class="hljs-string">'        &lt;div class="tradeContainers"&gt;&lt;ul id="tradePushItems"&gt;&lt;/ul&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;/div&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>, <span class="hljs-string">'&lt;ul style="margin-top:5px;"&gt;'</span>, <span class="hljs-string">'    &lt;li style=""&gt;&lt;label&gt;Total Cargo:&lt;/label&gt;&lt;span id="tradePushCargo"&gt;0&lt;/span&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'    &lt;li style="margin-bottom:5px;"&gt;&lt;label&gt;To Colony:&lt;/label&gt;&lt;select id="tradePushColony"&gt;&lt;option value="" selected&gt;&lt;/option&gt;&lt;/select&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'    &lt;li id="tradePushMessage" class="alert"&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'&lt;/ul&gt;&lt;/div&gt;&lt;button id="tradePushSend"&gt;'</span>, <span class="hljs-keyword">this</span>.pushTradeText, <span class="hljs-string">'&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>)
            });
            <span class="hljs-keyword">this</span>.subscribe(<span class="hljs-string">"onLoadResources"</span>, <span class="hljs-keyword">this</span>.populatePushResourceName, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">this</span>.subscribe(<span class="hljs-string">"onLoadGlyphs"</span>, <span class="hljs-keyword">this</span>.populatePushGlyphName, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">this</span>.subscribe(<span class="hljs-string">"onLoadPlans"</span>, <span class="hljs-keyword">this</span>.populatePushPlanName, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">this</span>.subscribe(<span class="hljs-string">"onLoadShips"</span>, <span class="hljs-keyword">this</span>.populatePushShipName, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">this</span>.subscribe(<span class="hljs-string">"onLoadPrisoners"</span>, <span class="hljs-keyword">this</span>.populatePushPrisonerName, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            Event.onAvailable(<span class="hljs-string">"tradePushColony"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">var</span> opt = document.createElement(<span class="hljs-string">"option"</span>),
                    planets = Lib.planetarySort(Game.EmpireData.planets),
                    cp = Game.GetCurrentPlanet(),
                    nOpt;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p = <span class="hljs-number">0</span>; p &lt; planets.length; p++) {
                    <span class="hljs-keyword">if</span> (planets[p].id !== cp.id) {
                        nOpt = opt.cloneNode(<span class="hljs-literal">false</span>);
                        nOpt.value = planets[p].id;
                        nOpt.innerHTML = planets[p].name;
                        <span class="hljs-keyword">this</span>.appendChild(nOpt);
                    }
                }
            });
            Event.delegate(<span class="hljs-string">"tradePushResourceName"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.PushAddResource, <span class="hljs-string">"button"</span>, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            Event.delegate(<span class="hljs-string">"tradePushGlyphName"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.PushAddGlyph, <span class="hljs-string">"button"</span>, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            Event.delegate(<span class="hljs-string">"tradePushPlanName"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.PushAddPlan, <span class="hljs-string">"button"</span>, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            Event.delegate(<span class="hljs-string">"tradePushShipName"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.PushAddShip, <span class="hljs-string">"button"</span>, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            Event.delegate(<span class="hljs-string">"tradePushPrisonerName"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.PushAddPrisoner, <span class="hljs-string">"button"</span>, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            Event.delegate(<span class="hljs-string">"tradePushItems"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.PushRemove, <span class="hljs-string">"button"</span>, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            Event.on(<span class="hljs-string">"tradePushSend"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.Push, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.push;
        },
        _getAvailTab: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">this</span>.avail = <span class="hljs-keyword">new</span> YAHOO.widget.Tab({
                label: <span class="hljs-string">"Available Trades"</span>,
                content: [<span class="hljs-string">'&lt;div&gt;'</span>, <span class="hljs-string">'    &lt;div style="border-bottom: 1px solid #52ACFF; padding-bottom: 5px; margin-bottom: 5px;"&gt;&lt;label&gt;Filter:&lt;/label&gt;&lt;select id="tradeFilter"&gt;&lt;option value=""&gt;All&lt;/option&gt;&lt;option value="energy"&gt;Energy&lt;/option&gt;&lt;option value="food"&gt;Food&lt;/option&gt;&lt;option value="ore"&gt;Ore&lt;/option&gt;'</span>, <span class="hljs-string">'    &lt;option value="water"&gt;Water&lt;/option&gt;&lt;option value="waste"&gt;Waste&lt;/option&gt;&lt;option value="glyph"&gt;Glyph&lt;/option&gt;&lt;option value="prisoner"&gt;Prisoner&lt;/option&gt;'</span>, <span class="hljs-string">'    &lt;option value="ship"&gt;Ship&lt;/option&gt;&lt;option value="plan"&gt;Plan&lt;/option&gt;&lt;/select&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;ul class="tradeHeader tradeInfo clearafter"&gt;'</span>, <span class="hljs-string">'        &lt;li class="tradeEmpire"&gt;Empire&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li class="tradeOfferedDate"&gt;Offered Date&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li class="tradeAsking"&gt;Cost&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li class="tradeOffer"&gt;Offering&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li class="tradeAction"&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li class="tradeAction"&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'    &lt;/ul&gt;'</span>, <span class="hljs-string">'    &lt;div&gt;&lt;div id="tradeAvailableDetails"&gt;&lt;/div&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;div id="tradeAvailablePaginator"&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>].join(<span class="hljs-string">''</span>)
            });
            Event.on(<span class="hljs-string">"tradeFilter"</span>, <span class="hljs-string">"change"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
                <span class="hljs-keyword">this</span>.getAvailable({
                    newValue: <span class="hljs-literal">true</span>
                });
            }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.avail;
        },
        _getMineTab: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">this</span>.mine = <span class="hljs-keyword">new</span> YAHOO.widget.Tab({
                label: <span class="hljs-string">"My Trades"</span>,
                content: [<span class="hljs-string">'&lt;div class="myTrades"&gt;'</span>, <span class="hljs-string">'    &lt;ul class="tradeHeader tradeInfo clearafter"&gt;'</span>, <span class="hljs-string">'        &lt;li class="tradeOfferedDate"&gt;Offered Date&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li class="tradeAsking"&gt;Cost&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li class="tradeOffer"&gt;Offering&lt;/li&gt;'</span>, <span class="hljs-string">'        &lt;li class="tradeAction"&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'    &lt;/ul&gt;'</span>, <span class="hljs-string">'    &lt;div&gt;&lt;div id="tradeMineDetails"&gt;&lt;/div&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;div id="tradeMinePaginator"&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>].join(<span class="hljs-string">''</span>)
            });
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.mine;
        },
        _getAddTab: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">this</span>.add = <span class="hljs-keyword">new</span> YAHOO.widget.Tab({
                label: <span class="hljs-string">"Add Trade"</span>,
                content: [<span class="hljs-string">'&lt;div id="aHt"&gt;&lt;div class="tradeStash yui-g"&gt;'</span>, <span class="hljs-string">'    &lt;div class="yui-u first"&gt;'</span>, <span class="hljs-string">'        &lt;legend&gt;On Planet&lt;/legend&gt;'</span>, <span class="hljs-string">'        &lt;div class="tradeContainers"&gt;'</span>, <span class="hljs-string">'            &lt;div&gt;&lt;div id="tradeAddResources" class="accordian"&gt;Resources&lt;/div&gt;&lt;ul id="tradeAddResourceName"&gt;&lt;/ul&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'            &lt;div&gt;&lt;div id="tradeAddGlyphs" class="accordian"&gt;Glyphs&lt;/div&gt;&lt;ul id="tradeAddGlyphName" style="display:none;"&gt;&lt;/ul&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'            &lt;div&gt;&lt;div id="tradeAddPlans" class="accordian"&gt;Plans&lt;/div&gt;&lt;ul id="tradeAddPlanName" style="display:none;"&gt;&lt;/ul&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'            &lt;div&gt;&lt;div id="tradeAddShips" class="accordian"&gt;Ships&lt;/div&gt;&lt;ul id="tradeAddShipName" style="display:none;"&gt;&lt;/ul&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'            &lt;div&gt;&lt;div id="tradeAddPrisoners" class="accordian"&gt;Prisoners&lt;/div&gt;&lt;ul id="tradeAddPrisonerName" style="display:none;"&gt;&lt;/ul&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'        &lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;div class="yui-u"&gt;'</span>, <span class="hljs-string">'        &lt;legend&gt;To Offer&lt;/legend&gt;'</span>, <span class="hljs-string">'        &lt;div class="tradeContainers"&gt;&lt;ul id="tradeAddItems"&gt;&lt;/ul&gt;&lt;/div&gt;'</span>, <span class="hljs-string">'    &lt;/div&gt;'</span>, <span class="hljs-string">'&lt;/div&gt;'</span>, <span class="hljs-string">'&lt;ul style="margin-top:5px;"&gt;'</span>, <span class="hljs-string">'    &lt;li style=""&gt;&lt;label&gt;Total Cargo:&lt;/label&gt;&lt;span id="tradeAddCargo"&gt;0&lt;/span&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'    &lt;li style="margin: 5px 0;"&gt;&lt;label style="font-weight:bold"&gt;Asking Essentia:&lt;/label&gt;&lt;input type="text" id="tradeAddAskingQuantity" /&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'    &lt;li id="tradeAddMessage" class="alert"&gt;&lt;/li&gt;'</span>, <span class="hljs-string">'&lt;/ul&gt;&lt;/div&gt;&lt;button id="tradeAdd"&gt;'</span>, <span class="hljs-keyword">this</span>.addTradeText, <span class="hljs-string">'&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>)
            });
            <span class="hljs-keyword">this</span>.subscribe(<span class="hljs-string">"onLoadResources"</span>, <span class="hljs-keyword">this</span>.populateAddResourceName, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">this</span>.subscribe(<span class="hljs-string">"onLoadGlyphs"</span>, <span class="hljs-keyword">this</span>.populateAddGlyphName, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">this</span>.subscribe(<span class="hljs-string">"onLoadPlans"</span>, <span class="hljs-keyword">this</span>.populateAddPlanName, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">this</span>.subscribe(<span class="hljs-string">"onLoadPrisoners"</span>, <span class="hljs-keyword">this</span>.populateAddPrisonerName, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">this</span>.subscribe(<span class="hljs-string">"onLoadShips"</span>, <span class="hljs-keyword">this</span>.populateAddShipName, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            Event.delegate(<span class="hljs-string">"tradeAddResourceName"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.AddResource, <span class="hljs-string">"button"</span>, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            Event.delegate(<span class="hljs-string">"tradeAddGlyphName"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.AddGlyph, <span class="hljs-string">"button"</span>, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            Event.delegate(<span class="hljs-string">"tradeAddPlanName"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.AddPlan, <span class="hljs-string">"button"</span>, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            Event.delegate(<span class="hljs-string">"tradeAddShipName"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.AddShip, <span class="hljs-string">"button"</span>, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            Event.delegate(<span class="hljs-string">"tradeAddPrisonerName"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.AddPrisoner, <span class="hljs-string">"button"</span>, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            Event.delegate(<span class="hljs-string">"tradeAddItems"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.AddRemove, <span class="hljs-string">"button"</span>, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            Event.on(<span class="hljs-string">"tradeAdd"</span>, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.AddTrade, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.add;
        },
        populateOneForOneHave: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> elm = Dom.get(<span class="hljs-string">"transporterOneForOneHave"</span>),
                opt = document.createElement(<span class="hljs-string">"option"</span>),
                nOpt, optGroup;
            <span class="hljs-keyword">if</span> (elm) {
                elm.innerHTML = <span class="hljs-string">''</span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> r <span class="hljs-keyword">in</span> Lib.ResourceTypes) {
                    <span class="hljs-keyword">if</span> (Lib.ResourceTypes.hasOwnProperty(r)) {
                        <span class="hljs-keyword">var</span> resource = Lib.ResourceTypes[r];
                        <span class="hljs-keyword">if</span> (Lang.isArray(resource)) {
                            optGroup = document.createElement(<span class="hljs-string">"optgroup"</span>);
                            optGroup.label = r.titleCaps();
                            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>; x &lt; resource.length; x++) {
                                <span class="hljs-keyword">var</span> name = resource[x];
                                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.resources[name]) {
                                    nOpt = opt.cloneNode(<span class="hljs-literal">false</span>);
                                    nOpt.value = name;
                                    nOpt.innerHTML = [name.titleCaps(), <span class="hljs-string">' ('</span>, <span class="hljs-keyword">this</span>.resources[name], <span class="hljs-string">')'</span>].join(<span class="hljs-string">''</span>);
                                    optGroup.appendChild(nOpt);
                                }
                            }
                            elm.appendChild(optGroup);
                        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.resources[r] &amp;&amp; resource) {
                            nOpt = opt.cloneNode(<span class="hljs-literal">false</span>);
                            nOpt.value = r;
                            nOpt.innerHTML = [r.titleCaps(), <span class="hljs-string">' ('</span>, <span class="hljs-keyword">this</span>.resources[r], <span class="hljs-string">')'</span>].join(<span class="hljs-string">''</span>);
                            elm.appendChild(nOpt);
                        }
                    }
                }
            }
        },
        Trade: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> data = {
                session_id: Game.GetSession(<span class="hljs-string">""</span>),
                building_id: <span class="hljs-keyword">this</span>.building.id,
                have: Lib.getSelectedOptionValue(Dom.get(<span class="hljs-string">"transporterOneForOneHave"</span>)),
                want: Lib.getSelectedOptionValue(Dom.get(<span class="hljs-string">"transporterOneForOneWant"</span>)),
                quantity: Dom.get(<span class="hljs-string">"transporterOneForOneQuantity"</span>)
                    .value * <span class="hljs-number">1</span>
            };
            <span class="hljs-keyword">if</span> (data.quantity &gt; <span class="hljs-keyword">this</span>.transport.max) {
                Dom.get(<span class="hljs-string">"transporterOneForOneMessage"</span>)
                    .innerHTML = [<span class="hljs-string">"Quantity must be less than "</span>, <span class="hljs-keyword">this</span>.transport.max, <span class="hljs-string">", which is the maximum for this level transporter."</span>].join(<span class="hljs-string">''</span>);
                Lib.fadeOutElm(<span class="hljs-string">"transporterOneForOneMessage"</span>);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (data.quantity &lt; <span class="hljs-number">0</span> || data.quantity &gt; <span class="hljs-keyword">this</span>.resources[data.have] * <span class="hljs-number">1</span>) {
                Dom.get(<span class="hljs-string">"transporterOneForOneMessage"</span>)
                    .innerHTML = <span class="hljs-string">"Quantity must be greater than 0 and less than or equal to the resources you have on hand."</span>;
                Lib.fadeOutElm(<span class="hljs-string">"transporterOneForOneMessage"</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">this</span>.service.trade_one_for_one(data, {
                    success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                        YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"Transporter.Trade.success"</span>);
                        <span class="hljs-keyword">this</span>.rpcSuccess(o);
                        Dom.get(<span class="hljs-string">"transporterOneForOneHave"</span>)
                            .selectedIndex = -<span class="hljs-number">1</span>;
                        Dom.get(<span class="hljs-string">"transporterOneForOneWant"</span>)
                            .selectedIndex = -<span class="hljs-number">1</span>;
                        Dom.get(<span class="hljs-string">"transporterOneForOneQuantity"</span>)
                            .value = <span class="hljs-string">""</span>;
                        <span class="hljs-keyword">this</span>.getStoredResources(<span class="hljs-literal">true</span>);
                        Lacuna.Pulser.Hide();
                    },
                    scope: <span class="hljs-keyword">this</span>
                });
            }
        },
        getGlyphs: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(force)</span> {</span>
            <span class="hljs-keyword">if</span> (force || !<span class="hljs-keyword">this</span>.glyphs) {
                Lacuna.Pulser.Show();
                <span class="hljs-keyword">this</span>.service.get_glyph_summary({
                    session_id: Game.GetSession(<span class="hljs-string">""</span>),
                    building_id: <span class="hljs-keyword">this</span>.building.id
                }, {
                    success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                        <span class="hljs-keyword">this</span>.rpcSuccess(o);
                        <span class="hljs-keyword">this</span>.glyphs = o.result.glyphs;
                        <span class="hljs-keyword">this</span>.glyphSize = o.result.cargo_space_used_each;
                        <span class="hljs-keyword">this</span>.fireEvent(<span class="hljs-string">"onLoadGlyphs"</span>);
                        Lacuna.Pulser.Hide();
                    },
                    scope: <span class="hljs-keyword">this</span>
                });
            }
        },
        getPlans: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(force)</span> {</span>
            <span class="hljs-keyword">if</span> (force || !<span class="hljs-keyword">this</span>.plans) {
                Lacuna.Pulser.Show();
                <span class="hljs-keyword">this</span>.service.get_plan_summary({
                    session_id: Game.GetSession(<span class="hljs-string">""</span>),
                    building_id: <span class="hljs-keyword">this</span>.building.id
                }, {
                    success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                        <span class="hljs-keyword">this</span>.rpcSuccess(o);
                        <span class="hljs-keyword">this</span>.plans = o.result.plans;
                        <span class="hljs-keyword">this</span>.planSize = o.result.cargo_space_used_each;
                        <span class="hljs-keyword">this</span>.fireEvent(<span class="hljs-string">"onLoadPlans"</span>);
                        Lacuna.Pulser.Hide();
                    },
                    scope: <span class="hljs-keyword">this</span>
                });
            }
        },
        getPrisoners: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(force)</span> {</span>
            <span class="hljs-keyword">if</span> (force || !<span class="hljs-keyword">this</span>.prisoners) {
                Lacuna.Pulser.Show();
                <span class="hljs-keyword">this</span>.service.get_prisoners({
                    session_id: Game.GetSession(<span class="hljs-string">""</span>),
                    building_id: <span class="hljs-keyword">this</span>.building.id
                }, {
                    success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                        <span class="hljs-keyword">this</span>.rpcSuccess(o);
                        <span class="hljs-keyword">this</span>.prisoners = o.result.prisoners;
                        <span class="hljs-keyword">this</span>.spySize = o.result.cargo_space_used_each;
                        <span class="hljs-keyword">this</span>.fireEvent(<span class="hljs-string">"onLoadPrisoners"</span>);
                        Lacuna.Pulser.Hide();
                    },
                    scope: <span class="hljs-keyword">this</span>
                });
            }
        },
        getShips: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(force)</span> {</span>
            <span class="hljs-keyword">if</span> (force || !<span class="hljs-keyword">this</span>.ships) {
                Lacuna.Pulser.Show();
                <span class="hljs-keyword">this</span>.service.get_ship_summary({
                    session_id: Game.GetSession(<span class="hljs-string">""</span>),
                    building_id: <span class="hljs-keyword">this</span>.building.id
                }, {
                    success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                        <span class="hljs-keyword">this</span>.rpcSuccess(o);
                        <span class="hljs-keyword">this</span>.ships = o.result.ships;
                        <span class="hljs-keyword">this</span>.shipSize = o.result.cargo_space_used_each;
                        <span class="hljs-keyword">this</span>.fireEvent(<span class="hljs-string">"onLoadShips"</span>);
                        Lacuna.Pulser.Hide();
                    },
                    scope: <span class="hljs-keyword">this</span>
                });
            }
        },
        getStoredResources: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(force)</span> {</span>
            <span class="hljs-keyword">if</span> (force || !<span class="hljs-keyword">this</span>.resources) {
                Lacuna.Pulser.Show();
                <span class="hljs-keyword">this</span>.service.get_stored_resources({
                    session_id: Game.GetSession(<span class="hljs-string">""</span>),
                    building_id: <span class="hljs-keyword">this</span>.building.id
                }, {
                    success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                        <span class="hljs-keyword">this</span>.rpcSuccess(o);
                        <span class="hljs-keyword">this</span>.resources = o.result.resources;
                        <span class="hljs-keyword">this</span>.fireEvent(<span class="hljs-string">"onLoadResources"</span>);
                        Lacuna.Pulser.Hide();
                    },
                    scope: <span class="hljs-keyword">this</span>
                });
            }
        },
        getAvailable: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
            <span class="hljs-keyword">if</span> (e.newValue) {
                Lacuna.Pulser.Show();
                <span class="hljs-keyword">var</span> data = {
                    session_id: Game.GetSession(),
                    building_id: <span class="hljs-keyword">this</span>.building.id,
                    page_number: <span class="hljs-number">1</span>
                },
                    selVal = Lib.getSelectedOptionValue(<span class="hljs-string">"tradeFilter"</span>);
                <span class="hljs-keyword">if</span> (selVal) {
                    data.filter = selVal;
                }
                <span class="hljs-keyword">this</span>.service.view_market(data, {
                    success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                        YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"Trade.view_available_trades.success"</span>);
                        Lacuna.Pulser.Hide();
                        <span class="hljs-keyword">this</span>.rpcSuccess(o);
                        <span class="hljs-keyword">delete</span> o.result.status; <span class="hljs-comment">//get rid of status after we process it, since it's big</span>
                        <span class="hljs-keyword">this</span>.availableTrades = o.result; <span class="hljs-comment">//store: trades=[], trade_count = 1, page_number=1,  captcha = {guid, url}</span>
                        <span class="hljs-keyword">this</span>.availablePager = <span class="hljs-keyword">new</span> Pager({
                            rowsPerPage: <span class="hljs-number">25</span>,
                            totalRecords: o.result.trade_count,
                            containers: <span class="hljs-string">'tradeAvailablePaginator'</span>,
                            template: <span class="hljs-string">"{PreviousPageLink} {PageLinks} {NextPageLink}"</span>,
                            alwaysVisible: <span class="hljs-literal">false</span>
                        });
                        <span class="hljs-keyword">this</span>.availablePager.subscribe(<span class="hljs-string">'changeRequest'</span>, <span class="hljs-keyword">this</span>.AvailableHandlePagination, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                        <span class="hljs-keyword">this</span>.availablePager.render();
                        <span class="hljs-keyword">this</span>.AvailablePopulate();
                    },
                    scope: <span class="hljs-keyword">this</span>
                });
            }
        },
        AvailablePopulate: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> details = Dom.get(<span class="hljs-string">"tradeAvailableDetails"</span>);
            <span class="hljs-keyword">if</span> (details) {
                <span class="hljs-keyword">var</span> trades = <span class="hljs-keyword">this</span>.availableTrades.trades,
                    ul = document.createElement(<span class="hljs-string">"ul"</span>),
                    li = document.createElement(<span class="hljs-string">"li"</span>);
                Event.purgeElement(details);
                details.innerHTML = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; trades.length; i++) {
                    <span class="hljs-keyword">var</span> trade = trades[i],
                        bbtn, nUl = ul.cloneNode(<span class="hljs-literal">false</span>),
                        nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    nUl.Trade = trade;
                    Dom.addClass(nUl, <span class="hljs-string">"tradeInfo"</span>);
                    Dom.addClass(nUl, <span class="hljs-string">"clearafter"</span>);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"tradeEmpire"</span>);
                    nLi.innerHTML = trade.empire.name;
                    Event.on(nLi, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.EmpireProfile, trade.empire);
                    nUl.appendChild(nLi);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"tradeOfferedDate"</span>);
                    nLi.innerHTML = Lib.formatServerDateTimeShort(trade.date_offered);
                    nUl.appendChild(nLi);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"tradeAsking"</span>);
                    nLi.innerHTML = [trade.ask, <span class="hljs-string">'&lt;img src="'</span>, Lib.AssetUrl, <span class="hljs-string">'ui/s/essentia.png" class="smallEssentia" /&gt;'</span>].join(<span class="hljs-string">''</span>);
                    nUl.appendChild(nLi);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"tradeOffer"</span>);
                    nLi.innerHTML = Lib.formatInlineList(trade.offer);
                    nUl.appendChild(nLi);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"tradeAction"</span>);
                    bbtn = document.createElement(<span class="hljs-string">"button"</span>);
                    bbtn.setAttribute(<span class="hljs-string">"type"</span>, <span class="hljs-string">"button"</span>);
                    bbtn.innerHTML = <span class="hljs-keyword">this</span>.availableAcceptText;
                    bbtn = nLi.appendChild(bbtn);
                    Event.on(bbtn, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.AvailableAccept, {
                        Self: <span class="hljs-keyword">this</span>,
                        Trade: trade,
                        Line: nUl
                    }, <span class="hljs-literal">true</span>);
                    nUl.appendChild(nLi);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"tradeAction"</span>);
                    bbtn = document.createElement(<span class="hljs-string">"button"</span>);
                    bbtn.setAttribute(<span class="hljs-string">"type"</span>, <span class="hljs-string">"button"</span>);
                    Dom.addClass(bbtn, <span class="hljs-string">"reportAbuse"</span>);
                    bbtn.innerHTML = <span class="hljs-string">"Spam"</span>;
                    bbtn = nLi.appendChild(bbtn);
                    Event.on(bbtn, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.AvailableReport, {
                        Self: <span class="hljs-keyword">this</span>,
                        Trade: trade,
                        Line: nUl
                    }, <span class="hljs-literal">true</span>);
                    nUl.appendChild(nLi);
                    details.appendChild(nUl);
                }
                <span class="hljs-comment">//wait for tab to display first</span>
                setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">var</span> Ht = Game.GetSize()
                        .h - <span class="hljs-number">240</span>;
                    <span class="hljs-keyword">if</span> (Ht &gt; <span class="hljs-number">300</span>) {
                        Ht = <span class="hljs-number">300</span>;
                    }
                    <span class="hljs-keyword">var</span> tC = details.parentNode;
                    Dom.setStyle(tC, <span class="hljs-string">"height"</span>, Ht + <span class="hljs-string">"px"</span>);
                    Dom.setStyle(tC, <span class="hljs-string">"overflow-y"</span>, <span class="hljs-string">"auto"</span>);
                }, <span class="hljs-number">10</span>);
            }
        },
        AvailableHandlePagination: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newState)</span> {</span>
            Lacuna.Pulser.Show();
            <span class="hljs-keyword">var</span> data = {
                session_id: Game.GetSession(),
                building_id: <span class="hljs-keyword">this</span>.building.id,
                page_number: newState.page
            },
                selVal = Lib.getSelectedOptionValue(<span class="hljs-string">"tradeFilter"</span>);
            <span class="hljs-keyword">if</span> (selVal) {
                data.filter = selVal;
            }
            <span class="hljs-keyword">this</span>.service.view_market(data, {
                success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                    YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"Trade.view_available_trades.success"</span>);
                    Lacuna.Pulser.Hide();
                    <span class="hljs-keyword">this</span>.rpcSuccess(o);
                    <span class="hljs-keyword">delete</span> o.result.status; <span class="hljs-comment">//get rid of status after we process it, since it's big</span>
                    <span class="hljs-keyword">this</span>.availableTrades = o.result; <span class="hljs-comment">//store: trades=[], trade_count = 1, page_number=1,  captcha = {guid, url}</span>
                    <span class="hljs-keyword">this</span>.AvailablePopulate();
                },
                scope: <span class="hljs-keyword">this</span>
            });</pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Update the Paginator&#39;s state</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">            <span class="hljs-keyword">this</span>.availablePager.setState(newState);
        },
        AvailableAccept: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            Lacuna.Pulser.Show();
            <span class="hljs-keyword">this</span>.Self.service.accept_from_market({
                session_id: Game.GetSession(<span class="hljs-string">""</span>),
                building_id: <span class="hljs-keyword">this</span>.Self.building.id,
                trade_id: <span class="hljs-keyword">this</span>.Trade.id
            }, {
                success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                    YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"Trade.accept_trade.success"</span>);
                    <span class="hljs-keyword">this</span>.Self.rpcSuccess(o);
                    <span class="hljs-comment">//force get the new availabe list after accepting so we get a new captcha</span>
                    <span class="hljs-keyword">this</span>.Self.getAvailable({
                        newValue: <span class="hljs-literal">true</span>
                    });
                    Lacuna.Pulser.Hide();
                },
                scope: <span class="hljs-keyword">this</span>
            });
        },
        AvailableReport: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            Lacuna.Pulser.Show();
            <span class="hljs-keyword">this</span>.Self.service.report_abuse({
                session_id: Game.GetSession(<span class="hljs-string">""</span>),
                building_id: <span class="hljs-keyword">this</span>.Self.building.id,
                trade_id: <span class="hljs-keyword">this</span>.Trade.id
            }, {
                success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                    <span class="hljs-keyword">var</span> btn = Sel.query(<span class="hljs-string">".reportAbuse"</span>, <span class="hljs-keyword">this</span>.Line, <span class="hljs-literal">true</span>);
                    <span class="hljs-keyword">if</span> (btn) {
                        Event.purgeElement(btn);
                        btn.parentNode.removeChild(btn);
                    }
                    <span class="hljs-keyword">this</span>.Self.rpcSuccess(o);
                    Lacuna.Pulser.Hide();
                },
                scope: <span class="hljs-keyword">this</span>
            });
        },
        EmpireProfile: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e, empire)</span> {</span>
            Lacuna.Info.Empire.Load(empire.id);
        },
        <span class="hljs-comment">//View Mine</span>
        getMine: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
            <span class="hljs-keyword">if</span> (e.newValue) {
                Lacuna.Pulser.Show();
                <span class="hljs-keyword">this</span>.service.view_my_market({
                    session_id: Game.GetSession(),
                    building_id: <span class="hljs-keyword">this</span>.building.id,
                    page_number: <span class="hljs-number">1</span>
                }, {
                    success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                        YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"Trade.view_my_trades.success"</span>);
                        Lacuna.Pulser.Hide();
                        <span class="hljs-keyword">this</span>.rpcSuccess(o);
                        <span class="hljs-keyword">delete</span> o.result.status; <span class="hljs-comment">//get rid of status after we process it, since it's big</span>
                        <span class="hljs-keyword">this</span>.mineTrades = o.result; <span class="hljs-comment">//store: trades=[], trade_count = 1, page_number=1</span>
                        <span class="hljs-keyword">this</span>.minePage = <span class="hljs-keyword">new</span> Pager({
                            rowsPerPage: <span class="hljs-number">25</span>,
                            totalRecords: o.result.trade_count,
                            containers: <span class="hljs-string">'tradeMinePaginator'</span>,
                            template: <span class="hljs-string">"{PreviousPageLink} {PageLinks} {NextPageLink}"</span>,
                            alwaysVisible: <span class="hljs-literal">false</span>
                        });
                        <span class="hljs-keyword">this</span>.minePage.subscribe(<span class="hljs-string">'changeRequest'</span>, <span class="hljs-keyword">this</span>.MineHandlePagination, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                        <span class="hljs-keyword">this</span>.minePage.render();
                        <span class="hljs-keyword">this</span>.MinePopulate();
                    },
                    scope: <span class="hljs-keyword">this</span>
                });
            }
        },
        MinePopulate: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> details = Dom.get(<span class="hljs-string">"tradeMineDetails"</span>);
            <span class="hljs-keyword">if</span> (details) {
                <span class="hljs-keyword">var</span> trades = <span class="hljs-keyword">this</span>.mineTrades.trades,
                    ul = document.createElement(<span class="hljs-string">"ul"</span>),
                    li = document.createElement(<span class="hljs-string">"li"</span>);
                Event.purgeElement(details);
                details.innerHTML = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; trades.length; i++) {
                    <span class="hljs-keyword">var</span> trade = trades[i],
                        nUl = ul.cloneNode(<span class="hljs-literal">false</span>),
                        nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    nUl.Trade = trade;
                    Dom.addClass(nUl, <span class="hljs-string">"tradeInfo"</span>);
                    Dom.addClass(nUl, <span class="hljs-string">"clearafter"</span>);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"tradeOfferedDate"</span>);
                    nLi.innerHTML = Lib.formatServerDateTimeShort(trade.date_offered);
                    nUl.appendChild(nLi);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"tradeAsking"</span>);
                    nLi.innerHTML = [trade.ask, <span class="hljs-string">'&lt;img src="'</span>, Lib.AssetUrl, <span class="hljs-string">'ui/s/essentia.png" class="smallEssentia" /&gt;'</span>].join(<span class="hljs-string">''</span>);
                    nUl.appendChild(nLi);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"tradeOffer"</span>);
                    nLi.innerHTML = Lib.formatInlineList(trade.offer);
                    nUl.appendChild(nLi);
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    Dom.addClass(nLi, <span class="hljs-string">"tradeAction"</span>);
                    <span class="hljs-keyword">var</span> bbtn = document.createElement(<span class="hljs-string">"button"</span>);
                    bbtn.setAttribute(<span class="hljs-string">"type"</span>, <span class="hljs-string">"button"</span>);
                    bbtn.innerHTML = <span class="hljs-string">"Withdraw"</span>;
                    bbtn = nLi.appendChild(bbtn);
                    Event.on(bbtn, <span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>.MineWithdraw, {
                        Self: <span class="hljs-keyword">this</span>,
                        Trade: trade,
                        Line: nUl
                    }, <span class="hljs-literal">true</span>);
                    nUl.appendChild(nLi);
                    details.appendChild(nUl);
                }
                <span class="hljs-comment">//wait for tab to display first</span>
                setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">var</span> Ht = Game.GetSize()
                        .h - <span class="hljs-number">185</span>;
                    <span class="hljs-keyword">if</span> (Ht &gt; <span class="hljs-number">300</span>) {
                        Ht = <span class="hljs-number">300</span>;
                    }
                    <span class="hljs-keyword">var</span> tC = details.parentNode;
                    Dom.setStyle(tC, <span class="hljs-string">"height"</span>, Ht + <span class="hljs-string">"px"</span>);
                    Dom.setStyle(tC, <span class="hljs-string">"overflow-y"</span>, <span class="hljs-string">"auto"</span>);
                }, <span class="hljs-number">10</span>);
            }
        },
        MineHandlePagination: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newState)</span> {</span>
            Lacuna.Pulser.Show();
            <span class="hljs-keyword">this</span>.service.view_my_market({
                session_id: Game.GetSession(),
                building_id: <span class="hljs-keyword">this</span>.building.id,
                page_number: newState.page
            }, {
                success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                    YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"Trade.view_available_trades.success"</span>);
                    Lacuna.Pulser.Hide();
                    <span class="hljs-keyword">this</span>.rpcSuccess(o);
                    <span class="hljs-keyword">delete</span> o.result.status; <span class="hljs-comment">//get rid of status after we process it, since it's big</span>
                    <span class="hljs-keyword">this</span>.mineTrades = o.result; <span class="hljs-comment">//store: trades=[], trade_count = 1, page_number=1</span>
                    <span class="hljs-keyword">this</span>.MinePopulate();
                },
                scope: <span class="hljs-keyword">this</span>
            });</pre></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Update the Paginator&#39;s state</p>
</div>
        </div>
      
      
        <div class="code"><pre class="wrapper">            <span class="hljs-keyword">this</span>.minePage.setState(newState);
        },
        MineWithdraw: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">if</span> (confirm([<span class="hljs-string">'Are you sure you want to withdraw the trade asking for '</span>, <span class="hljs-keyword">this</span>.Trade.ask, <span class="hljs-string">' essentia and offering '</span>, <span class="hljs-keyword">this</span>.Trade.offer.join(<span class="hljs-string">', '</span>), <span class="hljs-string">'?'</span>].join(<span class="hljs-string">''</span>))) {
                Lacuna.Pulser.Show();
                <span class="hljs-keyword">this</span>.Self.service.withdraw_from_market({
                    session_id: Game.GetSession(<span class="hljs-string">""</span>),
                    building_id: <span class="hljs-keyword">this</span>.Self.building.id,
                    trade_id: <span class="hljs-keyword">this</span>.Trade.id
                }, {
                    success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                        YAHOO.log(o, <span class="hljs-string">"info"</span>, <span class="hljs-string">"Trade.withdraw_trade.success"</span>);
                        <span class="hljs-keyword">this</span>.Self.rpcSuccess(o);
                        <span class="hljs-keyword">var</span> trades = <span class="hljs-keyword">this</span>.Self.mineTrades.trades;
                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; trades.length; i++) {
                            <span class="hljs-keyword">if</span> (trades[i].id === <span class="hljs-keyword">this</span>.Trade.id) {
                                trades.splice(i, <span class="hljs-number">1</span>);
                                <span class="hljs-keyword">break</span>;
                            }
                        }
                        <span class="hljs-keyword">this</span>.Line.parentNode.removeChild(<span class="hljs-keyword">this</span>.Line);
                        Lacuna.Pulser.Hide();
                        <span class="hljs-keyword">this</span>.Self.getStoredResources(<span class="hljs-literal">true</span>);
                        <span class="hljs-keyword">this</span>.Self.getPlans(<span class="hljs-literal">true</span>);
                        <span class="hljs-keyword">this</span>.Self.getGlyphs(<span class="hljs-literal">true</span>);
                        <span class="hljs-keyword">this</span>.Self.getPrisoners(<span class="hljs-literal">true</span>);
                        <span class="hljs-keyword">this</span>.Self.getShips(<span class="hljs-literal">true</span>);
                    },
                    scope: <span class="hljs-keyword">this</span>
                });
            }
        },
        <span class="hljs-comment">//Add trade</span>
        populateAddResourceName: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> elm = Dom.get(<span class="hljs-string">"tradeAddResourceName"</span>),
                li = document.createElement(<span class="hljs-string">"li"</span>),
                nLi, x, r, name, resource;
            <span class="hljs-keyword">if</span> (elm) {
                elm.innerHTML = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">for</span> (r <span class="hljs-keyword">in</span> Lib.ResourceTypes) {
                    <span class="hljs-keyword">if</span> (Lib.ResourceTypes.hasOwnProperty(r)) {
                        resource = Lib.ResourceTypes[r];
                        <span class="hljs-keyword">if</span> (Lang.isArray(resource)) {
                            <span class="hljs-keyword">for</span> (x = <span class="hljs-number">0</span>; x &lt; resource.length; x++) {
                                name = resource[x];
                                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.resources[name]) {
                                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                                    nLi.Resource = {
                                        type: name,
                                        quantity: <span class="hljs-keyword">this</span>.resources[name] * <span class="hljs-number">1</span>
                                    };
                                    nLi.innerHTML = [<span class="hljs-string">'&lt;span class="tradeResourceName"&gt;'</span>, name.titleCaps(), <span class="hljs-string">' (&lt;label class="quantity"&gt;'</span>, <span class="hljs-keyword">this</span>.resources[name], <span class="hljs-string">'&lt;/label&gt;)&lt;/span&gt; &lt;input type="text" style="width:75px;" /&gt;&lt;button type="button"&gt;+&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>);
                                    elm.appendChild(nLi);
                                }
                            }
                        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.resources[r] &amp;&amp; resource) {
                            nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                            nLi.Resource = {
                                type: r,
                                quantity: <span class="hljs-keyword">this</span>.resources[r] * <span class="hljs-number">1</span>
                            };
                            nLi.innerHTML = [<span class="hljs-string">'&lt;span class="tradeResourceName"&gt;'</span>, r.titleCaps(), <span class="hljs-string">' (&lt;label class="quantity"&gt;'</span>, <span class="hljs-keyword">this</span>.resources[r], <span class="hljs-string">'&lt;/label&gt;)&lt;/span&gt; &lt;input type="text" style="width:75px;" /&gt;&lt;button type="button"&gt;+&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>);
                            elm.appendChild(nLi);
                        }
                    }
                }
            }
            <span class="hljs-comment">//wait for tab to display first</span>
            setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">var</span> Ht = Game.GetSize()
                    .h - <span class="hljs-number">180</span>;
                <span class="hljs-keyword">if</span> (Ht &gt; <span class="hljs-number">300</span>) {
                    Ht = <span class="hljs-number">300</span>;
                }
                <span class="hljs-keyword">var</span> aHt = Dom.get(<span class="hljs-string">'aHt'</span>);
                Dom.setStyle(aHt, <span class="hljs-string">"height"</span>, Ht + <span class="hljs-string">"px"</span>);
                Dom.setStyle(aHt, <span class="hljs-string">"overflow-y"</span>, <span class="hljs-string">"auto"</span>);
            }, <span class="hljs-number">10</span>);
        },
        populateAddGlyphName: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> elm = Dom.get(<span class="hljs-string">"tradeAddGlyphName"</span>),
                li = document.createElement(<span class="hljs-string">"li"</span>),
                nLi;
            <span class="hljs-keyword">if</span> (elm) {
                elm.innerHTML = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.glyphs.length &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>; x &lt; <span class="hljs-keyword">this</span>.glyphs.length; x++) {
                        <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">this</span>.glyphs[x];
                        nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                        nLi.Glyph = obj;
                        nLi.innerHTML = [<span class="hljs-string">'&lt;span class="tradeResourceName"&gt;'</span>, obj.name.titleCaps(), <span class="hljs-string">' (&lt;label class="quantity"&gt;'</span>, obj.quantity, <span class="hljs-string">'&lt;/label&gt;)&lt;/span&gt; &lt;input type="text" style="width:75px;" /&gt;&lt;button type="button"&gt;+&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>);
                        elm.appendChild(nLi);
                    }
                } <span class="hljs-keyword">else</span> {
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    nLi.innerHTML = <span class="hljs-string">"No Glyphs Available"</span>;
                    elm.appendChild(nLi);
                }
            }
        },
        populateAddPlanName: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> elm = Dom.get(<span class="hljs-string">"tradeAddPlanName"</span>),
                li = document.createElement(<span class="hljs-string">"li"</span>),
                nLi;
            <span class="hljs-keyword">if</span> (elm) {
                elm.innerHTML = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.plans.length &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>; x &lt; <span class="hljs-keyword">this</span>.plans.length; x++) {
                        <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">this</span>.plans[x];
                        nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                        nLi.Plan = obj;
                        <span class="hljs-keyword">if</span> (obj.extra_build_level &gt; <span class="hljs-number">0</span>) {
                            nLi.innerHTML = [<span class="hljs-string">'&lt;span class="tradeResourceName"&gt;'</span>, obj.name, <span class="hljs-string">' '</span>, obj.level, <span class="hljs-string">'+'</span>, obj.extra_build_level, <span class="hljs-string">' (&lt;label class="quantity"&gt;'</span>, obj.quantity, <span class="hljs-string">'&lt;/label&gt;)&lt;/span&gt; &lt;input type="text" style="width:75px;" /&gt;&lt;button type="button"&gt;+&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>);
                        } <span class="hljs-keyword">else</span> {
                            nLi.innerHTML = [<span class="hljs-string">'&lt;span class="tradeResourceName"&gt;'</span>, obj.name, <span class="hljs-string">' '</span>, obj.level, <span class="hljs-string">' (&lt;label class="quantity"&gt;'</span>, obj.quantity, <span class="hljs-string">'&lt;/label&gt;)&lt;/span&gt; &lt;input type="text" style="width:75px;" /&gt;&lt;button type="button"&gt;+&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>);
                        }
                        elm.appendChild(nLi);
                    }
                } <span class="hljs-keyword">else</span> {
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    nLi.innerHTML = <span class="hljs-string">"No Plans Available"</span>;
                    elm.appendChild(nLi);
                }
            }
        },
        populateAddShipName: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> elm = Dom.get(<span class="hljs-string">"tradeAddShipName"</span>),
                li = document.createElement(<span class="hljs-string">"li"</span>),
                nLi;
            <span class="hljs-keyword">if</span> (elm) {
                elm.innerHTML = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.ships.length &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>; x &lt; <span class="hljs-keyword">this</span>.ships.length; x++) {
                        <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">this</span>.ships[x];
                        nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                        nLi.Ship = obj;
                        nLi.innerHTML = [<span class="hljs-string">'&lt;span class="tradeResourceName"&gt;'</span>,
                            obj.name, <span class="hljs-string">' - '</span>,
                            obj.type.titleCaps(<span class="hljs-string">'_'</span>, <span class="hljs-string">' '</span>), <span class="hljs-string">' - Hold:'</span>, obj.hold_size, <span class="hljs-string">' - Berth:'</span>, obj.berth_level, <span class="hljs-string">' - Speed:'</span>, obj.speed, <span class="hljs-string">' (&lt;label class="quantity"&gt;'</span>,
                            obj.quantity, <span class="hljs-string">'&lt;/label&gt;)&lt;/span&gt; &lt;input type="text" style="width:75px;" /&gt;&lt;button type="button"&gt;+&lt;/button&gt;'</span>
                        ].join(<span class="hljs-string">''</span>);
                        elm.appendChild(nLi);
                    }
                } <span class="hljs-keyword">else</span> {
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    nLi.innerHTML = <span class="hljs-string">"No Ships Available"</span>;
                    elm.appendChild(nLi);
                }
            }
        },
        populateAddPrisonerName: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> elm = Dom.get(<span class="hljs-string">"tradeAddPrisonerName"</span>),
                li = document.createElement(<span class="hljs-string">"li"</span>),
                nLi;
            <span class="hljs-keyword">if</span> (elm) {
                elm.innerHTML = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.prisoners.length &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>; x &lt; <span class="hljs-keyword">this</span>.prisoners.length; x++) {
                        <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">this</span>.prisoners[x];
                        nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                        nLi.Prisoner = obj;
                        nLi.innerHTML = [<span class="hljs-string">'&lt;span class="tradeName"&gt;'</span>, obj.name, <span class="hljs-string">' '</span>, obj.level, <span class="hljs-string">'&lt;/span&gt; &lt;button type="button"&gt;+&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>);
                        elm.appendChild(nLi);
                    }
                } <span class="hljs-keyword">else</span> {
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    nLi.innerHTML = <span class="hljs-string">"No Prisoners Available"</span>;
                    elm.appendChild(nLi);
                }
            }
        },
        updateAddCargo: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(byVal)</span> {</span>
            <span class="hljs-keyword">var</span> c = Dom.get(<span class="hljs-string">"tradeAddCargo"</span>),
                cv = c.innerHTML * <span class="hljs-number">1</span>;
            c.innerHTML = cv + byVal;
        },
        AddResource: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e, matchedEl, container)</span> {</span>
            <span class="hljs-keyword">var</span> quantity = matchedEl.previousSibling.value * <span class="hljs-number">1</span>,
                li = matchedEl.parentNode,
                c = Dom.get(<span class="hljs-string">"tradeAddItems"</span>);
            <span class="hljs-keyword">if</span> (quantity &amp;&amp; c) {
                <span class="hljs-keyword">var</span> id = <span class="hljs-string">"addResource-"</span> + li.Resource.type,
                    exists = Sel.query(<span class="hljs-string">"#"</span> + id, c);
                <span class="hljs-keyword">if</span> (exists.length === <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">var</span> item = document.createElement(<span class="hljs-string">"li"</span>),
                        del = item.appendChild(document.createElement(<span class="hljs-string">"div"</span>)),
                        content = item.appendChild(document.createElement(<span class="hljs-string">"div"</span>));
                    item.id = id;
                    <span class="hljs-keyword">if</span> (quantity &gt; li.Resource.quantity) {
                        quantity = li.Resource.quantity;
                    }
                    Dom.addClass(item, <span class="hljs-string">"tradeItem"</span>);
                    Dom.addClass(del, <span class="hljs-string">"tradeDelete"</span>);
                    Event.on(del, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
                        <span class="hljs-keyword">var</span> ed = Event.getTarget(e),
                            ep = ed.parentNode;
                        <span class="hljs-keyword">this</span>.updateAddCargo(ep.Object.quantity * -<span class="hljs-number">1</span>);
                        Event.purgeElement(ep);
                        ep.parentNode.removeChild(ep);
                    }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                    item.Object = {
                        type: li.Resource.type,
                        quantity: quantity,
                        size: <span class="hljs-number">1</span>
                    };
                    content.innerHTML = [<span class="hljs-string">'&lt;span class="tradeResourceName"&gt;'</span>, item.Object.type.titleCaps(), <span class="hljs-string">' (&lt;label class="quantity"&gt;'</span>, quantity, <span class="hljs-string">'&lt;/label&gt;)&lt;/span&gt; &lt;input type="text" style="width:75px;" value="'</span>, quantity, <span class="hljs-string">'" /&gt;&lt;button type="button"&gt;-&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>);
                    c.appendChild(item);
                    <span class="hljs-keyword">this</span>.updateAddCargo(quantity);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">var</span> found = exists[<span class="hljs-number">0</span>],
                        newTotal = found.Object.quantity + quantity,
                        diff = quantity,
                        lq = Sel.query(<span class="hljs-string">".quantity"</span>, found, <span class="hljs-literal">true</span>),
                        inp = Sel.query(<span class="hljs-string">"input"</span>, found, <span class="hljs-literal">true</span>);
                    <span class="hljs-keyword">if</span> (newTotal &gt; li.Resource.quantity) {
                        newTotal = li.Resource.quantity;
                        diff = newTotal - found.Object.quantity;
                    }
                    <span class="hljs-keyword">if</span> (inp) {
                        inp.value = diff;
                    }
                    lq.innerHTML = newTotal;
                    found.Object.quantity = newTotal;
                    <span class="hljs-keyword">this</span>.updateAddCargo(diff);
                    <span class="hljs-keyword">var</span> a = <span class="hljs-keyword">new</span> Util.ColorAnim(lq, {
                        color: {
                            from: <span class="hljs-string">'#0f0'</span>,
                            to: <span class="hljs-string">'#fff'</span>
                        }
                    }, <span class="hljs-number">1.5</span>);
                    a.animate();
                }
            }
        },
        AddGlyph: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e, matchedEl, container)</span> {</span>
            <span class="hljs-keyword">var</span> quantity = matchedEl.previousSibling.value * <span class="hljs-number">1</span>,
                li = matchedEl.parentNode,
                c = Dom.get(<span class="hljs-string">"tradeAddItems"</span>);
            <span class="hljs-keyword">if</span> (li &amp;&amp; c) {
                <span class="hljs-keyword">var</span> gName = li.Glyph.name,
                    id = <span class="hljs-string">"addGlyph-"</span> + gName,
                    exists = Sel.query(<span class="hljs-string">"#"</span> + id, c);
                <span class="hljs-keyword">if</span> (exists.length === <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">var</span> item = document.createElement(<span class="hljs-string">"li"</span>),
                        del = item.appendChild(document.createElement(<span class="hljs-string">"div"</span>)),
                        content = item.appendChild(document.createElement(<span class="hljs-string">"div"</span>));
                    item.id = id;
                    Dom.addClass(item, <span class="hljs-string">"tradeItem"</span>);
                    Dom.addClass(del, <span class="hljs-string">"tradeDelete"</span>);
                    Event.on(del, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
                        <span class="hljs-keyword">var</span> ed = Event.getTarget(e),
                            ep = ed.parentNode;
                        <span class="hljs-keyword">this</span>.updateAddCargo(ep.Object.quantity * -<span class="hljs-keyword">this</span>.glyphSize);
                        Event.purgeElement(item);
                        item.parentNode.removeChild(item);
                    }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                    item.Object = {
                        name: gName,
                        quantity: quantity,
                        type: <span class="hljs-string">"glyph"</span>,
                        size: <span class="hljs-keyword">this</span>.glyphSize
                    };
                    content.innerHTML = [<span class="hljs-string">'&lt;span class="tradeResourceName"&gt;'</span>, gName.titleCaps(), <span class="hljs-string">' (&lt;label class="quantity"&gt;'</span>, quantity, <span class="hljs-string">'&lt;/label&gt;)&lt;/span&gt; &lt;input type="text" style="width:75px;" value="'</span>, quantity, <span class="hljs-string">'" /&gt;&lt;button type="button"&gt;-&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>);
                    c.appendChild(item);
                    <span class="hljs-keyword">this</span>.updateAddCargo(<span class="hljs-keyword">this</span>.glyphSize * quantity);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">var</span> found = exists[<span class="hljs-number">0</span>],
                        newTotal = found.Object.quantity + quantity,
                        diff = quantity,
                        lq = Sel.query(<span class="hljs-string">".quantity"</span>, found, <span class="hljs-literal">true</span>),
                        inp = Sel.query(<span class="hljs-string">"input"</span>, found, <span class="hljs-literal">true</span>);
                    <span class="hljs-keyword">if</span> (newTotal &gt; li.Glyph.quantity) {
                        newTotal = li.Glyph.quantity;
                        diff = newTotal - found.Object.quantity;
                    }
                    <span class="hljs-keyword">if</span> (inp) {
                        inp.value = diff;
                    }
                    lq.innerHTML = newTotal;
                    found.Object.quantity = newTotal;
                    <span class="hljs-keyword">this</span>.updateAddCargo(<span class="hljs-keyword">this</span>.glyphSize * diff);
                }
            }
        },
        AddPlan: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e, matchedEl, container)</span> {</span>
            <span class="hljs-keyword">var</span> quantity = matchedEl.previousSibling.value * <span class="hljs-number">1</span>,
                li = matchedEl.parentNode,
                c = Dom.get(<span class="hljs-string">"tradeAddItems"</span>);
            <span class="hljs-keyword">if</span> (li &amp;&amp; c) {
                <span class="hljs-keyword">var</span> pName = li.Plan.name,
                    pType = li.Plan.plan_type,
                    pLevel = li.Plan.level,
                    pExtra = li.Plan.extra_build_level,
                    id = [<span class="hljs-string">'addPlan-'</span>, pType, <span class="hljs-string">'-'</span>, pLevel, <span class="hljs-string">'-'</span>, pExtra].join(<span class="hljs-string">''</span>)
                        .titleCaps(<span class="hljs-string">' '</span>, <span class="hljs-string">'_'</span>),
                    exists = Sel.query(<span class="hljs-string">"#"</span> + id, c);
                <span class="hljs-keyword">if</span> (exists.length === <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">var</span> item = document.createElement(<span class="hljs-string">"li"</span>),
                        del = item.appendChild(document.createElement(<span class="hljs-string">"div"</span>)),
                        content = item.appendChild(document.createElement(<span class="hljs-string">"div"</span>));
                    item.id = id;
                    Dom.addClass(item, <span class="hljs-string">"tradeItem"</span>);
                    Dom.addClass(del, <span class="hljs-string">"tradeDelete"</span>);
                    Event.on(del, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        <span class="hljs-keyword">var</span> ed = Event.getTarget(e),
                            ep = ed.parentNode;
                        <span class="hljs-keyword">this</span>.updateAddCargo(ep.Object.quantity * -<span class="hljs-keyword">this</span>.planSize);
                        Event.purgeElement(item);
                        item.parentNode.removeChild(item);
                    }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                    item.Object = {
                        plan_type: pType,
                        quantity: quantity,
                        type: <span class="hljs-string">"plan"</span>,
                        level: pLevel,
                        extra_build_level: pExtra,
                        size: <span class="hljs-keyword">this</span>.planSize
                    };
                    <span class="hljs-keyword">if</span> (pExtra &gt; <span class="hljs-number">0</span>) {
                        content.innerHTML = [<span class="hljs-string">'&lt;span class="tradeResourceName"&gt;'</span>, pName, <span class="hljs-string">' '</span>, pLevel, <span class="hljs-string">'+'</span>, pExtra, <span class="hljs-string">' (&lt;label class="quantity"&gt;'</span>, quantity, <span class="hljs-string">'&lt;/label&gt;)&lt;/span&gt; &lt;input type="text" style="width:75px;" value="'</span>, quantity, <span class="hljs-string">'" /&gt;&lt;button type="button"&gt;-&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>);
                    } <span class="hljs-keyword">else</span> {
                        content.innerHTML = [<span class="hljs-string">'&lt;span class="tradeResourceName"&gt;'</span>, pName, <span class="hljs-string">' '</span>, pLevel, <span class="hljs-string">' (&lt;label class="quantity"&gt;'</span>, quantity, <span class="hljs-string">'&lt;/label&gt;)&lt;/span&gt; &lt;input type="text" style="width:75px;" value="'</span>, quantity, <span class="hljs-string">'" /&gt;&lt;button type="button"&gt;-&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>);
                    }
                    c.appendChild(item);
                    <span class="hljs-keyword">this</span>.updateAddCargo(<span class="hljs-keyword">this</span>.planSize * quantity);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">var</span> found = exists[<span class="hljs-number">0</span>],
                        newTotal = found.Object.quantity + quantity,
                        diff = quantity,
                        lq = Sel.query(<span class="hljs-string">".quantity"</span>, found, <span class="hljs-literal">true</span>),
                        inp = Sel.query(<span class="hljs-string">"input"</span>, found, <span class="hljs-literal">true</span>);
                    <span class="hljs-keyword">if</span> (newTotal &gt; li.Plan.quantity) {
                        newTotal = li.Plan.quantity;
                        diff = newTotal - found.Object.quantity;
                    }
                    <span class="hljs-keyword">if</span> (inp) {
                        inp.value = diff;
                    }
                    lq.innerHTML = newTotal;
                    found.Object.quantity = newTotal;
                    <span class="hljs-keyword">this</span>.updateAddCargo(<span class="hljs-keyword">this</span>.planSize * diff);
                }
            }
        },
        AddShip: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e, matchedEl, container)</span> {</span>
            <span class="hljs-keyword">var</span> quantity = matchedEl.previousSibling.value * <span class="hljs-number">1</span>,
                li = matchedEl.parentNode,
                c = Dom.get(<span class="hljs-string">"tradeAddItems"</span>);
            <span class="hljs-keyword">if</span> (li &amp;&amp; c) {
                <span class="hljs-keyword">var</span> sName = li.Ship.name,
                    sType = li.Ship.type,
                    sSize = li.Ship.hold_size,
                    sBerth = li.Ship.berth_level,
                    sSpeed = li.Ship.speed,
                    id = [<span class="hljs-string">'addShip'</span>, sName, sType, sSize, sBerth, sSpeed].join(<span class="hljs-string">'-'</span>)
                        .titleCaps(<span class="hljs-string">' '</span>, <span class="hljs-string">'_'</span>),
                    exists = Sel.query(<span class="hljs-string">"#"</span> + id, c);
                <span class="hljs-keyword">if</span> (exists.length === <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">var</span> item = document.createElement(<span class="hljs-string">"li"</span>),
                        del = item.appendChild(document.createElement(<span class="hljs-string">"div"</span>)),
                        content = item.appendChild(document.createElement(<span class="hljs-string">"div"</span>));
                    item.id = id;
                    Dom.addClass(item, <span class="hljs-string">"tradeItem"</span>);
                    Dom.addClass(del, <span class="hljs-string">"tradeDelete"</span>);
                    Event.on(del, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        <span class="hljs-keyword">var</span> ed = Event.getTarget(e),
                            ep = ed.parentNode;
                        <span class="hljs-keyword">this</span>.updateAddCargo(ep.Object.quantity * -<span class="hljs-keyword">this</span>.shipSize);
                        Event.purgeElement(item);
                        item.parentNode.removeChild(item);
                    }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                    item.Object = {
                        quantity: quantity,
                        type: <span class="hljs-string">"ship"</span>,
                        name: sName,
                        ship_type: sType,
                        hold_size: sSize,
                        berth_level: sBerth,
                        speed: sSpeed,
                        size: <span class="hljs-keyword">this</span>.shipSize
                    };
                    content.innerHTML = [<span class="hljs-string">'&lt;span class="tradeResourceName"&gt;'</span>,
                        sName, <span class="hljs-string">' - '</span>,
                        sType.titleCaps(<span class="hljs-string">'_'</span>, <span class="hljs-string">' '</span>), <span class="hljs-string">' - Hold:'</span>, sSize, <span class="hljs-string">' - Berth:'</span>, sBerth, <span class="hljs-string">' - Speed:'</span>, sSpeed, <span class="hljs-string">' (&lt;label class="quantity"&gt;'</span>,
                        quantity, <span class="hljs-string">'&lt;/label&gt;)&lt;/span&gt; &lt;input type="text" style="width:75px;" value="'</span>,
                        quantity, <span class="hljs-string">'" /&gt;&lt;button type="button"&gt;-&lt;/button&gt;'</span>
                    ].join(<span class="hljs-string">''</span>);
                    c.appendChild(item);
                    <span class="hljs-keyword">this</span>.updateAddCargo(<span class="hljs-keyword">this</span>.shipSize * quantity);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">var</span> found = exists[<span class="hljs-number">0</span>],
                        newTotal = found.Object.quantity + quantity,
                        diff = quantity,
                        lq = Sel.query(<span class="hljs-string">".quantity"</span>, found, <span class="hljs-literal">true</span>),
                        inp = Sel.query(<span class="hljs-string">"input"</span>, found, <span class="hljs-literal">true</span>);
                    <span class="hljs-keyword">if</span> (newTotal &gt; li.Ship.quantity) {
                        newTotal = li.Ship.quantity;
                        diff = newTotal - found.Object.quantity;
                    }
                    <span class="hljs-keyword">if</span> (inp) {
                        inp.value = diff;
                    }
                    lq.innerHTML = newTotal;
                    found.Object.quantity = newTotal;
                    <span class="hljs-keyword">this</span>.updateAddCargo(<span class="hljs-keyword">this</span>.shipSize * diff);
                }
            }
        },
        AddPrisoner: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e, matchedEl, container)</span> {</span>
            <span class="hljs-keyword">var</span> li = matchedEl.parentNode,
                c = Dom.get(<span class="hljs-string">"tradeAddItems"</span>);
            <span class="hljs-keyword">if</span> (li &amp;&amp; c) {
                <span class="hljs-keyword">var</span> obj = li.Prisoner,
                    gId = obj.id,
                    id = <span class="hljs-string">"addPrisoner-"</span> + gId;
                <span class="hljs-keyword">if</span> (Sel.query(<span class="hljs-string">"#"</span> + id, c)
                    .length === <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">var</span> item = document.createElement(<span class="hljs-string">"li"</span>),
                        del = item.appendChild(document.createElement(<span class="hljs-string">"div"</span>)),
                        content = item.appendChild(document.createElement(<span class="hljs-string">"div"</span>));
                    item.id = id;
                    Dom.addClass(item, <span class="hljs-string">"tradeItem"</span>);
                    Dom.addClass(del, <span class="hljs-string">"tradeDelete"</span>);
                    Event.on(del, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        <span class="hljs-keyword">this</span>.updateAddCargo(<span class="hljs-keyword">this</span>.spySize * -<span class="hljs-number">1</span>);
                        Event.purgeElement(item);
                        item.parentNode.removeChild(item);
                    }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                    item.Object = {
                        prisoner_id: gId,
                        type: <span class="hljs-string">"prisoner"</span>
                    };
                    content.innerHTML = [obj.name, <span class="hljs-string">' '</span>, obj.level].join(<span class="hljs-string">''</span>);
                    c.appendChild(item);
                    <span class="hljs-keyword">this</span>.updateAddCargo(<span class="hljs-keyword">this</span>.spySize);
                }
            }
        },
        AddRemove: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e, matchedEl, container)</span> {</span>
            <span class="hljs-keyword">var</span> quantity = matchedEl.previousSibling.value * <span class="hljs-number">1</span>,
                li = matchedEl.parentNode.parentNode;
            <span class="hljs-keyword">if</span> (quantity) {
                <span class="hljs-keyword">var</span> newTotal = li.Object.quantity - quantity,
                    diff = quantity * -<span class="hljs-number">1</span>,
                    lq = Sel.query(<span class="hljs-string">".quantity"</span>, li, <span class="hljs-literal">true</span>);
                <span class="hljs-keyword">if</span> (newTotal &lt; <span class="hljs-number">0</span>) {
                    newTotal = <span class="hljs-number">0</span>;
                    diff = li.Object.quantity * -<span class="hljs-number">1</span>;
                }
                <span class="hljs-keyword">if</span> (newTotal === <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">this</span>.updateAddCargo(li.Object.quantity * -<span class="hljs-number">1</span>);
                    Event.purgeElement(li);
                    li.parentNode.removeChild(li);
                } <span class="hljs-keyword">else</span> {
                    lq.innerHTML = newTotal;
                    li.Object.quantity = newTotal;
                    <span class="hljs-keyword">this</span>.updateAddCargo(diff);
                    <span class="hljs-keyword">var</span> a = <span class="hljs-keyword">new</span> Util.ColorAnim(lq, {
                        color: {
                            from: <span class="hljs-string">'#f00'</span>,
                            to: <span class="hljs-string">'#fff'</span>
                        }
                    }, <span class="hljs-number">1.5</span>);
                    a.animate();
                }
            }
        },
        AddTrade: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> qVal = Dom.get(<span class="hljs-string">"tradeAddAskingQuantity"</span>)
                .value * <span class="hljs-number">1</span>;
            <span class="hljs-keyword">if</span> (!Lang.isNumber(qVal) || qVal &lt;= <span class="hljs-number">0</span>) {
                Dom.get(<span class="hljs-string">"tradeAddMessage"</span>)
                    .innerHTML = <span class="hljs-string">"Quantity of asking essentia must be a number and greater than 0"</span>;
                <span class="hljs-keyword">return</span>;
            } <span class="hljs-keyword">else</span> {
                Dom.get(<span class="hljs-string">"tradeAddMessage"</span>)
                    .innerHTML = <span class="hljs-string">""</span>;
            }
            <span class="hljs-keyword">var</span> data = {
                session_id: Game.GetSession(<span class="hljs-string">""</span>),
                building_id: <span class="hljs-keyword">this</span>.building.id,
                offer: [],
                ask: qVal
            },
                hasResources, hasPlans, hasGlyphs, hasShips, hasPrisoners, lis = Sel.query(<span class="hljs-string">"li"</span>, <span class="hljs-string">"tradeAddItems"</span>);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span>; n &lt; lis.length; n++) {
                <span class="hljs-keyword">var</span> obj = lis[n].Object;
                <span class="hljs-keyword">if</span> (obj) {
                    data.offer[data.offer.length] = obj;
                    <span class="hljs-keyword">switch</span> (obj.type) {
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"plan"</span>:
                        hasPlans = <span class="hljs-literal">true</span>;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"glyph"</span>:
                        hasGlyphs = <span class="hljs-literal">true</span>;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"prisoner"</span>:
                        hasPrisoners = <span class="hljs-literal">true</span>;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"ship"</span>:
                        hasShips = <span class="hljs-literal">true</span>;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">default</span>:
                        hasResources = <span class="hljs-literal">true</span>;
                        <span class="hljs-keyword">break</span>;
                    }
                }
            }
            Lacuna.Pulser.Show();
            <span class="hljs-keyword">this</span>.service.add_to_market(data, {
                success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                    <span class="hljs-keyword">this</span>.rpcSuccess(o);
                    <span class="hljs-keyword">if</span> (hasResources) {
                        <span class="hljs-keyword">this</span>.getStoredResources(<span class="hljs-literal">true</span>);
                    }
                    <span class="hljs-keyword">if</span> (hasPlans) {
                        <span class="hljs-keyword">this</span>.getPlans(<span class="hljs-literal">true</span>);
                    }
                    <span class="hljs-keyword">if</span> (hasGlyphs) {
                        <span class="hljs-keyword">this</span>.getGlyphs(<span class="hljs-literal">true</span>);
                    }
                    <span class="hljs-keyword">if</span> (hasPrisoners) {
                        <span class="hljs-keyword">this</span>.getPrisoners(<span class="hljs-literal">true</span>);
                    }
                    <span class="hljs-keyword">if</span> (hasShips) {
                        <span class="hljs-keyword">this</span>.getShips(<span class="hljs-literal">true</span>);
                    }
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; lis.length; i++) {
                        <span class="hljs-keyword">if</span> (lis[i].Object) {
                            Event.purgeElement(lis[i]);
                            lis[i].parentNode.removeChild(lis[i]);
                        }
                    }
                    Dom.get(<span class="hljs-string">"tradeAddAskingQuantity"</span>)
                        .value = <span class="hljs-string">""</span>;
                    Dom.get(<span class="hljs-string">"tradeAddCargo"</span>)
                        .innerHTML = <span class="hljs-string">"0"</span>;
                    <span class="hljs-keyword">this</span>.fireEvent(<span class="hljs-string">"onSelectTab"</span>, <span class="hljs-keyword">this</span>.mineTabIndex);
                    Lacuna.Pulser.Hide();
                },
                scope: <span class="hljs-keyword">this</span>
            });
        },
        <span class="hljs-comment">//Push Resources</span>
        populatePushResourceName: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> elm = Dom.get(<span class="hljs-string">"tradePushResourceName"</span>),
                li = document.createElement(<span class="hljs-string">"li"</span>),
                nLi, x, r, name, resource;
            <span class="hljs-keyword">if</span> (elm) {
                elm.innerHTML = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">for</span> (r <span class="hljs-keyword">in</span> Lib.ResourceTypes) {
                    <span class="hljs-keyword">if</span> (Lib.ResourceTypes.hasOwnProperty(r)) {
                        resource = Lib.ResourceTypes[r];
                        <span class="hljs-keyword">if</span> (Lang.isArray(resource)) {
                            <span class="hljs-keyword">for</span> (x = <span class="hljs-number">0</span>; x &lt; resource.length; x++) {
                                name = resource[x];
                                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.resources[name]) {
                                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                                    nLi.Resource = {
                                        type: name,
                                        quantity: <span class="hljs-keyword">this</span>.resources[name] * <span class="hljs-number">1</span>
                                    };
                                    nLi.innerHTML = [<span class="hljs-string">'&lt;span class="tradeResourceName"&gt;'</span>, name.titleCaps(), <span class="hljs-string">' (&lt;label class="quantity"&gt;'</span>, <span class="hljs-keyword">this</span>.resources[name], <span class="hljs-string">'&lt;/label&gt;)&lt;/span&gt; &lt;input type="text" style="width:75px;" /&gt;&lt;button type="button"&gt;+&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>);
                                    elm.appendChild(nLi);
                                }
                            }
                        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.resources[r] &amp;&amp; resource) {
                            nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                            nLi.Resource = {
                                type: r,
                                quantity: <span class="hljs-keyword">this</span>.resources[r] * <span class="hljs-number">1</span>
                            };
                            nLi.innerHTML = [<span class="hljs-string">'&lt;span class="tradeResourceName"&gt;'</span>, r.titleCaps(), <span class="hljs-string">' (&lt;label class="quantity"&gt;'</span>, <span class="hljs-keyword">this</span>.resources[r], <span class="hljs-string">'&lt;/label&gt;)&lt;/span&gt; &lt;input type="text" style="width:75px;" /&gt;&lt;button type="button"&gt;+&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>);
                            elm.appendChild(nLi);
                        }
                    }
                }
            }
            <span class="hljs-comment">//wait for tab to display first</span>
            setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">var</span> Ht = Game.GetSize()
                    .h - <span class="hljs-number">180</span>;
                <span class="hljs-keyword">if</span> (Ht &gt; <span class="hljs-number">270</span>) {
                    Ht = <span class="hljs-number">270</span>;
                }
                <span class="hljs-keyword">var</span> pHt = Dom.get(<span class="hljs-string">'pHt'</span>);
                Dom.setStyle(pHt, <span class="hljs-string">"height"</span>, Ht + <span class="hljs-string">"px"</span>);
                Dom.setStyle(pHt, <span class="hljs-string">"overflow-y"</span>, <span class="hljs-string">"auto"</span>);
            }, <span class="hljs-number">10</span>);
        },
        populatePushGlyphName: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> elm = Dom.get(<span class="hljs-string">"tradePushGlyphName"</span>),
                li = document.createElement(<span class="hljs-string">"li"</span>),
                nLi;
            <span class="hljs-keyword">if</span> (elm) {
                elm.innerHTML = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.glyphs.length &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>; x &lt; <span class="hljs-keyword">this</span>.glyphs.length; x++) {
                        <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">this</span>.glyphs[x];
                        nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                        nLi.Glyph = obj;
                        nLi.innerHTML = [<span class="hljs-string">'&lt;span class="tradeResourceName"&gt;'</span>, obj.name.titleCaps(), <span class="hljs-string">' (&lt;label class="quantity"&gt;'</span>, obj.quantity, <span class="hljs-string">'&lt;/label&gt;)&lt;/span&gt; &lt;input type="text" style="width:75px;" /&gt;&lt;button type="button"&gt;+&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>);
                        elm.appendChild(nLi);
                    }
                } <span class="hljs-keyword">else</span> {
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    nLi.innerHTML = <span class="hljs-string">"No Glyphs Available"</span>;
                    elm.appendChild(nLi);
                }
            }
        },
        populatePushPlanName: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> elm = Dom.get(<span class="hljs-string">"tradePushPlanName"</span>),
                li = document.createElement(<span class="hljs-string">"li"</span>),
                nLi;
            <span class="hljs-keyword">if</span> (elm) {
                elm.innerHTML = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.plans.length &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>; x &lt; <span class="hljs-keyword">this</span>.plans.length; x++) {
                        <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">this</span>.plans[x];
                        nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                        nLi.Plan = obj;
                        <span class="hljs-keyword">if</span> (obj.extra_build_level &gt; <span class="hljs-number">0</span>) {
                            nLi.innerHTML = [<span class="hljs-string">'&lt;span class="tradeResourceName"&gt;'</span>, obj.name, <span class="hljs-string">' '</span>, obj.level, <span class="hljs-string">'+'</span>, obj.extra_build_level, <span class="hljs-string">' (&lt;label class="quantity"&gt;'</span>, obj.quantity, <span class="hljs-string">'&lt;/label&gt;)&lt;/span&gt; &lt;input type="text" style="width:75px;" /&gt;&lt;button type="button"&gt;+&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>);
                        } <span class="hljs-keyword">else</span> {
                            nLi.innerHTML = [<span class="hljs-string">'&lt;span class="tradeResourceName"&gt;'</span>, obj.name, <span class="hljs-string">' '</span>, obj.level, <span class="hljs-string">' (&lt;label class="quantity"&gt;'</span>, obj.quantity, <span class="hljs-string">'&lt;/label&gt;)&lt;/span&gt; &lt;input type="text" style="width:75px;" /&gt;&lt;button type="button"&gt;+&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>);
                        }
                        elm.appendChild(nLi);
                    }
                } <span class="hljs-keyword">else</span> {
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    nLi.innerHTML = <span class="hljs-string">"No Plans Available"</span>;
                    elm.appendChild(nLi);
                }
            }
        },
        populatePushShipName: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> elm = Dom.get(<span class="hljs-string">"tradePushShipName"</span>),
                li = document.createElement(<span class="hljs-string">"li"</span>),
                nLi;
            <span class="hljs-keyword">if</span> (elm) {
                elm.innerHTML = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.ships.length &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>; x &lt; <span class="hljs-keyword">this</span>.ships.length; x++) {
                        <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">this</span>.ships[x];
                        nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                        nLi.Ship = obj;
                        nLi.innerHTML = [<span class="hljs-string">'&lt;span class="tradeName"&gt;'</span>,
                            obj.name, <span class="hljs-string">' - '</span>,
                            obj.type.titleCaps(<span class="hljs-string">'_'</span>, <span class="hljs-string">' '</span>), <span class="hljs-string">' - Hold:'</span>, obj.hold_size, <span class="hljs-string">' - Berth:'</span>, obj.berth_level, <span class="hljs-string">' - Speed:'</span>, obj.speed, <span class="hljs-string">' (&lt;label class="quantity"&gt;'</span>,
                            obj.quantity, <span class="hljs-string">'&lt;/label&gt;)&lt;/span&gt; &lt;input type="text" style="width:75px;" /&gt;&lt;button type="button"&gt;+&lt;/button&gt;'</span>
                        ].join(<span class="hljs-string">''</span>);
                        elm.appendChild(nLi);
                    }
                } <span class="hljs-keyword">else</span> {
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    nLi.innerHTML = <span class="hljs-string">"No Ships Available"</span>;
                    elm.appendChild(nLi);
                }
            }
        },
        populatePushPrisonerName: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> elm = Dom.get(<span class="hljs-string">"tradePushPrisonerName"</span>),
                li = document.createElement(<span class="hljs-string">"li"</span>),
                nLi;
            <span class="hljs-keyword">if</span> (elm) {
                elm.innerHTML = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.prisoners.length &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>; x &lt; <span class="hljs-keyword">this</span>.prisoners.length; x++) {
                        <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">this</span>.prisoners[x];
                        nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                        nLi.Prisoner = obj;
                        nLi.innerHTML = [<span class="hljs-string">'&lt;span class="tradeName"&gt;'</span>, obj.name, <span class="hljs-string">' '</span>, obj.level, <span class="hljs-string">'&lt;/span&gt; &lt;button type="button"&gt;+&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>);
                        elm.appendChild(nLi);
                    }
                } <span class="hljs-keyword">else</span> {
                    nLi = li.cloneNode(<span class="hljs-literal">false</span>);
                    nLi.innerHTML = <span class="hljs-string">"No Prisoners Available"</span>;
                    elm.appendChild(nLi);
                }
            }
        },
        updatePushCargo: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(byVal)</span> {</span>
            <span class="hljs-keyword">var</span> c = Dom.get(<span class="hljs-string">"tradePushCargo"</span>),
                cv = c.innerHTML * <span class="hljs-number">1</span>;
            c.innerHTML = cv + byVal;
        },
        PushAddResource: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e, matchedEl, container)</span> {</span>
            <span class="hljs-keyword">var</span> quantity = matchedEl.previousSibling.value * <span class="hljs-number">1</span>,
                li = matchedEl.parentNode,
                c = Dom.get(<span class="hljs-string">"tradePushItems"</span>);
            <span class="hljs-keyword">if</span> (quantity &amp;&amp; c) {
                <span class="hljs-keyword">var</span> id = <span class="hljs-string">"pushResource-"</span> + li.Resource.type,
                    exists = Sel.query(<span class="hljs-string">"#"</span> + id, c);
                <span class="hljs-keyword">if</span> (exists.length === <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">var</span> item = document.createElement(<span class="hljs-string">"li"</span>),
                        del = item.appendChild(document.createElement(<span class="hljs-string">"div"</span>)),
                        content = item.appendChild(document.createElement(<span class="hljs-string">"div"</span>));
                    item.id = id;
                    <span class="hljs-keyword">if</span> (quantity &gt; li.Resource.quantity) {
                        quantity = li.Resource.quantity;
                    }
                    Dom.addClass(item, <span class="hljs-string">"tradeItem"</span>);
                    Dom.addClass(del, <span class="hljs-string">"tradeDelete"</span>);
                    Event.on(del, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
                        <span class="hljs-keyword">var</span> ed = Event.getTarget(e),
                            ep = ed.parentNode;
                        <span class="hljs-keyword">this</span>.updatePushCargo(ep.Object.quantity * -<span class="hljs-number">1</span>);
                        Event.purgeElement(ep);
                        ep.parentNode.removeChild(ep);
                    }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                    item.Object = {
                        type: li.Resource.type,
                        quantity: quantity
                    };
                    content.innerHTML = [<span class="hljs-string">'&lt;span class="tradeResourceName"&gt;'</span>, item.Object.type.titleCaps(), <span class="hljs-string">' (&lt;label class="quantity"&gt;'</span>, quantity, <span class="hljs-string">'&lt;/label&gt;)&lt;/span&gt; &lt;input type="text" style="width:75px;" value="'</span>, quantity, <span class="hljs-string">'" /&gt;&lt;button type="button"&gt;-&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>);
                    c.appendChild(item);
                    <span class="hljs-keyword">this</span>.updatePushCargo(quantity);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">var</span> found = exists[<span class="hljs-number">0</span>],
                        newTotal = found.Object.quantity + quantity,
                        diff = quantity,
                        lq = Sel.query(<span class="hljs-string">".quantity"</span>, found, <span class="hljs-literal">true</span>),
                        inp = Sel.query(<span class="hljs-string">"input"</span>, found, <span class="hljs-literal">true</span>);
                    <span class="hljs-keyword">if</span> (newTotal &gt; li.Resource.quantity) {
                        newTotal = li.Resource.quantity;
                        diff = newTotal - found.Object.quantity;
                    }
                    <span class="hljs-keyword">if</span> (inp) {
                        inp.value = diff;
                    }
                    lq.innerHTML = newTotal;
                    found.Object.quantity = newTotal;
                    <span class="hljs-keyword">this</span>.updatePushCargo(diff);
                    <span class="hljs-keyword">var</span> a = <span class="hljs-keyword">new</span> Util.ColorAnim(lq, {
                        color: {
                            from: <span class="hljs-string">'#0f0'</span>,
                            to: <span class="hljs-string">'#fff'</span>
                        }
                    }, <span class="hljs-number">1.5</span>);
                    a.animate();
                }
            }
        },
        PushAddGlyph: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e, matchedEl, container)</span> {</span>
            <span class="hljs-keyword">var</span> quantity = matchedEl.previousSibling.value * <span class="hljs-number">1</span>,
                li = matchedEl.parentNode,
                c = Dom.get(<span class="hljs-string">"tradePushItems"</span>);
            <span class="hljs-keyword">if</span> (li &amp;&amp; c) {
                <span class="hljs-keyword">var</span> gName = li.Glyph.name,
                    id = <span class="hljs-string">"pushGlyph-"</span> + gName,
                    exists = Sel.query(<span class="hljs-string">"#"</span> + id, c);
                <span class="hljs-keyword">if</span> (exists.length === <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">var</span> item = document.createElement(<span class="hljs-string">"li"</span>),
                        del = item.appendChild(document.createElement(<span class="hljs-string">"div"</span>)),
                        content = item.appendChild(document.createElement(<span class="hljs-string">"div"</span>));
                    item.id = id;
                    Dom.addClass(item, <span class="hljs-string">"tradeItem"</span>);
                    Dom.addClass(del, <span class="hljs-string">"tradeDelete"</span>);
                    Event.on(del, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        <span class="hljs-keyword">var</span> ed = Event.getTarget(e),
                            ep = ed.parentNode;
                        <span class="hljs-keyword">this</span>.updatePushCargo(ep.Object.quantity * -<span class="hljs-keyword">this</span>.glyphSize);
                        Event.purgeElement(item);
                        item.parentNode.removeChild(item);
                    }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                    item.Object = {
                        name: gName,
                        quantity: quantity,
                        type: <span class="hljs-string">"glyph"</span>,
                        size: <span class="hljs-keyword">this</span>.glyphSize
                    };
                    content.innerHTML = [<span class="hljs-string">'&lt;span class="tradeResourceName"&gt;'</span>, gName.titleCaps(), <span class="hljs-string">' (&lt;label class="quantity"&gt;'</span>, quantity, <span class="hljs-string">'&lt;/label&gt;)&lt;/span&gt; &lt;input type="text" style="width:75px;" value="'</span>, quantity, <span class="hljs-string">'" /&gt;&lt;button type="button"&gt;-&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>);
                    c.appendChild(item);
                    <span class="hljs-keyword">this</span>.updatePushCargo(<span class="hljs-keyword">this</span>.glyphSize * quantity);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">var</span> found = exists[<span class="hljs-number">0</span>],
                        newTotal = found.Object.quantity + quantity,
                        diff = quantity,
                        lq = Sel.query(<span class="hljs-string">".quantity"</span>, found, <span class="hljs-literal">true</span>),
                        inp = Sel.query(<span class="hljs-string">"input"</span>, found, <span class="hljs-literal">true</span>);
                    <span class="hljs-keyword">if</span> (newTotal &gt; li.Glyph.quantity) {
                        newTotal = li.Glyph.quantity;
                        diff = newTotal - found.Object.quantity;
                    }
                    <span class="hljs-keyword">if</span> (inp) {
                        inp.value = diff;
                    }
                    lq.innerHTML = newTotal;
                    found.Object.quantity = newTotal;
                    <span class="hljs-keyword">this</span>.updatePushCargo(<span class="hljs-keyword">this</span>.glyphSize * diff);
                }
            }
        },
        PushAddPlan: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e, matchedEl, container)</span> {</span>
            <span class="hljs-keyword">var</span> quantity = matchedEl.previousSibling.value * <span class="hljs-number">1</span>,
                li = matchedEl.parentNode,
                c = Dom.get(<span class="hljs-string">"tradePushItems"</span>);
            <span class="hljs-keyword">if</span> (quantity &amp;&amp; li &amp;&amp; c) {
                <span class="hljs-keyword">var</span> pName = li.Plan.name,
                    pType = li.Plan.plan_type,
                    pLevel = li.Plan.level,
                    pExtra = li.Plan.extra_build_level,
                    id = [<span class="hljs-string">'pushPlan-'</span>, pType, <span class="hljs-string">'-'</span>, pLevel, <span class="hljs-string">'-'</span>, pExtra].join(<span class="hljs-string">''</span>)
                        .titleCaps(<span class="hljs-string">' '</span>, <span class="hljs-string">'_'</span>),
                    exists = Sel.query(<span class="hljs-string">"#"</span> + id, c);
                <span class="hljs-keyword">if</span> (exists.length === <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">var</span> item = document.createElement(<span class="hljs-string">"li"</span>),
                        del = item.appendChild(document.createElement(<span class="hljs-string">"div"</span>)),
                        content = item.appendChild(document.createElement(<span class="hljs-string">"div"</span>));
                    item.id = id;
                    Dom.addClass(item, <span class="hljs-string">"tradeItem"</span>);
                    Dom.addClass(del, <span class="hljs-string">"tradeDelete"</span>);
                    Event.on(del, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
                        <span class="hljs-keyword">var</span> ed = Event.getTarget(e),
                            ep = ed.parentNode;
                        <span class="hljs-keyword">this</span>.updatePushCargo(ep.Object.quantity * -<span class="hljs-keyword">this</span>.planSize);
                        Event.purgeElement(item);
                        item.parentNode.removeChild(item);
                    }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                    item.Object = {
                        plan_type: pType,
                        quantity: quantity,
                        type: <span class="hljs-string">"plan"</span>,
                        level: pLevel,
                        extra_build_level: pExtra,
                        size: <span class="hljs-keyword">this</span>.planSize
                    };
                    <span class="hljs-keyword">if</span> (pExtra &gt; <span class="hljs-number">0</span>) {
                        content.innerHTML = [<span class="hljs-string">'&lt;span class="tradeResourceName"&gt;'</span>, pName, <span class="hljs-string">' '</span>, pLevel, <span class="hljs-string">'+'</span>, pExtra, <span class="hljs-string">' (&lt;label class="quantity"&gt;'</span>, quantity, <span class="hljs-string">'&lt;/label&gt;)&lt;/span&gt; &lt;input type="text" style="width:75px;" value="'</span>, quantity, <span class="hljs-string">'" /&gt;&lt;button type="button"&gt;-&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>);
                    } <span class="hljs-keyword">else</span> {
                        content.innerHTML = [<span class="hljs-string">'&lt;span class="tradeResourceName"&gt;'</span>, pName, <span class="hljs-string">' '</span>, pLevel, <span class="hljs-string">' (&lt;label class="quantity"&gt;'</span>, quantity, <span class="hljs-string">'&lt;/label&gt;)&lt;/span&gt; &lt;input type="text" style="width:75px;" value="'</span>, quantity, <span class="hljs-string">'" /&gt;&lt;button type="button"&gt;-&lt;/button&gt;'</span>].join(<span class="hljs-string">''</span>);
                    }
                    c.appendChild(item);
                    <span class="hljs-keyword">this</span>.updatePushCargo(<span class="hljs-keyword">this</span>.planSize * quantity);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">var</span> found = exists[<span class="hljs-number">0</span>],
                        newTotal = found.Object.quantity + quantity,
                        diff = quantity,
                        lq = Sel.query(<span class="hljs-string">".quantity"</span>, found, <span class="hljs-literal">true</span>),
                        inp = Sel.query(<span class="hljs-string">"input"</span>, found, <span class="hljs-literal">true</span>);
                    <span class="hljs-keyword">if</span> (newTotal &gt; li.Plan.quantity) {
                        newTotal = li.Plan.quantity;
                        diff = newTotal - found.Object.quantity;
                    }
                    <span class="hljs-keyword">if</span> (inp) {
                        inp.value = diff;
                    }
                    lq.innerHTML = newTotal;
                    found.Object.quantity = newTotal;
                    <span class="hljs-keyword">this</span>.updatePushCargo(<span class="hljs-keyword">this</span>.planSize * diff);
                }
            }
        },
        PushAddShip: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e, matchedEl, container)</span> {</span>
            <span class="hljs-keyword">var</span> quantity = matchedEl.previousSibling.value * <span class="hljs-number">1</span>,
                li = matchedEl.parentNode,
                c = Dom.get(<span class="hljs-string">"tradePushItems"</span>);
            <span class="hljs-keyword">if</span> (li &amp;&amp; c) {
                <span class="hljs-keyword">var</span> sName = li.Ship.name,
                    sType = li.Ship.type,
                    sSize = li.Ship.hold_size,
                    sBerth = li.Ship.berth_level,
                    sSpeed = li.Ship.speed,
                    id = [<span class="hljs-string">'pushShip-'</span>, sName, sType, sSize, sBerth, sSpeed].join(<span class="hljs-string">'-'</span>)
                        .titleCaps(<span class="hljs-string">' '</span>, <span class="hljs-string">'_'</span>),
                    exists = Sel.query(<span class="hljs-string">"#"</span> + id, c);
                <span class="hljs-keyword">if</span> (exists.length === <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">var</span> item = document.createElement(<span class="hljs-string">"li"</span>),
                        del = item.appendChild(document.createElement(<span class="hljs-string">"div"</span>)),
                        content = item.appendChild(document.createElement(<span class="hljs-string">"div"</span>));
                    item.id = id;
                    Dom.addClass(item, <span class="hljs-string">"tradeItem"</span>);
                    Dom.addClass(del, <span class="hljs-string">"tradeDelete"</span>);
                    Event.on(del, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
                        <span class="hljs-keyword">var</span> ed = Event.getTarget(e),
                            ep = ed.parentNode;
                        <span class="hljs-keyword">this</span>.updatePushCargo(ep.Object.quantity * -<span class="hljs-keyword">this</span>.shipSize);
                        Event.purgeElement(item);
                        item.parentNode.removeChild(item);
                    }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                    item.Object = {
                        quantity: quantity,
                        type: <span class="hljs-string">"ship"</span>,
                        name: sName,
                        ship_type: sType,
                        hold_size: sSize,
                        berth_level: sBerth,
                        speed: sSpeed,
                        size: <span class="hljs-keyword">this</span>.shipSize
                    };
                    content.innerHTML = [<span class="hljs-string">'&lt;span class="tradeResourceName"&gt;'</span>,
                        sName, <span class="hljs-string">' - '</span>, sType.titleCaps(<span class="hljs-string">'_'</span>, <span class="hljs-string">' '</span>), <span class="hljs-string">' - Hold:'</span>, sSize, <span class="hljs-string">' - Berth:'</span>, sBerth, <span class="hljs-string">' - Speed:'</span>, sSpeed, <span class="hljs-string">' (&lt;label class="quantity"&gt;'</span>, quantity, <span class="hljs-string">'&lt;/label&gt;)&lt;/span&gt; &lt;input type="text" style="width:75px;" value="'</span>,
                        quantity, <span class="hljs-string">'" /&gt;&lt;button type="button"&gt;-&lt;/button&gt;'</span>
                    ].join(<span class="hljs-string">''</span>);
                    c.appendChild(item);
                    <span class="hljs-keyword">this</span>.updatePushCargo(<span class="hljs-keyword">this</span>.shipSize * quantity);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">var</span> found = exists[<span class="hljs-number">0</span>],
                        newTotal = found.Object.quantity + quantity,
                        diff = quantity,
                        lq = Sel.query(<span class="hljs-string">".quantity"</span>, found, <span class="hljs-literal">true</span>),
                        inp = Sel.query(<span class="hljs-string">"input"</span>, found, <span class="hljs-literal">true</span>);
                    <span class="hljs-keyword">if</span> (newTotal &gt; li.Ship.quantity) {
                        newTotal = li.Ship.quantity;
                        diff = newTotal - found.Object.quantity;
                    }
                    <span class="hljs-keyword">if</span> (inp) {
                        inp.value = diff;
                    }
                    lq.innerHTML = newTotal;
                    found.Object.quantity = newTotal;
                    <span class="hljs-keyword">this</span>.updatePushCargo(<span class="hljs-keyword">this</span>.shipSize * diff);
                }
            }
        },
        PushAddPrisoner: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e, matchedEl, container)</span> {</span>
            <span class="hljs-keyword">var</span> li = matchedEl.parentNode,
                c = Dom.get(<span class="hljs-string">"tradePushItems"</span>);
            <span class="hljs-keyword">if</span> (li &amp;&amp; c) {
                <span class="hljs-keyword">var</span> obj = li.Prisoner,
                    gId = obj.id,
                    id = <span class="hljs-string">"pushPrisoner-"</span> + gId;
                <span class="hljs-keyword">if</span> (Sel.query(<span class="hljs-string">"#"</span> + id, c)
                    .length === <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">var</span> item = document.createElement(<span class="hljs-string">"li"</span>),
                        del = item.appendChild(document.createElement(<span class="hljs-string">"div"</span>)),
                        content = item.appendChild(document.createElement(<span class="hljs-string">"div"</span>));
                    item.id = id;
                    Dom.addClass(item, <span class="hljs-string">"tradeItem"</span>);
                    Dom.addClass(del, <span class="hljs-string">"tradeDelete"</span>);
                    Event.on(del, <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        <span class="hljs-keyword">this</span>.updatePushCargo(<span class="hljs-keyword">this</span>.spySize * -<span class="hljs-number">1</span>);
                        Event.purgeElement(item);
                        item.parentNode.removeChild(item);
                    }, <span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
                    item.Object = {
                        prisoner_id: gId,
                        type: <span class="hljs-string">"prisoner"</span>
                    };
                    content.innerHTML = [obj.name, <span class="hljs-string">' '</span>, obj.level].join(<span class="hljs-string">''</span>);
                    c.appendChild(item);
                    <span class="hljs-keyword">this</span>.updatePushCargo(<span class="hljs-keyword">this</span>.spySize);
                }
            }
        },
        PushRemove: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e, matchedEl, container)</span> {</span>
            <span class="hljs-keyword">var</span> quantity = matchedEl.previousSibling.value * <span class="hljs-number">1</span>,
                li = matchedEl.parentNode.parentNode;
            <span class="hljs-keyword">if</span> (quantity) {
                <span class="hljs-keyword">var</span> newTotal = li.Object.quantity - quantity,
                    diff = quantity * -<span class="hljs-number">1</span>,
                    lq = Sel.query(<span class="hljs-string">".quantity"</span>, li, <span class="hljs-literal">true</span>);
                <span class="hljs-keyword">if</span> (newTotal &lt; <span class="hljs-number">0</span>) {
                    newTotal = <span class="hljs-number">0</span>;
                    diff = li.Object.quantity * -<span class="hljs-number">1</span>;
                }
                <span class="hljs-keyword">if</span> (newTotal === <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">this</span>.updatePushCargo(li.Object.quantity * -<span class="hljs-number">1</span>);
                    Event.purgeElement(li);
                    li.parentNode.removeChild(li);
                } <span class="hljs-keyword">else</span> {
                    lq.innerHTML = newTotal;
                    li.Object.quantity = newTotal;
                    <span class="hljs-keyword">this</span>.updatePushCargo(diff);
                    <span class="hljs-keyword">var</span> a = <span class="hljs-keyword">new</span> Util.ColorAnim(lq, {
                        color: {
                            from: <span class="hljs-string">'#f00'</span>,
                            to: <span class="hljs-string">'#fff'</span>
                        }
                    }, <span class="hljs-number">1.5</span>);
                    a.animate();
                }
            }
        },
        Push: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> data = {
                session_id: Game.GetSession(<span class="hljs-string">""</span>),
                building_id: <span class="hljs-keyword">this</span>.building.id,
                target_id: Lib.getSelectedOptionValue(Dom.get(<span class="hljs-string">"tradePushColony"</span>))
            },
                lis = Sel.query(<span class="hljs-string">"li"</span>, <span class="hljs-string">"tradePushItems"</span>),
                items = [],
                hasResources, hasPlans, hasGlyphs, hasShips, hasPrisoners;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span>; n &lt; lis.length; n++) {
                <span class="hljs-keyword">if</span> (lis[n].Object) {
                    items[n] = lis[n].Object;
                    <span class="hljs-keyword">switch</span> (items[n].type) {
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"plan"</span>:
                        hasPlans = <span class="hljs-literal">true</span>;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"glyph"</span>:
                        hasGlyphs = <span class="hljs-literal">true</span>;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"prisoner"</span>:
                        hasPrisoners = <span class="hljs-literal">true</span>;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"ship"</span>:
                        hasShips = <span class="hljs-literal">true</span>;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">default</span>:
                        hasResources = <span class="hljs-literal">true</span>;
                        <span class="hljs-keyword">break</span>;
                    }
                }
            }
            data.items = items;
            <span class="hljs-keyword">if</span> (data.items.length === <span class="hljs-number">0</span>) {
                Dom.get(<span class="hljs-string">"tradePushMessage"</span>)
                    .innerHTML = <span class="hljs-string">"Must add items to send to colony."</span>;
            } <span class="hljs-keyword">else</span> {
                Dom.get(<span class="hljs-string">"tradePushMessage"</span>)
                    .innerHTML = <span class="hljs-string">""</span>;
                Lacuna.Pulser.Show();
                <span class="hljs-keyword">this</span>.service.push_items(data, {
                    success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(o)</span> {</span>
                        <span class="hljs-keyword">this</span>.rpcSuccess(o);
                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; lis.length; i++) {
                            <span class="hljs-keyword">if</span> (lis[i].Object) {
                                Event.purgeElement(lis[i]);
                                lis[i].parentNode.removeChild(lis[i]);
                            }
                        }
                        Dom.get(<span class="hljs-string">"tradePushCargo"</span>)
                            .innerHTML = <span class="hljs-string">"0"</span>;
                        <span class="hljs-keyword">if</span> (hasResources) {
                            <span class="hljs-keyword">this</span>.getStoredResources(<span class="hljs-literal">true</span>);
                        }
                        <span class="hljs-keyword">if</span> (hasPlans) {
                            <span class="hljs-keyword">this</span>.getPlans(<span class="hljs-literal">true</span>);
                        }
                        <span class="hljs-keyword">if</span> (hasGlyphs) {
                            <span class="hljs-keyword">this</span>.getGlyphs(<span class="hljs-literal">true</span>);
                        }
                        <span class="hljs-keyword">if</span> (hasPrisoners) {
                            <span class="hljs-keyword">this</span>.getPrisoners(<span class="hljs-literal">true</span>);
                        }
                        <span class="hljs-keyword">if</span> (hasShips) {
                            <span class="hljs-keyword">this</span>.getShips(<span class="hljs-literal">true</span>);
                        }
                        <span class="hljs-keyword">var</span> msg = Dom.get(<span class="hljs-string">"tradePushMessage"</span>);
                        msg.innerHTML = [<span class="hljs-string">"Successfully pushed to "</span>, Lib.getSelectedOption(Dom.get(<span class="hljs-string">"tradePushColony"</span>))
                            .innerHTML, <span class="hljs-string">'.'</span>
                        ].join(<span class="hljs-string">''</span>);
                        Lib.fadeOutElm(<span class="hljs-string">"tradePushMessage"</span>);
                        Lacuna.Pulser.Hide();
                    },
                    scope: <span class="hljs-keyword">this</span>
                });
            }
        }
    });
    Lacuna.buildings.Transporter = Transporter;
})();</pre></div>
      
      </div>
    
    </div>
  </div>

  <script src="../../../toc.js"></script>
  <script src="../../../assets/libs.js"></script>
  <script src="../../../assets/behavior.js"></script>
</body>
</html>